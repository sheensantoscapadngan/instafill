{"ast":null,"code":"import pako from 'pako';\nvar UPNG = {};\n\nUPNG.toRGBA8 = function (out) {\n  var w = out.width,\n      h = out.height;\n  if (out.tabs.acTL == null) return [UPNG.toRGBA8.decodeImage(out.data, w, h, out).buffer];\n  var frms = [];\n  if (out.frames[0].data == null) out.frames[0].data = out.data;\n  var len = w * h * 4,\n      img = new Uint8Array(len),\n      empty = new Uint8Array(len),\n      prev = new Uint8Array(len);\n\n  for (var i = 0; i < out.frames.length; i++) {\n    var frm = out.frames[i];\n    var fx = frm.rect.x,\n        fy = frm.rect.y,\n        fw = frm.rect.width,\n        fh = frm.rect.height;\n    var fdata = UPNG.toRGBA8.decodeImage(frm.data, fw, fh, out);\n    if (i != 0) for (var j = 0; j < len; j++) prev[j] = img[j];\n    if (frm.blend == 0) UPNG._copyTile(fdata, fw, fh, img, w, h, fx, fy, 0);else if (frm.blend == 1) UPNG._copyTile(fdata, fw, fh, img, w, h, fx, fy, 1);\n    frms.push(img.buffer.slice(0));\n\n    if (frm.dispose == 0) {} else if (frm.dispose == 1) UPNG._copyTile(empty, fw, fh, img, w, h, fx, fy, 0);else if (frm.dispose == 2) for (var j = 0; j < len; j++) img[j] = prev[j];\n  }\n\n  return frms;\n};\n\nUPNG.toRGBA8.decodeImage = function (data, w, h, out) {\n  var area = w * h,\n      bpp = UPNG.decode._getBPP(out);\n\n  var bpl = Math.ceil(w * bpp / 8); // bytes per line\n\n  var bf = new Uint8Array(area * 4),\n      bf32 = new Uint32Array(bf.buffer);\n  var ctype = out.ctype,\n      depth = out.depth;\n  var rs = UPNG._bin.readUshort; //console.log(ctype, depth);\n\n  var time = Date.now();\n\n  if (ctype == 6) {\n    // RGB + alpha\n    var qarea = area << 2;\n    if (depth == 8) for (var i = 0; i < qarea; i += 4) {\n      bf[i] = data[i];\n      bf[i + 1] = data[i + 1];\n      bf[i + 2] = data[i + 2];\n      bf[i + 3] = data[i + 3];\n    }\n    if (depth == 16) for (var i = 0; i < qarea; i++) {\n      bf[i] = data[i << 1];\n    }\n  } else if (ctype == 2) {\n    // RGB\n    var ts = out.tabs[\"tRNS\"];\n\n    if (ts == null) {\n      if (depth == 8) for (var i = 0; i < area; i++) {\n        var ti = i * 3;\n        bf32[i] = 255 << 24 | data[ti + 2] << 16 | data[ti + 1] << 8 | data[ti];\n      }\n      if (depth == 16) for (var i = 0; i < area; i++) {\n        var ti = i * 6;\n        bf32[i] = 255 << 24 | data[ti + 4] << 16 | data[ti + 2] << 8 | data[ti];\n      }\n    } else {\n      var tr = ts[0],\n          tg = ts[1],\n          tb = ts[2];\n      if (depth == 8) for (var i = 0; i < area; i++) {\n        var qi = i << 2,\n            ti = i * 3;\n        bf32[i] = 255 << 24 | data[ti + 2] << 16 | data[ti + 1] << 8 | data[ti];\n        if (data[ti] == tr && data[ti + 1] == tg && data[ti + 2] == tb) bf[qi + 3] = 0;\n      }\n      if (depth == 16) for (var i = 0; i < area; i++) {\n        var qi = i << 2,\n            ti = i * 6;\n        bf32[i] = 255 << 24 | data[ti + 4] << 16 | data[ti + 2] << 8 | data[ti];\n        if (rs(data, ti) == tr && rs(data, ti + 2) == tg && rs(data, ti + 4) == tb) bf[qi + 3] = 0;\n      }\n    }\n  } else if (ctype == 3) {\n    // palette\n    var p = out.tabs[\"PLTE\"],\n        ap = out.tabs[\"tRNS\"],\n        tl = ap ? ap.length : 0; //console.log(p, ap);\n\n    if (depth == 1) for (var y = 0; y < h; y++) {\n      var s0 = y * bpl,\n          t0 = y * w;\n\n      for (var i = 0; i < w; i++) {\n        var qi = t0 + i << 2,\n            j = data[s0 + (i >> 3)] >> 7 - ((i & 7) << 0) & 1,\n            cj = 3 * j;\n        bf[qi] = p[cj];\n        bf[qi + 1] = p[cj + 1];\n        bf[qi + 2] = p[cj + 2];\n        bf[qi + 3] = j < tl ? ap[j] : 255;\n      }\n    }\n    if (depth == 2) for (var y = 0; y < h; y++) {\n      var s0 = y * bpl,\n          t0 = y * w;\n\n      for (var i = 0; i < w; i++) {\n        var qi = t0 + i << 2,\n            j = data[s0 + (i >> 2)] >> 6 - ((i & 3) << 1) & 3,\n            cj = 3 * j;\n        bf[qi] = p[cj];\n        bf[qi + 1] = p[cj + 1];\n        bf[qi + 2] = p[cj + 2];\n        bf[qi + 3] = j < tl ? ap[j] : 255;\n      }\n    }\n    if (depth == 4) for (var y = 0; y < h; y++) {\n      var s0 = y * bpl,\n          t0 = y * w;\n\n      for (var i = 0; i < w; i++) {\n        var qi = t0 + i << 2,\n            j = data[s0 + (i >> 1)] >> 4 - ((i & 1) << 2) & 15,\n            cj = 3 * j;\n        bf[qi] = p[cj];\n        bf[qi + 1] = p[cj + 1];\n        bf[qi + 2] = p[cj + 2];\n        bf[qi + 3] = j < tl ? ap[j] : 255;\n      }\n    }\n    if (depth == 8) for (var i = 0; i < area; i++) {\n      var qi = i << 2,\n          j = data[i],\n          cj = 3 * j;\n      bf[qi] = p[cj];\n      bf[qi + 1] = p[cj + 1];\n      bf[qi + 2] = p[cj + 2];\n      bf[qi + 3] = j < tl ? ap[j] : 255;\n    }\n  } else if (ctype == 4) {\n    // gray + alpha\n    if (depth == 8) for (var i = 0; i < area; i++) {\n      var qi = i << 2,\n          di = i << 1,\n          gr = data[di];\n      bf[qi] = gr;\n      bf[qi + 1] = gr;\n      bf[qi + 2] = gr;\n      bf[qi + 3] = data[di + 1];\n    }\n    if (depth == 16) for (var i = 0; i < area; i++) {\n      var qi = i << 2,\n          di = i << 2,\n          gr = data[di];\n      bf[qi] = gr;\n      bf[qi + 1] = gr;\n      bf[qi + 2] = gr;\n      bf[qi + 3] = data[di + 2];\n    }\n  } else if (ctype == 0) {\n    // gray\n    var tr = out.tabs[\"tRNS\"] ? out.tabs[\"tRNS\"] : -1;\n\n    for (var y = 0; y < h; y++) {\n      var off = y * bpl,\n          to = y * w;\n      if (depth == 1) for (var x = 0; x < w; x++) {\n        var gr = 255 * (data[off + (x >>> 3)] >>> 7 - (x & 7) & 1),\n            al = gr == tr * 255 ? 0 : 255;\n        bf32[to + x] = al << 24 | gr << 16 | gr << 8 | gr;\n      } else if (depth == 2) for (var x = 0; x < w; x++) {\n        var gr = 85 * (data[off + (x >>> 2)] >>> 6 - ((x & 3) << 1) & 3),\n            al = gr == tr * 85 ? 0 : 255;\n        bf32[to + x] = al << 24 | gr << 16 | gr << 8 | gr;\n      } else if (depth == 4) for (var x = 0; x < w; x++) {\n        var gr = 17 * (data[off + (x >>> 1)] >>> 4 - ((x & 1) << 2) & 15),\n            al = gr == tr * 17 ? 0 : 255;\n        bf32[to + x] = al << 24 | gr << 16 | gr << 8 | gr;\n      } else if (depth == 8) for (var x = 0; x < w; x++) {\n        var gr = data[off + x],\n            al = gr == tr ? 0 : 255;\n        bf32[to + x] = al << 24 | gr << 16 | gr << 8 | gr;\n      } else if (depth == 16) for (var x = 0; x < w; x++) {\n        var gr = data[off + (x << 1)],\n            al = rs(data, off + (x << i)) == tr ? 0 : 255;\n        bf32[to + x] = al << 24 | gr << 16 | gr << 8 | gr;\n      }\n    }\n  } //console.log(Date.now()-time);\n\n\n  return bf;\n};\n\nUPNG.decode = function (buff) {\n  var data = new Uint8Array(buff),\n      offset = 8,\n      bin = UPNG._bin,\n      rUs = bin.readUshort,\n      rUi = bin.readUint;\n  var out = {\n    tabs: {},\n    frames: []\n  };\n  var dd = new Uint8Array(data.length),\n      doff = 0; // put all IDAT data into it\n\n  var fd,\n      foff = 0; // frames\n\n  var mgck = [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a];\n\n  for (var i = 0; i < 8; i++) if (data[i] != mgck[i]) throw \"The input is not a PNG file!\";\n\n  while (offset < data.length) {\n    var len = bin.readUint(data, offset);\n    offset += 4;\n    var type = bin.readASCII(data, offset, 4);\n    offset += 4; //console.log(type,len);\n\n    if (type == \"IHDR\") {\n      UPNG.decode._IHDR(data, offset, out);\n    } else if (type == \"IDAT\") {\n      for (var i = 0; i < len; i++) dd[doff + i] = data[offset + i];\n\n      doff += len;\n    } else if (type == \"acTL\") {\n      out.tabs[type] = {\n        num_frames: rUi(data, offset),\n        num_plays: rUi(data, offset + 4)\n      };\n      fd = new Uint8Array(data.length);\n    } else if (type == \"fcTL\") {\n      if (foff != 0) {\n        var fr = out.frames[out.frames.length - 1];\n        fr.data = UPNG.decode._decompress(out, fd.slice(0, foff), fr.rect.width, fr.rect.height);\n        foff = 0;\n      }\n\n      var rct = {\n        x: rUi(data, offset + 12),\n        y: rUi(data, offset + 16),\n        width: rUi(data, offset + 4),\n        height: rUi(data, offset + 8)\n      };\n      var del = rUs(data, offset + 22);\n      del = rUs(data, offset + 20) / (del == 0 ? 100 : del);\n      var frm = {\n        rect: rct,\n        delay: Math.round(del * 1000),\n        dispose: data[offset + 24],\n        blend: data[offset + 25]\n      }; //console.log(frm);\n\n      out.frames.push(frm);\n    } else if (type == \"fdAT\") {\n      for (var i = 0; i < len - 4; i++) fd[foff + i] = data[offset + i + 4];\n\n      foff += len - 4;\n    } else if (type == \"pHYs\") {\n      out.tabs[type] = [bin.readUint(data, offset), bin.readUint(data, offset + 4), data[offset + 8]];\n    } else if (type == \"cHRM\") {\n      out.tabs[type] = [];\n\n      for (var i = 0; i < 8; i++) out.tabs[type].push(bin.readUint(data, offset + i * 4));\n    } else if (type == \"tEXt\") {\n      if (out.tabs[type] == null) out.tabs[type] = {};\n      var nz = bin.nextZero(data, offset);\n      var keyw = bin.readASCII(data, offset, nz - offset);\n      var text = bin.readASCII(data, nz + 1, offset + len - nz - 1);\n      out.tabs[type][keyw] = text;\n    } else if (type == \"iTXt\") {\n      if (out.tabs[type] == null) out.tabs[type] = {};\n      var nz = 0,\n          off = offset;\n      nz = bin.nextZero(data, off);\n      var keyw = bin.readASCII(data, off, nz - off);\n      off = nz + 1;\n      var cflag = data[off],\n          cmeth = data[off + 1];\n      off += 2;\n      nz = bin.nextZero(data, off);\n      var ltag = bin.readASCII(data, off, nz - off);\n      off = nz + 1;\n      nz = bin.nextZero(data, off);\n      var tkeyw = bin.readUTF8(data, off, nz - off);\n      off = nz + 1;\n      var text = bin.readUTF8(data, off, len - (off - offset));\n      out.tabs[type][keyw] = text;\n    } else if (type == \"PLTE\") {\n      out.tabs[type] = bin.readBytes(data, offset, len);\n    } else if (type == \"hIST\") {\n      var pl = out.tabs[\"PLTE\"].length / 3;\n      out.tabs[type] = [];\n\n      for (var i = 0; i < pl; i++) out.tabs[type].push(rUs(data, offset + i * 2));\n    } else if (type == \"tRNS\") {\n      if (out.ctype == 3) out.tabs[type] = bin.readBytes(data, offset, len);else if (out.ctype == 0) out.tabs[type] = rUs(data, offset);else if (out.ctype == 2) out.tabs[type] = [rUs(data, offset), rUs(data, offset + 2), rUs(data, offset + 4)]; //else console.log(\"tRNS for unsupported color type\",out.ctype, len);\n    } else if (type == \"gAMA\") out.tabs[type] = bin.readUint(data, offset) / 100000;else if (type == \"sRGB\") out.tabs[type] = data[offset];else if (type == \"bKGD\") {\n      if (out.ctype == 0 || out.ctype == 4) out.tabs[type] = [rUs(data, offset)];else if (out.ctype == 2 || out.ctype == 6) out.tabs[type] = [rUs(data, offset), rUs(data, offset + 2), rUs(data, offset + 4)];else if (out.ctype == 3) out.tabs[type] = data[offset];\n    } else if (type == \"IEND\") {\n      break;\n    } //else {  log(\"unknown chunk type\", type, len);  }\n\n\n    offset += len;\n    var crc = bin.readUint(data, offset);\n    offset += 4;\n  }\n\n  if (foff != 0) {\n    var fr = out.frames[out.frames.length - 1];\n    fr.data = UPNG.decode._decompress(out, fd.slice(0, foff), fr.rect.width, fr.rect.height);\n    foff = 0;\n  }\n\n  out.data = UPNG.decode._decompress(out, dd, out.width, out.height);\n  delete out.compress;\n  delete out.interlace;\n  delete out.filter;\n  return out;\n};\n\nUPNG.decode._decompress = function (out, dd, w, h) {\n  var time = Date.now();\n\n  var bpp = UPNG.decode._getBPP(out),\n      bpl = Math.ceil(w * bpp / 8),\n      buff = new Uint8Array((bpl + 1 + out.interlace) * h);\n\n  dd = UPNG.decode._inflate(dd, buff); //console.log(dd.length, buff.length);\n  //console.log(Date.now()-time);\n\n  var time = Date.now();\n  if (out.interlace == 0) dd = UPNG.decode._filterZero(dd, out, 0, w, h);else if (out.interlace == 1) dd = UPNG.decode._readInterlace(dd, out); //console.log(Date.now()-time);\n\n  return dd;\n};\n\nUPNG.decode._inflate = function (data, buff) {\n  var out = UPNG[\"inflateRaw\"](new Uint8Array(data.buffer, 2, data.length - 6), buff);\n  return out;\n};\n\nUPNG.inflateRaw = function () {\n  var H = {};\n  H.H = {};\n\n  H.H.N = function (N, W) {\n    var R = Uint8Array,\n        i = 0,\n        m = 0,\n        J = 0,\n        h = 0,\n        Q = 0,\n        X = 0,\n        u = 0,\n        w = 0,\n        d = 0,\n        v,\n        C;\n    if (N[0] == 3 && N[1] == 0) return W ? W : new R(0);\n    var V = H.H,\n        n = V.b,\n        A = V.e,\n        l = V.R,\n        M = V.n,\n        I = V.A,\n        e = V.Z,\n        b = V.m,\n        Z = W == null;\n    if (Z) W = new R(N.length >>> 2 << 3);\n\n    while (i == 0) {\n      i = n(N, d, 1);\n      m = n(N, d + 1, 2);\n      d += 3;\n\n      if (m == 0) {\n        if ((d & 7) != 0) d += 8 - (d & 7);\n        var D = (d >>> 3) + 4,\n            q = N[D - 4] | N[D - 3] << 8;\n        if (Z) W = H.H.W(W, w + q);\n        W.set(new R(N.buffer, N.byteOffset + D, q), w);\n        d = D + q << 3;\n        w += q;\n        continue;\n      }\n\n      if (Z) W = H.H.W(W, w + (1 << 17));\n\n      if (m == 1) {\n        v = b.J;\n        C = b.h;\n        X = (1 << 9) - 1;\n        u = (1 << 5) - 1;\n      }\n\n      if (m == 2) {\n        J = A(N, d, 5) + 257;\n        h = A(N, d + 5, 5) + 1;\n        Q = A(N, d + 10, 4) + 4;\n        d += 14;\n        var E = d,\n            j = 1;\n\n        for (var c = 0; c < 38; c += 2) {\n          b.Q[c] = 0;\n          b.Q[c + 1] = 0;\n        }\n\n        for (var c = 0; c < Q; c++) {\n          var K = A(N, d + c * 3, 3);\n          b.Q[(b.X[c] << 1) + 1] = K;\n          if (K > j) j = K;\n        }\n\n        d += 3 * Q;\n        M(b.Q, j);\n        I(b.Q, j, b.u);\n        v = b.w;\n        C = b.d;\n        d = l(b.u, (1 << j) - 1, J + h, N, d, b.v);\n        var r = V.V(b.v, 0, J, b.C);\n        X = (1 << r) - 1;\n        var S = V.V(b.v, J, h, b.D);\n        u = (1 << S) - 1;\n        M(b.C, r);\n        I(b.C, r, v);\n        M(b.D, S);\n        I(b.D, S, C);\n      }\n\n      while (!0) {\n        var T = v[e(N, d) & X];\n        d += T & 15;\n        var p = T >>> 4;\n\n        if (p >>> 8 == 0) {\n          W[w++] = p;\n        } else if (p == 256) {\n          break;\n        } else {\n          var z = w + p - 254;\n\n          if (p > 264) {\n            var _ = b.q[p - 257];\n            z = w + (_ >>> 3) + A(N, d, _ & 7);\n            d += _ & 7;\n          }\n\n          var $ = C[e(N, d) & u];\n          d += $ & 15;\n          var s = $ >>> 4,\n              Y = b.c[s],\n              a = (Y >>> 4) + n(N, d, Y & 15);\n          d += Y & 15;\n\n          while (w < z) {\n            W[w] = W[w++ - a];\n            W[w] = W[w++ - a];\n            W[w] = W[w++ - a];\n            W[w] = W[w++ - a];\n          }\n\n          w = z;\n        }\n      }\n    }\n\n    return W.length == w ? W : W.slice(0, w);\n  };\n\n  H.H.W = function (N, W) {\n    var R = N.length;\n    if (W <= R) return N;\n    var V = new Uint8Array(R << 1);\n    V.set(N, 0);\n    return V;\n  };\n\n  H.H.R = function (N, W, R, V, n, A) {\n    var l = H.H.e,\n        M = H.H.Z,\n        I = 0;\n\n    while (I < R) {\n      var e = N[M(V, n) & W];\n      n += e & 15;\n      var b = e >>> 4;\n\n      if (b <= 15) {\n        A[I] = b;\n        I++;\n      } else {\n        var Z = 0,\n            m = 0;\n\n        if (b == 16) {\n          m = 3 + l(V, n, 2);\n          n += 2;\n          Z = A[I - 1];\n        } else if (b == 17) {\n          m = 3 + l(V, n, 3);\n          n += 3;\n        } else if (b == 18) {\n          m = 11 + l(V, n, 7);\n          n += 7;\n        }\n\n        var J = I + m;\n\n        while (I < J) {\n          A[I] = Z;\n          I++;\n        }\n      }\n    }\n\n    return n;\n  };\n\n  H.H.V = function (N, W, R, V) {\n    var n = 0,\n        A = 0,\n        l = V.length >>> 1;\n\n    while (A < R) {\n      var M = N[A + W];\n      V[A << 1] = 0;\n      V[(A << 1) + 1] = M;\n      if (M > n) n = M;\n      A++;\n    }\n\n    while (A < l) {\n      V[A << 1] = 0;\n      V[(A << 1) + 1] = 0;\n      A++;\n    }\n\n    return n;\n  };\n\n  H.H.n = function (N, W) {\n    var R = H.H.m,\n        V = N.length,\n        n,\n        A,\n        l,\n        M,\n        I,\n        e = R.j;\n\n    for (var M = 0; M <= W; M++) e[M] = 0;\n\n    for (M = 1; M < V; M += 2) e[N[M]]++;\n\n    var b = R.K;\n    n = 0;\n    e[0] = 0;\n\n    for (A = 1; A <= W; A++) {\n      n = n + e[A - 1] << 1;\n      b[A] = n;\n    }\n\n    for (l = 0; l < V; l += 2) {\n      I = N[l + 1];\n\n      if (I != 0) {\n        N[l] = b[I];\n        b[I]++;\n      }\n    }\n  };\n\n  H.H.A = function (N, W, R) {\n    var V = N.length,\n        n = H.H.m,\n        A = n.r;\n\n    for (var l = 0; l < V; l += 2) if (N[l + 1] != 0) {\n      var M = l >> 1,\n          I = N[l + 1],\n          e = M << 4 | I,\n          b = W - I,\n          Z = N[l] << b,\n          m = Z + (1 << b);\n\n      while (Z != m) {\n        var J = A[Z] >>> 15 - W;\n        R[J] = e;\n        Z++;\n      }\n    }\n  };\n\n  H.H.l = function (N, W) {\n    var R = H.H.m.r,\n        V = 15 - W;\n\n    for (var n = 0; n < N.length; n += 2) {\n      var A = N[n] << W - N[n + 1];\n      N[n] = R[A] >>> V;\n    }\n  };\n\n  H.H.M = function (N, W, R) {\n    R = R << (W & 7);\n    var V = W >>> 3;\n    N[V] |= R;\n    N[V + 1] |= R >>> 8;\n  };\n\n  H.H.I = function (N, W, R) {\n    R = R << (W & 7);\n    var V = W >>> 3;\n    N[V] |= R;\n    N[V + 1] |= R >>> 8;\n    N[V + 2] |= R >>> 16;\n  };\n\n  H.H.e = function (N, W, R) {\n    return (N[W >>> 3] | N[(W >>> 3) + 1] << 8) >>> (W & 7) & (1 << R) - 1;\n  };\n\n  H.H.b = function (N, W, R) {\n    return (N[W >>> 3] | N[(W >>> 3) + 1] << 8 | N[(W >>> 3) + 2] << 16) >>> (W & 7) & (1 << R) - 1;\n  };\n\n  H.H.Z = function (N, W) {\n    return (N[W >>> 3] | N[(W >>> 3) + 1] << 8 | N[(W >>> 3) + 2] << 16) >>> (W & 7);\n  };\n\n  H.H.i = function (N, W) {\n    return (N[W >>> 3] | N[(W >>> 3) + 1] << 8 | N[(W >>> 3) + 2] << 16 | N[(W >>> 3) + 3] << 24) >>> (W & 7);\n  };\n\n  H.H.m = function () {\n    var N = Uint16Array,\n        W = Uint32Array;\n    return {\n      K: new N(16),\n      j: new N(16),\n      X: [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15],\n      S: [3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 999, 999, 999],\n      T: [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 0, 0, 0],\n      q: new N(32),\n      p: [1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577, 65535, 65535],\n      z: [0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, 0, 0],\n      c: new W(32),\n      J: new N(512),\n      _: [],\n      h: new N(32),\n      $: [],\n      w: new N(32768),\n      C: [],\n      v: [],\n      d: new N(32768),\n      D: [],\n      u: new N(512),\n      Q: [],\n      r: new N(1 << 15),\n      s: new W(286),\n      Y: new W(30),\n      a: new W(19),\n      t: new W(15e3),\n      k: new N(1 << 16),\n      g: new N(1 << 15)\n    };\n  }();\n\n  (function () {\n    var N = H.H.m,\n        W = 1 << 15;\n\n    for (var R = 0; R < W; R++) {\n      var V = R;\n      V = (V & 2863311530) >>> 1 | (V & 1431655765) << 1;\n      V = (V & 3435973836) >>> 2 | (V & 858993459) << 2;\n      V = (V & 4042322160) >>> 4 | (V & 252645135) << 4;\n      V = (V & 4278255360) >>> 8 | (V & 16711935) << 8;\n      N.r[R] = (V >>> 16 | V << 16) >>> 17;\n    }\n\n    function n(A, l, M) {\n      while (l-- != 0) A.push(0, M);\n    }\n\n    for (var R = 0; R < 32; R++) {\n      N.q[R] = N.S[R] << 3 | N.T[R];\n      N.c[R] = N.p[R] << 4 | N.z[R];\n    }\n\n    n(N._, 144, 8);\n    n(N._, 255 - 143, 9);\n    n(N._, 279 - 255, 7);\n    n(N._, 287 - 279, 8);\n    H.H.n(N._, 9);\n    H.H.A(N._, 9, N.J);\n    H.H.l(N._, 9);\n    n(N.$, 32, 5);\n    H.H.n(N.$, 5);\n    H.H.A(N.$, 5, N.h);\n    H.H.l(N.$, 5);\n    n(N.Q, 19, 0);\n    n(N.C, 286, 0);\n    n(N.D, 30, 0);\n    n(N.v, 320, 0);\n  })();\n\n  return H.H.N;\n}();\n\nUPNG.decode._readInterlace = function (data, out) {\n  var w = out.width,\n      h = out.height;\n\n  var bpp = UPNG.decode._getBPP(out),\n      cbpp = bpp >> 3,\n      bpl = Math.ceil(w * bpp / 8);\n\n  var img = new Uint8Array(h * bpl);\n  var di = 0;\n  var starting_row = [0, 0, 4, 0, 2, 0, 1];\n  var starting_col = [0, 4, 0, 2, 0, 1, 0];\n  var row_increment = [8, 8, 8, 4, 4, 2, 2];\n  var col_increment = [8, 8, 4, 4, 2, 2, 1];\n  var pass = 0;\n\n  while (pass < 7) {\n    var ri = row_increment[pass],\n        ci = col_increment[pass];\n    var sw = 0,\n        sh = 0;\n    var cr = starting_row[pass];\n\n    while (cr < h) {\n      cr += ri;\n      sh++;\n    }\n\n    var cc = starting_col[pass];\n\n    while (cc < w) {\n      cc += ci;\n      sw++;\n    }\n\n    var bpll = Math.ceil(sw * bpp / 8);\n\n    UPNG.decode._filterZero(data, out, di, sw, sh);\n\n    var y = 0,\n        row = starting_row[pass];\n\n    while (row < h) {\n      var col = starting_col[pass];\n      var cdi = di + y * bpll << 3;\n\n      while (col < w) {\n        if (bpp == 1) {\n          var val = data[cdi >> 3];\n          val = val >> 7 - (cdi & 7) & 1;\n          img[row * bpl + (col >> 3)] |= val << 7 - ((col & 7) << 0);\n        }\n\n        if (bpp == 2) {\n          var val = data[cdi >> 3];\n          val = val >> 6 - (cdi & 7) & 3;\n          img[row * bpl + (col >> 2)] |= val << 6 - ((col & 3) << 1);\n        }\n\n        if (bpp == 4) {\n          var val = data[cdi >> 3];\n          val = val >> 4 - (cdi & 7) & 15;\n          img[row * bpl + (col >> 1)] |= val << 4 - ((col & 1) << 2);\n        }\n\n        if (bpp >= 8) {\n          var ii = row * bpl + col * cbpp;\n\n          for (var j = 0; j < cbpp; j++) img[ii + j] = data[(cdi >> 3) + j];\n        }\n\n        cdi += bpp;\n        col += ci;\n      }\n\n      y++;\n      row += ri;\n    }\n\n    if (sw * sh != 0) di += sh * (1 + bpll);\n    pass = pass + 1;\n  }\n\n  return img;\n};\n\nUPNG.decode._getBPP = function (out) {\n  var noc = [1, null, 3, 1, 2, null, 4][out.ctype];\n  return noc * out.depth;\n};\n\nUPNG.decode._filterZero = function (data, out, off, w, h) {\n  var bpp = UPNG.decode._getBPP(out),\n      bpl = Math.ceil(w * bpp / 8),\n      paeth = UPNG.decode._paeth;\n\n  bpp = Math.ceil(bpp / 8);\n  var i = 0,\n      di = 1,\n      type = data[off],\n      x = 0;\n  if (type > 1) data[off] = [0, 0, 1][type - 2];\n  if (type == 3) for (x = bpp; x < bpl; x++) data[x + 1] = data[x + 1] + (data[x + 1 - bpp] >>> 1) & 255;\n\n  for (var y = 0; y < h; y++) {\n    i = off + y * bpl;\n    di = i + y + 1;\n    type = data[di - 1];\n    x = 0;\n    if (type == 0) for (; x < bpl; x++) data[i + x] = data[di + x];else if (type == 1) {\n      for (; x < bpp; x++) data[i + x] = data[di + x];\n\n      for (; x < bpl; x++) data[i + x] = data[di + x] + data[i + x - bpp];\n    } else if (type == 2) {\n      for (; x < bpl; x++) data[i + x] = data[di + x] + data[i + x - bpl];\n    } else if (type == 3) {\n      for (; x < bpp; x++) data[i + x] = data[di + x] + (data[i + x - bpl] >>> 1);\n\n      for (; x < bpl; x++) data[i + x] = data[di + x] + (data[i + x - bpl] + data[i + x - bpp] >>> 1);\n    } else {\n      for (; x < bpp; x++) data[i + x] = data[di + x] + paeth(0, data[i + x - bpl], 0);\n\n      for (; x < bpl; x++) data[i + x] = data[di + x] + paeth(data[i + x - bpp], data[i + x - bpl], data[i + x - bpp - bpl]);\n    }\n  }\n\n  return data;\n};\n\nUPNG.decode._paeth = function (a, b, c) {\n  var p = a + b - c,\n      pa = p - a,\n      pb = p - b,\n      pc = p - c;\n  if (pa * pa <= pb * pb && pa * pa <= pc * pc) return a;else if (pb * pb <= pc * pc) return b;\n  return c;\n};\n\nUPNG.decode._IHDR = function (data, offset, out) {\n  var bin = UPNG._bin;\n  out.width = bin.readUint(data, offset);\n  offset += 4;\n  out.height = bin.readUint(data, offset);\n  offset += 4;\n  out.depth = data[offset];\n  offset++;\n  out.ctype = data[offset];\n  offset++;\n  out.compress = data[offset];\n  offset++;\n  out.filter = data[offset];\n  offset++;\n  out.interlace = data[offset];\n  offset++;\n};\n\nUPNG._bin = {\n  nextZero: function (data, p) {\n    while (data[p] != 0) p++;\n\n    return p;\n  },\n  readUshort: function (buff, p) {\n    return buff[p] << 8 | buff[p + 1];\n  },\n  writeUshort: function (buff, p, n) {\n    buff[p] = n >> 8 & 255;\n    buff[p + 1] = n & 255;\n  },\n  readUint: function (buff, p) {\n    return buff[p] * (256 * 256 * 256) + (buff[p + 1] << 16 | buff[p + 2] << 8 | buff[p + 3]);\n  },\n  writeUint: function (buff, p, n) {\n    buff[p] = n >> 24 & 255;\n    buff[p + 1] = n >> 16 & 255;\n    buff[p + 2] = n >> 8 & 255;\n    buff[p + 3] = n & 255;\n  },\n  readASCII: function (buff, p, l) {\n    var s = \"\";\n\n    for (var i = 0; i < l; i++) s += String.fromCharCode(buff[p + i]);\n\n    return s;\n  },\n  writeASCII: function (data, p, s) {\n    for (var i = 0; i < s.length; i++) data[p + i] = s.charCodeAt(i);\n  },\n  readBytes: function (buff, p, l) {\n    var arr = [];\n\n    for (var i = 0; i < l; i++) arr.push(buff[p + i]);\n\n    return arr;\n  },\n  pad: function (n) {\n    return n.length < 2 ? \"0\" + n : n;\n  },\n  readUTF8: function (buff, p, l) {\n    var s = \"\",\n        ns;\n\n    for (var i = 0; i < l; i++) s += \"%\" + UPNG._bin.pad(buff[p + i].toString(16));\n\n    try {\n      ns = decodeURIComponent(s);\n    } catch (e) {\n      return UPNG._bin.readASCII(buff, p, l);\n    }\n\n    return ns;\n  }\n};\n\nUPNG._copyTile = function (sb, sw, sh, tb, tw, th, xoff, yoff, mode) {\n  var w = Math.min(sw, tw),\n      h = Math.min(sh, th);\n  var si = 0,\n      ti = 0;\n\n  for (var y = 0; y < h; y++) for (var x = 0; x < w; x++) {\n    if (xoff >= 0 && yoff >= 0) {\n      si = y * sw + x << 2;\n      ti = (yoff + y) * tw + xoff + x << 2;\n    } else {\n      si = (-yoff + y) * sw - xoff + x << 2;\n      ti = y * tw + x << 2;\n    }\n\n    if (mode == 0) {\n      tb[ti] = sb[si];\n      tb[ti + 1] = sb[si + 1];\n      tb[ti + 2] = sb[si + 2];\n      tb[ti + 3] = sb[si + 3];\n    } else if (mode == 1) {\n      var fa = sb[si + 3] * (1 / 255),\n          fr = sb[si] * fa,\n          fg = sb[si + 1] * fa,\n          fb = sb[si + 2] * fa;\n      var ba = tb[ti + 3] * (1 / 255),\n          br = tb[ti] * ba,\n          bg = tb[ti + 1] * ba,\n          bb = tb[ti + 2] * ba;\n      var ifa = 1 - fa,\n          oa = fa + ba * ifa,\n          ioa = oa == 0 ? 0 : 1 / oa;\n      tb[ti + 3] = 255 * oa;\n      tb[ti + 0] = (fr + br * ifa) * ioa;\n      tb[ti + 1] = (fg + bg * ifa) * ioa;\n      tb[ti + 2] = (fb + bb * ifa) * ioa;\n    } else if (mode == 2) {\n      // copy only differences, otherwise zero\n      var fa = sb[si + 3],\n          fr = sb[si],\n          fg = sb[si + 1],\n          fb = sb[si + 2];\n      var ba = tb[ti + 3],\n          br = tb[ti],\n          bg = tb[ti + 1],\n          bb = tb[ti + 2];\n\n      if (fa == ba && fr == br && fg == bg && fb == bb) {\n        tb[ti] = 0;\n        tb[ti + 1] = 0;\n        tb[ti + 2] = 0;\n        tb[ti + 3] = 0;\n      } else {\n        tb[ti] = fr;\n        tb[ti + 1] = fg;\n        tb[ti + 2] = fb;\n        tb[ti + 3] = fa;\n      }\n    } else if (mode == 3) {\n      // check if can be blended\n      var fa = sb[si + 3],\n          fr = sb[si],\n          fg = sb[si + 1],\n          fb = sb[si + 2];\n      var ba = tb[ti + 3],\n          br = tb[ti],\n          bg = tb[ti + 1],\n          bb = tb[ti + 2];\n      if (fa == ba && fr == br && fg == bg && fb == bb) continue; //if(fa!=255 && ba!=0) return false;\n\n      if (fa < 220 && ba > 20) return false;\n    }\n  }\n\n  return true;\n};\n\nUPNG.encode = function (bufs, w, h, ps, dels, tabs, forbidPlte) {\n  if (ps == null) ps = 0;\n  if (forbidPlte == null) forbidPlte = false;\n  var nimg = UPNG.encode.compress(bufs, w, h, ps, [false, false, false, 0, forbidPlte]);\n  UPNG.encode.compressPNG(nimg, -1);\n  return UPNG.encode._main(nimg, w, h, dels, tabs);\n};\n\nUPNG.encodeLL = function (bufs, w, h, cc, ac, depth, dels, tabs) {\n  var nimg = {\n    ctype: 0 + (cc == 1 ? 0 : 2) + (ac == 0 ? 0 : 4),\n    depth: depth,\n    frames: []\n  };\n  var time = Date.now();\n  var bipp = (cc + ac) * depth,\n      bipl = bipp * w;\n\n  for (var i = 0; i < bufs.length; i++) nimg.frames.push({\n    rect: {\n      x: 0,\n      y: 0,\n      width: w,\n      height: h\n    },\n    img: new Uint8Array(bufs[i]),\n    blend: 0,\n    dispose: 1,\n    bpp: Math.ceil(bipp / 8),\n    bpl: Math.ceil(bipl / 8)\n  });\n\n  UPNG.encode.compressPNG(nimg, 0, true);\n\n  var out = UPNG.encode._main(nimg, w, h, dels, tabs);\n\n  return out;\n};\n\nUPNG.encode._main = function (nimg, w, h, dels, tabs) {\n  if (tabs == null) tabs = {};\n  var crc = UPNG.crc.crc,\n      wUi = UPNG._bin.writeUint,\n      wUs = UPNG._bin.writeUshort,\n      wAs = UPNG._bin.writeASCII;\n  var offset = 8,\n      anim = nimg.frames.length > 1,\n      pltAlpha = false;\n  var leng = 8 + (16 + 5 + 4)\n  /*+ (9+4)*/\n  + (anim ? 20 : 0);\n  if (tabs[\"sRGB\"] != null) leng += 8 + 1 + 4;\n  if (tabs[\"pHYs\"] != null) leng += 8 + 9 + 4;\n\n  if (nimg.ctype == 3) {\n    var dl = nimg.plte.length;\n\n    for (var i = 0; i < dl; i++) if (nimg.plte[i] >>> 24 != 255) pltAlpha = true;\n\n    leng += 8 + dl * 3 + 4 + (pltAlpha ? 8 + dl * 1 + 4 : 0);\n  }\n\n  for (var j = 0; j < nimg.frames.length; j++) {\n    var fr = nimg.frames[j];\n    if (anim) leng += 38;\n    leng += fr.cimg.length + 12;\n    if (j != 0) leng += 4;\n  }\n\n  leng += 12;\n  var data = new Uint8Array(leng);\n  var wr = [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a];\n\n  for (var i = 0; i < 8; i++) data[i] = wr[i];\n\n  wUi(data, offset, 13);\n  offset += 4;\n  wAs(data, offset, \"IHDR\");\n  offset += 4;\n  wUi(data, offset, w);\n  offset += 4;\n  wUi(data, offset, h);\n  offset += 4;\n  data[offset] = nimg.depth;\n  offset++; // depth\n\n  data[offset] = nimg.ctype;\n  offset++; // ctype\n\n  data[offset] = 0;\n  offset++; // compress\n\n  data[offset] = 0;\n  offset++; // filter\n\n  data[offset] = 0;\n  offset++; // interlace\n\n  wUi(data, offset, crc(data, offset - 17, 17));\n  offset += 4; // crc\n  // 13 bytes to say, that it is sRGB\n\n  if (tabs[\"sRGB\"] != null) {\n    wUi(data, offset, 1);\n    offset += 4;\n    wAs(data, offset, \"sRGB\");\n    offset += 4;\n    data[offset] = tabs[\"sRGB\"];\n    offset++;\n    wUi(data, offset, crc(data, offset - 5, 5));\n    offset += 4; // crc\n  }\n\n  if (tabs[\"pHYs\"] != null) {\n    wUi(data, offset, 9);\n    offset += 4;\n    wAs(data, offset, \"pHYs\");\n    offset += 4;\n    wUi(data, offset, tabs[\"pHYs\"][0]);\n    offset += 4;\n    wUi(data, offset, tabs[\"pHYs\"][1]);\n    offset += 4;\n    data[offset] = tabs[\"pHYs\"][2];\n    offset++;\n    wUi(data, offset, crc(data, offset - 13, 13));\n    offset += 4; // crc\n  }\n\n  if (anim) {\n    wUi(data, offset, 8);\n    offset += 4;\n    wAs(data, offset, \"acTL\");\n    offset += 4;\n    wUi(data, offset, nimg.frames.length);\n    offset += 4;\n    wUi(data, offset, tabs[\"loop\"] != null ? tabs[\"loop\"] : 0);\n    offset += 4;\n    wUi(data, offset, crc(data, offset - 12, 12));\n    offset += 4; // crc\n  }\n\n  if (nimg.ctype == 3) {\n    var dl = nimg.plte.length;\n    wUi(data, offset, dl * 3);\n    offset += 4;\n    wAs(data, offset, \"PLTE\");\n    offset += 4;\n\n    for (var i = 0; i < dl; i++) {\n      var ti = i * 3,\n          c = nimg.plte[i],\n          r = c & 255,\n          g = c >>> 8 & 255,\n          b = c >>> 16 & 255;\n      data[offset + ti + 0] = r;\n      data[offset + ti + 1] = g;\n      data[offset + ti + 2] = b;\n    }\n\n    offset += dl * 3;\n    wUi(data, offset, crc(data, offset - dl * 3 - 4, dl * 3 + 4));\n    offset += 4; // crc\n\n    if (pltAlpha) {\n      wUi(data, offset, dl);\n      offset += 4;\n      wAs(data, offset, \"tRNS\");\n      offset += 4;\n\n      for (var i = 0; i < dl; i++) data[offset + i] = nimg.plte[i] >>> 24 & 255;\n\n      offset += dl;\n      wUi(data, offset, crc(data, offset - dl - 4, dl + 4));\n      offset += 4; // crc\n    }\n  }\n\n  var fi = 0;\n\n  for (var j = 0; j < nimg.frames.length; j++) {\n    var fr = nimg.frames[j];\n\n    if (anim) {\n      wUi(data, offset, 26);\n      offset += 4;\n      wAs(data, offset, \"fcTL\");\n      offset += 4;\n      wUi(data, offset, fi++);\n      offset += 4;\n      wUi(data, offset, fr.rect.width);\n      offset += 4;\n      wUi(data, offset, fr.rect.height);\n      offset += 4;\n      wUi(data, offset, fr.rect.x);\n      offset += 4;\n      wUi(data, offset, fr.rect.y);\n      offset += 4;\n      wUs(data, offset, dels[j]);\n      offset += 2;\n      wUs(data, offset, 1000);\n      offset += 2;\n      data[offset] = fr.dispose;\n      offset++; // dispose\n\n      data[offset] = fr.blend;\n      offset++; // blend\n\n      wUi(data, offset, crc(data, offset - 30, 30));\n      offset += 4; // crc\n    }\n\n    var imgd = fr.cimg,\n        dl = imgd.length;\n    wUi(data, offset, dl + (j == 0 ? 0 : 4));\n    offset += 4;\n    var ioff = offset;\n    wAs(data, offset, j == 0 ? \"IDAT\" : \"fdAT\");\n    offset += 4;\n\n    if (j != 0) {\n      wUi(data, offset, fi++);\n      offset += 4;\n    }\n\n    data.set(imgd, offset);\n    offset += dl;\n    wUi(data, offset, crc(data, ioff, offset - ioff));\n    offset += 4; // crc\n  }\n\n  wUi(data, offset, 0);\n  offset += 4;\n  wAs(data, offset, \"IEND\");\n  offset += 4;\n  wUi(data, offset, crc(data, offset - 4, 4));\n  offset += 4; // crc\n\n  return data.buffer;\n};\n\nUPNG.encode.compressPNG = function (out, filter, levelZero) {\n  for (var i = 0; i < out.frames.length; i++) {\n    var frm = out.frames[i],\n        nw = frm.rect.width,\n        nh = frm.rect.height;\n    var fdata = new Uint8Array(nh * frm.bpl + nh);\n    frm.cimg = UPNG.encode._filterZero(frm.img, nh, frm.bpp, frm.bpl, fdata, filter, levelZero);\n  }\n};\n\nUPNG.encode.compress = function (bufs, w, h, ps, prms) // prms:  onlyBlend, minBits, forbidPlte\n{\n  //var time = Date.now();\n  var onlyBlend = prms[0],\n      evenCrd = prms[1],\n      forbidPrev = prms[2],\n      minBits = prms[3],\n      forbidPlte = prms[4];\n  var ctype = 6,\n      depth = 8,\n      alphaAnd = 255;\n\n  for (var j = 0; j < bufs.length; j++) {\n    // when not quantized, other frames can contain colors, that are not in an initial frame\n    var img = new Uint8Array(bufs[j]),\n        ilen = img.length;\n\n    for (var i = 0; i < ilen; i += 4) alphaAnd &= img[i + 3];\n  }\n\n  var gotAlpha = alphaAnd != 255; //console.log(\"alpha check\", Date.now()-time);  time = Date.now();\n  //var brute = gotAlpha && forGIF;\t\t// brute : frames can only be copied, not \"blended\"\n\n  var frms = UPNG.encode.framize(bufs, w, h, onlyBlend, evenCrd, forbidPrev); //console.log(\"framize\", Date.now()-time);  time = Date.now();\n\n  var cmap = {},\n      plte = [],\n      inds = [];\n\n  if (ps != 0) {\n    var nbufs = [];\n\n    for (var i = 0; i < frms.length; i++) nbufs.push(frms[i].img.buffer);\n\n    var abuf = UPNG.encode.concatRGBA(nbufs),\n        qres = UPNG.quantize(abuf, ps);\n    var cof = 0,\n        bb = new Uint8Array(qres.abuf);\n\n    for (var i = 0; i < frms.length; i++) {\n      var ti = frms[i].img,\n          bln = ti.length;\n      inds.push(new Uint8Array(qres.inds.buffer, cof >> 2, bln >> 2));\n\n      for (var j = 0; j < bln; j += 4) {\n        ti[j] = bb[cof + j];\n        ti[j + 1] = bb[cof + j + 1];\n        ti[j + 2] = bb[cof + j + 2];\n        ti[j + 3] = bb[cof + j + 3];\n      }\n\n      cof += bln;\n    }\n\n    for (var i = 0; i < qres.plte.length; i++) plte.push(qres.plte[i].est.rgba); //console.log(\"quantize\", Date.now()-time);  time = Date.now();\n\n  } else {\n    // what if ps==0, but there are <=256 colors?  we still need to detect, if the palette could be used\n    for (var j = 0; j < frms.length; j++) {\n      // when not quantized, other frames can contain colors, that are not in an initial frame\n      var frm = frms[j],\n          img32 = new Uint32Array(frm.img.buffer),\n          nw = frm.rect.width,\n          ilen = img32.length;\n      var ind = new Uint8Array(ilen);\n      inds.push(ind);\n\n      for (var i = 0; i < ilen; i++) {\n        var c = img32[i];\n        if (i != 0 && c == img32[i - 1]) ind[i] = ind[i - 1];else if (i > nw && c == img32[i - nw]) ind[i] = ind[i - nw];else {\n          var cmc = cmap[c];\n\n          if (cmc == null) {\n            cmap[c] = cmc = plte.length;\n            plte.push(c);\n            if (plte.length >= 300) break;\n          }\n\n          ind[i] = cmc;\n        }\n      }\n    } //console.log(\"make palette\", Date.now()-time);  time = Date.now();\n\n  }\n\n  var cc = plte.length; //console.log(\"colors:\",cc);\n\n  if (cc <= 256 && forbidPlte == false) {\n    if (cc <= 2) depth = 1;else if (cc <= 4) depth = 2;else if (cc <= 16) depth = 4;else depth = 8;\n    depth = Math.max(depth, minBits);\n  }\n\n  for (var j = 0; j < frms.length; j++) {\n    var frm = frms[j],\n        nx = frm.rect.x,\n        ny = frm.rect.y,\n        nw = frm.rect.width,\n        nh = frm.rect.height;\n    var cimg = frm.img,\n        cimg32 = new Uint32Array(cimg.buffer);\n    var bpl = 4 * nw,\n        bpp = 4;\n\n    if (cc <= 256 && forbidPlte == false) {\n      bpl = Math.ceil(depth * nw / 8);\n      var nimg = new Uint8Array(bpl * nh);\n      var inj = inds[j];\n\n      for (var y = 0; y < nh; y++) {\n        var i = y * bpl,\n            ii = y * nw;\n        if (depth == 8) for (var x = 0; x < nw; x++) nimg[i + x] = inj[ii + x];else if (depth == 4) for (var x = 0; x < nw; x++) nimg[i + (x >> 1)] |= inj[ii + x] << 4 - (x & 1) * 4;else if (depth == 2) for (var x = 0; x < nw; x++) nimg[i + (x >> 2)] |= inj[ii + x] << 6 - (x & 3) * 2;else if (depth == 1) for (var x = 0; x < nw; x++) nimg[i + (x >> 3)] |= inj[ii + x] << 7 - (x & 7) * 1;\n      }\n\n      cimg = nimg;\n      ctype = 3;\n      bpp = 1;\n    } else if (gotAlpha == false && frms.length == 1) {\n      // some next \"reduced\" frames may contain alpha for blending\n      var nimg = new Uint8Array(nw * nh * 3),\n          area = nw * nh;\n\n      for (var i = 0; i < area; i++) {\n        var ti = i * 3,\n            qi = i * 4;\n        nimg[ti] = cimg[qi];\n        nimg[ti + 1] = cimg[qi + 1];\n        nimg[ti + 2] = cimg[qi + 2];\n      }\n\n      cimg = nimg;\n      ctype = 2;\n      bpp = 3;\n      bpl = 3 * nw;\n    }\n\n    frm.img = cimg;\n    frm.bpl = bpl;\n    frm.bpp = bpp;\n  } //console.log(\"colors => palette indices\", Date.now()-time);  time = Date.now();\n\n\n  return {\n    ctype: ctype,\n    depth: depth,\n    plte: plte,\n    frames: frms\n  };\n};\n\nUPNG.encode.framize = function (bufs, w, h, alwaysBlend, evenCrd, forbidPrev) {\n  /*  DISPOSE\r\n      - 0 : no change\r\n  \t- 1 : clear to transparent\r\n  \t- 2 : retstore to content before rendering (previous frame disposed)\r\n  \tBLEND\r\n  \t- 0 : replace\r\n  \t- 1 : blend\r\n  */\n  var frms = [];\n\n  for (var j = 0; j < bufs.length; j++) {\n    var cimg = new Uint8Array(bufs[j]),\n        cimg32 = new Uint32Array(cimg.buffer);\n    var nimg;\n    var nx = 0,\n        ny = 0,\n        nw = w,\n        nh = h,\n        blend = alwaysBlend ? 1 : 0;\n\n    if (j != 0) {\n      var tlim = forbidPrev || alwaysBlend || j == 1 || frms[j - 2].dispose != 0 ? 1 : 2,\n          tstp = 0,\n          tarea = 1e9;\n\n      for (var it = 0; it < tlim; it++) {\n        var pimg = new Uint8Array(bufs[j - 1 - it]),\n            p32 = new Uint32Array(bufs[j - 1 - it]);\n        var mix = w,\n            miy = h,\n            max = -1,\n            may = -1;\n\n        for (var y = 0; y < h; y++) for (var x = 0; x < w; x++) {\n          var i = y * w + x;\n\n          if (cimg32[i] != p32[i]) {\n            if (x < mix) mix = x;\n            if (x > max) max = x;\n            if (y < miy) miy = y;\n            if (y > may) may = y;\n          }\n        }\n\n        if (max == -1) mix = miy = max = may = 0;\n\n        if (evenCrd) {\n          if ((mix & 1) == 1) mix--;\n          if ((miy & 1) == 1) miy--;\n        }\n\n        var sarea = (max - mix + 1) * (may - miy + 1);\n\n        if (sarea < tarea) {\n          tarea = sarea;\n          tstp = it;\n          nx = mix;\n          ny = miy;\n          nw = max - mix + 1;\n          nh = may - miy + 1;\n        }\n      } // alwaysBlend: pokud zjistím, že blendit nelze, nastavím předchozímu snímku dispose=1. Zajistím, aby obsahoval můj obdélník.\n\n\n      var pimg = new Uint8Array(bufs[j - 1 - tstp]);\n      if (tstp == 1) frms[j - 1].dispose = 2;\n      nimg = new Uint8Array(nw * nh * 4);\n\n      UPNG._copyTile(pimg, w, h, nimg, nw, nh, -nx, -ny, 0);\n\n      blend = UPNG._copyTile(cimg, w, h, nimg, nw, nh, -nx, -ny, 3) ? 1 : 0;\n      if (blend == 1) UPNG.encode._prepareDiff(cimg, w, h, nimg, {\n        x: nx,\n        y: ny,\n        width: nw,\n        height: nh\n      });else UPNG._copyTile(cimg, w, h, nimg, nw, nh, -nx, -ny, 0); //UPNG._copyTile(cimg,w,h, nimg,nw,nh, -nx,-ny, blend==1?2:0);\n    } else nimg = cimg.slice(0); // img may be rewritten further ... don't rewrite input\n\n\n    frms.push({\n      rect: {\n        x: nx,\n        y: ny,\n        width: nw,\n        height: nh\n      },\n      img: nimg,\n      blend: blend,\n      dispose: 0\n    });\n  }\n\n  if (alwaysBlend) for (var j = 0; j < frms.length; j++) {\n    var frm = frms[j];\n    if (frm.blend == 1) continue;\n    var r0 = frm.rect,\n        r1 = frms[j - 1].rect;\n    var miX = Math.min(r0.x, r1.x),\n        miY = Math.min(r0.y, r1.y);\n    var maX = Math.max(r0.x + r0.width, r1.x + r1.width),\n        maY = Math.max(r0.y + r0.height, r1.y + r1.height);\n    var r = {\n      x: miX,\n      y: miY,\n      width: maX - miX,\n      height: maY - miY\n    };\n    frms[j - 1].dispose = 1;\n    if (j - 1 != 0) UPNG.encode._updateFrame(bufs, w, h, frms, j - 1, r, evenCrd);\n\n    UPNG.encode._updateFrame(bufs, w, h, frms, j, r, evenCrd);\n  }\n  var area = 0;\n  if (bufs.length != 1) for (var i = 0; i < frms.length; i++) {\n    var frm = frms[i];\n    area += frm.rect.width * frm.rect.height; //if(i==0 || frm.blend!=1) continue;\n    //var ob = new Uint8Array(\n    //console.log(frm.blend, frm.dispose, frm.rect);\n  } //if(area!=0) console.log(area);\n\n  return frms;\n};\n\nUPNG.encode._updateFrame = function (bufs, w, h, frms, i, r, evenCrd) {\n  var U8 = Uint8Array,\n      U32 = Uint32Array;\n  var pimg = new U8(bufs[i - 1]),\n      pimg32 = new U32(bufs[i - 1]),\n      nimg = i + 1 < bufs.length ? new U8(bufs[i + 1]) : null;\n  var cimg = new U8(bufs[i]),\n      cimg32 = new U32(cimg.buffer);\n  var mix = w,\n      miy = h,\n      max = -1,\n      may = -1;\n\n  for (var y = 0; y < r.height; y++) for (var x = 0; x < r.width; x++) {\n    var cx = r.x + x,\n        cy = r.y + y;\n    var j = cy * w + cx,\n        cc = cimg32[j]; // no need to draw transparency, or to dispose it. Or, if writing the same color and the next one does not need transparency.\n\n    if (cc == 0 || frms[i - 1].dispose == 0 && pimg32[j] == cc && (nimg == null || nimg[j * 4 + 3] != 0)\n    /**/\n    ) {} else {\n      if (cx < mix) mix = cx;\n      if (cx > max) max = cx;\n      if (cy < miy) miy = cy;\n      if (cy > may) may = cy;\n    }\n  }\n\n  if (max == -1) mix = miy = max = may = 0;\n\n  if (evenCrd) {\n    if ((mix & 1) == 1) mix--;\n    if ((miy & 1) == 1) miy--;\n  }\n\n  r = {\n    x: mix,\n    y: miy,\n    width: max - mix + 1,\n    height: may - miy + 1\n  };\n  var fr = frms[i];\n  fr.rect = r;\n  fr.blend = 1;\n  fr.img = new Uint8Array(r.width * r.height * 4);\n\n  if (frms[i - 1].dispose == 0) {\n    UPNG._copyTile(pimg, w, h, fr.img, r.width, r.height, -r.x, -r.y, 0);\n\n    UPNG.encode._prepareDiff(cimg, w, h, fr.img, r); //UPNG._copyTile(cimg,w,h, fr.img,r.width,r.height, -r.x,-r.y, 2);\n\n  } else UPNG._copyTile(cimg, w, h, fr.img, r.width, r.height, -r.x, -r.y, 0);\n};\n\nUPNG.encode._prepareDiff = function (cimg, w, h, nimg, rec) {\n  UPNG._copyTile(cimg, w, h, nimg, rec.width, rec.height, -rec.x, -rec.y, 2);\n  /*\r\n  var n32 = new Uint32Array(nimg.buffer);\r\n  var og = new Uint8Array(rec.width*rec.height*4), o32 = new Uint32Array(og.buffer);\r\n  UPNG._copyTile(cimg,w,h, og,rec.width,rec.height, -rec.x,-rec.y, 0);\r\n  for(var i=4; i<nimg.length; i+=4) {\r\n  \tif(nimg[i-1]!=0 && nimg[i+3]==0 && o32[i>>>2]==o32[(i>>>2)-1]) {\r\n  \t\tn32[i>>>2]=o32[i>>>2];\r\n  \t\t//var j = i, c=p32[(i>>>2)-1];\r\n  \t\t//while(p32[j>>>2]==c) {  n32[j>>>2]=c;  j+=4;  }\r\n  \t}\r\n  }\r\n  for(var i=nimg.length-8; i>0; i-=4) {\r\n  \tif(nimg[i+7]!=0 && nimg[i+3]==0 && o32[i>>>2]==o32[(i>>>2)+1]) {\r\n  \t\tn32[i>>>2]=o32[i>>>2];\r\n  \t\t//var j = i, c=p32[(i>>>2)-1];\r\n  \t\t//while(p32[j>>>2]==c) {  n32[j>>>2]=c;  j+=4;  }\r\n  \t}\r\n  }*/\n\n};\n\nUPNG.encode._filterZero = function (img, h, bpp, bpl, data, filter, levelZero) {\n  var fls = [],\n      ftry = [0, 1, 2, 3, 4];\n  if (filter != -1) ftry = [filter];else if (h * bpl > 500000 || bpp == 1) ftry = [0];\n  var opts;\n  if (levelZero) opts = {\n    level: 0\n  };\n  var CMPR = levelZero && UZIP != null ? UZIP : pako;\n\n  for (var i = 0; i < ftry.length; i++) {\n    for (var y = 0; y < h; y++) UPNG.encode._filterLine(data, img, y, bpl, bpp, ftry[i]); //var nimg = new Uint8Array(data.length);\n    //var sz = UZIP.F.deflate(data, nimg);  fls.push(nimg.slice(0,sz));\n    //var dfl = pako[\"deflate\"](data), dl=dfl.length-4;\n    //var crc = (dfl[dl+3]<<24)|(dfl[dl+2]<<16)|(dfl[dl+1]<<8)|(dfl[dl+0]<<0);\n    //console.log(crc, UZIP.adler(data,2,data.length-6));\n\n\n    fls.push(CMPR[\"deflate\"](data, opts));\n  }\n\n  var ti,\n      tsize = 1e9;\n\n  for (var i = 0; i < fls.length; i++) if (fls[i].length < tsize) {\n    ti = i;\n    tsize = fls[i].length;\n  }\n\n  return fls[ti];\n};\n\nUPNG.encode._filterLine = function (data, img, y, bpl, bpp, type) {\n  var i = y * bpl,\n      di = i + y,\n      paeth = UPNG.decode._paeth;\n  data[di] = type;\n  di++;\n\n  if (type == 0) {\n    if (bpl < 500) for (var x = 0; x < bpl; x++) data[di + x] = img[i + x];else data.set(new Uint8Array(img.buffer, i, bpl), di);\n  } else if (type == 1) {\n    for (var x = 0; x < bpp; x++) data[di + x] = img[i + x];\n\n    for (var x = bpp; x < bpl; x++) data[di + x] = img[i + x] - img[i + x - bpp] + 256 & 255;\n  } else if (y == 0) {\n    for (var x = 0; x < bpp; x++) data[di + x] = img[i + x];\n\n    if (type == 2) for (var x = bpp; x < bpl; x++) data[di + x] = img[i + x];\n    if (type == 3) for (var x = bpp; x < bpl; x++) data[di + x] = img[i + x] - (img[i + x - bpp] >> 1) + 256 & 255;\n    if (type == 4) for (var x = bpp; x < bpl; x++) data[di + x] = img[i + x] - paeth(img[i + x - bpp], 0, 0) + 256 & 255;\n  } else {\n    if (type == 2) {\n      for (var x = 0; x < bpl; x++) data[di + x] = img[i + x] + 256 - img[i + x - bpl] & 255;\n    }\n\n    if (type == 3) {\n      for (var x = 0; x < bpp; x++) data[di + x] = img[i + x] + 256 - (img[i + x - bpl] >> 1) & 255;\n\n      for (var x = bpp; x < bpl; x++) data[di + x] = img[i + x] + 256 - (img[i + x - bpl] + img[i + x - bpp] >> 1) & 255;\n    }\n\n    if (type == 4) {\n      for (var x = 0; x < bpp; x++) data[di + x] = img[i + x] + 256 - paeth(0, img[i + x - bpl], 0) & 255;\n\n      for (var x = bpp; x < bpl; x++) data[di + x] = img[i + x] + 256 - paeth(img[i + x - bpp], img[i + x - bpl], img[i + x - bpp - bpl]) & 255;\n    }\n  }\n};\n\nUPNG.crc = {\n  table: function () {\n    var tab = new Uint32Array(256);\n\n    for (var n = 0; n < 256; n++) {\n      var c = n;\n\n      for (var k = 0; k < 8; k++) {\n        if (c & 1) c = 0xedb88320 ^ c >>> 1;else c = c >>> 1;\n      }\n\n      tab[n] = c;\n    }\n\n    return tab;\n  }(),\n  update: function (c, buf, off, len) {\n    for (var i = 0; i < len; i++) c = UPNG.crc.table[(c ^ buf[off + i]) & 0xff] ^ c >>> 8;\n\n    return c;\n  },\n  crc: function (b, o, l) {\n    return UPNG.crc.update(0xffffffff, b, o, l) ^ 0xffffffff;\n  }\n};\n\nUPNG.quantize = function (abuf, ps) {\n  var oimg = new Uint8Array(abuf),\n      nimg = oimg.slice(0),\n      nimg32 = new Uint32Array(nimg.buffer);\n  var KD = UPNG.quantize.getKDtree(nimg, ps);\n  var root = KD[0],\n      leafs = KD[1];\n  var planeDst = UPNG.quantize.planeDst;\n  var sb = oimg,\n      tb = nimg32,\n      len = sb.length;\n  var inds = new Uint8Array(oimg.length >> 2);\n\n  for (var i = 0; i < len; i += 4) {\n    var r = sb[i] * (1 / 255),\n        g = sb[i + 1] * (1 / 255),\n        b = sb[i + 2] * (1 / 255),\n        a = sb[i + 3] * (1 / 255); //  exact, but too slow :(\n\n    var nd = UPNG.quantize.getNearest(root, r, g, b, a); //var nd = root;\n    //while(nd.left) nd = (planeDst(nd.est,r,g,b,a)<=0) ? nd.left : nd.right;\n\n    inds[i >> 2] = nd.ind;\n    tb[i >> 2] = nd.est.rgba;\n  }\n\n  return {\n    abuf: nimg.buffer,\n    inds: inds,\n    plte: leafs\n  };\n};\n\nUPNG.quantize.getKDtree = function (nimg, ps, err) {\n  if (err == null) err = 0.0001;\n  var nimg32 = new Uint32Array(nimg.buffer);\n  var root = {\n    i0: 0,\n    i1: nimg.length,\n    bst: null,\n    est: null,\n    tdst: 0,\n    left: null,\n    right: null\n  }; // basic statistic, extra statistic\n\n  root.bst = UPNG.quantize.stats(nimg, root.i0, root.i1);\n  root.est = UPNG.quantize.estats(root.bst);\n  var leafs = [root];\n\n  while (leafs.length < ps) {\n    var maxL = 0,\n        mi = 0;\n\n    for (var i = 0; i < leafs.length; i++) if (leafs[i].est.L > maxL) {\n      maxL = leafs[i].est.L;\n      mi = i;\n    }\n\n    if (maxL < err) break;\n    var node = leafs[mi];\n    var s0 = UPNG.quantize.splitPixels(nimg, nimg32, node.i0, node.i1, node.est.e, node.est.eMq255);\n    var s0wrong = node.i0 >= s0 || node.i1 <= s0; //console.log(maxL, leafs.length, mi);\n\n    if (s0wrong) {\n      node.est.L = 0;\n      continue;\n    }\n\n    var ln = {\n      i0: node.i0,\n      i1: s0,\n      bst: null,\n      est: null,\n      tdst: 0,\n      left: null,\n      right: null\n    };\n    ln.bst = UPNG.quantize.stats(nimg, ln.i0, ln.i1);\n    ln.est = UPNG.quantize.estats(ln.bst);\n    var rn = {\n      i0: s0,\n      i1: node.i1,\n      bst: null,\n      est: null,\n      tdst: 0,\n      left: null,\n      right: null\n    };\n    rn.bst = {\n      R: [],\n      m: [],\n      N: node.bst.N - ln.bst.N\n    };\n\n    for (var i = 0; i < 16; i++) rn.bst.R[i] = node.bst.R[i] - ln.bst.R[i];\n\n    for (var i = 0; i < 4; i++) rn.bst.m[i] = node.bst.m[i] - ln.bst.m[i];\n\n    rn.est = UPNG.quantize.estats(rn.bst);\n    node.left = ln;\n    node.right = rn;\n    leafs[mi] = ln;\n    leafs.push(rn);\n  }\n\n  leafs.sort(function (a, b) {\n    return b.bst.N - a.bst.N;\n  });\n\n  for (var i = 0; i < leafs.length; i++) leafs[i].ind = i;\n\n  return [root, leafs];\n};\n\nUPNG.quantize.getNearest = function (nd, r, g, b, a) {\n  if (nd.left == null) {\n    nd.tdst = UPNG.quantize.dist(nd.est.q, r, g, b, a);\n    return nd;\n  }\n\n  var planeDst = UPNG.quantize.planeDst(nd.est, r, g, b, a);\n  var node0 = nd.left,\n      node1 = nd.right;\n\n  if (planeDst > 0) {\n    node0 = nd.right;\n    node1 = nd.left;\n  }\n\n  var ln = UPNG.quantize.getNearest(node0, r, g, b, a);\n  if (ln.tdst <= planeDst * planeDst) return ln;\n  var rn = UPNG.quantize.getNearest(node1, r, g, b, a);\n  return rn.tdst < ln.tdst ? rn : ln;\n};\n\nUPNG.quantize.planeDst = function (est, r, g, b, a) {\n  var e = est.e;\n  return e[0] * r + e[1] * g + e[2] * b + e[3] * a - est.eMq;\n};\n\nUPNG.quantize.dist = function (q, r, g, b, a) {\n  var d0 = r - q[0],\n      d1 = g - q[1],\n      d2 = b - q[2],\n      d3 = a - q[3];\n  return d0 * d0 + d1 * d1 + d2 * d2 + d3 * d3;\n};\n\nUPNG.quantize.splitPixels = function (nimg, nimg32, i0, i1, e, eMq) {\n  var vecDot = UPNG.quantize.vecDot;\n  i1 -= 4;\n  var shfs = 0;\n\n  while (i0 < i1) {\n    while (vecDot(nimg, i0, e) <= eMq) i0 += 4;\n\n    while (vecDot(nimg, i1, e) > eMq) i1 -= 4;\n\n    if (i0 >= i1) break;\n    var t = nimg32[i0 >> 2];\n    nimg32[i0 >> 2] = nimg32[i1 >> 2];\n    nimg32[i1 >> 2] = t;\n    i0 += 4;\n    i1 -= 4;\n  }\n\n  while (vecDot(nimg, i0, e) > eMq) i0 -= 4;\n\n  return i0 + 4;\n};\n\nUPNG.quantize.vecDot = function (nimg, i, e) {\n  return nimg[i] * e[0] + nimg[i + 1] * e[1] + nimg[i + 2] * e[2] + nimg[i + 3] * e[3];\n};\n\nUPNG.quantize.stats = function (nimg, i0, i1) {\n  var R = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n  var m = [0, 0, 0, 0];\n  var N = i1 - i0 >> 2;\n\n  for (var i = i0; i < i1; i += 4) {\n    var r = nimg[i] * (1 / 255),\n        g = nimg[i + 1] * (1 / 255),\n        b = nimg[i + 2] * (1 / 255),\n        a = nimg[i + 3] * (1 / 255); //var r = nimg[i], g = nimg[i+1], b = nimg[i+2], a = nimg[i+3];\n\n    m[0] += r;\n    m[1] += g;\n    m[2] += b;\n    m[3] += a;\n    R[0] += r * r;\n    R[1] += r * g;\n    R[2] += r * b;\n    R[3] += r * a;\n    R[5] += g * g;\n    R[6] += g * b;\n    R[7] += g * a;\n    R[10] += b * b;\n    R[11] += b * a;\n    R[15] += a * a;\n  }\n\n  R[4] = R[1];\n  R[8] = R[2];\n  R[9] = R[6];\n  R[12] = R[3];\n  R[13] = R[7];\n  R[14] = R[11];\n  return {\n    R: R,\n    m: m,\n    N: N\n  };\n};\n\nUPNG.quantize.estats = function (stats) {\n  var R = stats.R,\n      m = stats.m,\n      N = stats.N; // when all samples are equal, but N is large (millions), the Rj can be non-zero ( 0.0003.... - precission error)\n\n  var m0 = m[0],\n      m1 = m[1],\n      m2 = m[2],\n      m3 = m[3],\n      iN = N == 0 ? 0 : 1 / N;\n  var Rj = [R[0] - m0 * m0 * iN, R[1] - m0 * m1 * iN, R[2] - m0 * m2 * iN, R[3] - m0 * m3 * iN, R[4] - m1 * m0 * iN, R[5] - m1 * m1 * iN, R[6] - m1 * m2 * iN, R[7] - m1 * m3 * iN, R[8] - m2 * m0 * iN, R[9] - m2 * m1 * iN, R[10] - m2 * m2 * iN, R[11] - m2 * m3 * iN, R[12] - m3 * m0 * iN, R[13] - m3 * m1 * iN, R[14] - m3 * m2 * iN, R[15] - m3 * m3 * iN];\n  var A = Rj,\n      M = UPNG.M4;\n  var b = [0.5, 0.5, 0.5, 0.5],\n      mi = 0,\n      tmi = 0;\n  if (N != 0) for (var i = 0; i < 10; i++) {\n    b = M.multVec(A, b);\n    tmi = Math.sqrt(M.dot(b, b));\n    b = M.sml(1 / tmi, b);\n    if (Math.abs(tmi - mi) < 1e-9) break;\n    mi = tmi;\n  } //b = [0,0,1,0];  mi=N;\n\n  var q = [m0 * iN, m1 * iN, m2 * iN, m3 * iN];\n  var eMq255 = M.dot(M.sml(255, q), b);\n  return {\n    Cov: Rj,\n    q: q,\n    e: b,\n    L: mi,\n    eMq255: eMq255,\n    eMq: M.dot(b, q),\n    rgba: (Math.round(255 * q[3]) << 24 | Math.round(255 * q[2]) << 16 | Math.round(255 * q[1]) << 8 | Math.round(255 * q[0]) << 0) >>> 0\n  };\n};\n\nUPNG.M4 = {\n  multVec: function (m, v) {\n    return [m[0] * v[0] + m[1] * v[1] + m[2] * v[2] + m[3] * v[3], m[4] * v[0] + m[5] * v[1] + m[6] * v[2] + m[7] * v[3], m[8] * v[0] + m[9] * v[1] + m[10] * v[2] + m[11] * v[3], m[12] * v[0] + m[13] * v[1] + m[14] * v[2] + m[15] * v[3]];\n  },\n  dot: function (x, y) {\n    return x[0] * y[0] + x[1] * y[1] + x[2] * y[2] + x[3] * y[3];\n  },\n  sml: function (a, y) {\n    return [a * y[0], a * y[1], a * y[2], a * y[3]];\n  }\n};\n\nUPNG.encode.concatRGBA = function (bufs) {\n  var tlen = 0;\n\n  for (var i = 0; i < bufs.length; i++) tlen += bufs[i].byteLength;\n\n  var nimg = new Uint8Array(tlen),\n      noff = 0;\n\n  for (var i = 0; i < bufs.length; i++) {\n    var img = new Uint8Array(bufs[i]),\n        il = img.length;\n\n    for (var j = 0; j < il; j += 4) {\n      var r = img[j],\n          g = img[j + 1],\n          b = img[j + 2],\n          a = img[j + 3];\n      if (a == 0) r = g = b = 0;\n      nimg[noff + j] = r;\n      nimg[noff + j + 1] = g;\n      nimg[noff + j + 2] = b;\n      nimg[noff + j + 3] = a;\n    }\n\n    noff += il;\n  }\n\n  return nimg.buffer;\n};\n\nexport default UPNG;","map":{"version":3,"sources":["F:/github_repos/instafill/front-end/node_modules/@pdf-lib/upng/UPNG.js"],"names":["pako","UPNG","toRGBA8","out","w","width","h","height","tabs","acTL","decodeImage","data","buffer","frms","frames","len","img","Uint8Array","empty","prev","i","length","frm","fx","rect","x","fy","y","fw","fh","fdata","j","blend","_copyTile","push","slice","dispose","area","bpp","decode","_getBPP","bpl","Math","ceil","bf","bf32","Uint32Array","ctype","depth","rs","_bin","readUshort","time","Date","now","qarea","ts","ti","tr","tg","tb","qi","p","ap","tl","s0","t0","cj","di","gr","off","to","al","buff","offset","bin","rUs","rUi","readUint","dd","doff","fd","foff","mgck","type","readASCII","_IHDR","num_frames","num_plays","fr","_decompress","rct","del","delay","round","nz","nextZero","keyw","text","cflag","cmeth","ltag","tkeyw","readUTF8","readBytes","pl","crc","compress","interlace","filter","_inflate","_filterZero","_readInterlace","inflateRaw","H","N","W","R","m","J","Q","X","u","d","v","C","V","n","b","A","e","l","M","I","Z","D","q","set","byteOffset","E","c","K","r","S","T","z","_","$","s","Y","a","Uint16Array","t","k","g","cbpp","starting_row","starting_col","row_increment","col_increment","pass","ri","ci","sw","sh","cr","cc","bpll","row","col","cdi","val","ii","noc","paeth","_paeth","pa","pb","pc","writeUshort","writeUint","String","fromCharCode","writeASCII","charCodeAt","arr","pad","ns","toString","decodeURIComponent","sb","tw","th","xoff","yoff","mode","min","si","fa","fg","fb","ba","br","bg","bb","ifa","oa","ioa","encode","bufs","ps","dels","forbidPlte","nimg","compressPNG","_main","encodeLL","ac","bipp","bipl","wUi","wUs","wAs","anim","pltAlpha","leng","dl","plte","cimg","wr","fi","imgd","ioff","levelZero","nw","nh","prms","onlyBlend","evenCrd","forbidPrev","minBits","alphaAnd","ilen","gotAlpha","framize","cmap","inds","nbufs","abuf","concatRGBA","qres","quantize","cof","bln","est","rgba","img32","ind","cmc","max","nx","ny","cimg32","inj","alwaysBlend","tlim","tstp","tarea","it","pimg","p32","mix","miy","may","sarea","_prepareDiff","r0","r1","miX","miY","maX","maY","_updateFrame","U8","U32","pimg32","cx","cy","rec","fls","ftry","opts","level","CMPR","UZIP","_filterLine","tsize","table","tab","update","buf","o","oimg","nimg32","KD","getKDtree","root","leafs","planeDst","nd","getNearest","err","i0","i1","bst","tdst","left","right","stats","estats","maxL","mi","L","node","splitPixels","eMq255","s0wrong","ln","rn","sort","dist","node0","node1","eMq","d0","d1","d2","d3","vecDot","shfs","m0","m1","m2","m3","iN","Rj","M4","tmi","multVec","sqrt","dot","sml","abs","Cov","tlen","byteLength","noff","il"],"mappings":"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","sourcesContent":["import pako from 'pako';\r\n\r\nvar UPNG = {};\r\n\r\n\t\r\n\r\nUPNG.toRGBA8 = function(out)\r\n{\r\n\tvar w = out.width, h = out.height;\r\n\tif(out.tabs.acTL==null) return [UPNG.toRGBA8.decodeImage(out.data, w, h, out).buffer];\r\n\t\r\n\tvar frms = [];\r\n\tif(out.frames[0].data==null) out.frames[0].data = out.data;\r\n\t\r\n\tvar len = w*h*4, img = new Uint8Array(len), empty = new Uint8Array(len), prev=new Uint8Array(len);\r\n\tfor(var i=0; i<out.frames.length; i++)\r\n\t{\r\n\t\tvar frm = out.frames[i];\r\n\t\tvar fx=frm.rect.x, fy=frm.rect.y, fw = frm.rect.width, fh = frm.rect.height;\r\n\t\tvar fdata = UPNG.toRGBA8.decodeImage(frm.data, fw,fh, out);\r\n\t\t\r\n\t\tif(i!=0) for(var j=0; j<len; j++) prev[j]=img[j];\r\n\t\t\r\n\t\tif     (frm.blend==0) UPNG._copyTile(fdata, fw, fh, img, w, h, fx, fy, 0);\r\n\t\telse if(frm.blend==1) UPNG._copyTile(fdata, fw, fh, img, w, h, fx, fy, 1);\r\n\t\t\r\n\t\tfrms.push(img.buffer.slice(0));\r\n\t\t\r\n\t\tif     (frm.dispose==0) {}\r\n\t\telse if(frm.dispose==1) UPNG._copyTile(empty, fw, fh, img, w, h, fx, fy, 0);\r\n\t\telse if(frm.dispose==2) for(var j=0; j<len; j++) img[j]=prev[j];\r\n\t}\r\n\treturn frms;\r\n}\r\nUPNG.toRGBA8.decodeImage = function(data, w, h, out)\r\n{\r\n\tvar area = w*h, bpp = UPNG.decode._getBPP(out);\r\n\tvar bpl = Math.ceil(w*bpp/8);\t// bytes per line\r\n\r\n\tvar bf = new Uint8Array(area*4), bf32 = new Uint32Array(bf.buffer);\r\n\tvar ctype = out.ctype, depth = out.depth;\r\n\tvar rs = UPNG._bin.readUshort;\r\n\t\r\n\t//console.log(ctype, depth);\r\n\tvar time = Date.now();\r\n\r\n\tif     (ctype==6) { // RGB + alpha\r\n\t\tvar qarea = area<<2;\r\n\t\tif(depth== 8) for(var i=0; i<qarea;i+=4) {  bf[i] = data[i];  bf[i+1] = data[i+1];  bf[i+2] = data[i+2];  bf[i+3] = data[i+3]; }\r\n\t\tif(depth==16) for(var i=0; i<qarea;i++ ) {  bf[i] = data[i<<1];  }\r\n\t}\r\n\telse if(ctype==2) {\t// RGB\r\n\t\tvar ts=out.tabs[\"tRNS\"];\r\n\t\tif(ts==null) {\r\n\t\t\tif(depth== 8) for(var i=0; i<area; i++) {  var ti=i*3;  bf32[i] = (255<<24)|(data[ti+2]<<16)|(data[ti+1]<<8)|data[ti];  }\r\n\t\t\tif(depth==16) for(var i=0; i<area; i++) {  var ti=i*6;  bf32[i] = (255<<24)|(data[ti+4]<<16)|(data[ti+2]<<8)|data[ti];  }\r\n\t\t}\r\n\t\telse {  var tr=ts[0], tg=ts[1], tb=ts[2];\r\n\t\t\tif(depth== 8) for(var i=0; i<area; i++) {  var qi=i<<2, ti=i*3;  bf32[i] = (255<<24)|(data[ti+2]<<16)|(data[ti+1]<<8)|data[ti];\r\n\t\t\t\tif(data[ti]   ==tr && data[ti+1]   ==tg && data[ti+2]   ==tb) bf[qi+3] = 0;  }\r\n\t\t\tif(depth==16) for(var i=0; i<area; i++) {  var qi=i<<2, ti=i*6;  bf32[i] = (255<<24)|(data[ti+4]<<16)|(data[ti+2]<<8)|data[ti];\r\n\t\t\t\tif(rs(data,ti)==tr && rs(data,ti+2)==tg && rs(data,ti+4)==tb) bf[qi+3] = 0;  }\r\n\t\t}\r\n\t}\r\n\telse if(ctype==3) {\t// palette\r\n\t\tvar p=out.tabs[\"PLTE\"], ap=out.tabs[\"tRNS\"], tl=ap?ap.length:0;\r\n\t\t//console.log(p, ap);\r\n\t\tif(depth==1) for(var y=0; y<h; y++) {  var s0 = y*bpl, t0 = y*w;\r\n\t\t\tfor(var i=0; i<w; i++) { var qi=(t0+i)<<2, j=((data[s0+(i>>3)]>>(7-((i&7)<<0)))& 1), cj=3*j;  bf[qi]=p[cj];  bf[qi+1]=p[cj+1];  bf[qi+2]=p[cj+2];  bf[qi+3]=(j<tl)?ap[j]:255;  }\r\n\t\t}\r\n\t\tif(depth==2) for(var y=0; y<h; y++) {  var s0 = y*bpl, t0 = y*w;\r\n\t\t\tfor(var i=0; i<w; i++) { var qi=(t0+i)<<2, j=((data[s0+(i>>2)]>>(6-((i&3)<<1)))& 3), cj=3*j;  bf[qi]=p[cj];  bf[qi+1]=p[cj+1];  bf[qi+2]=p[cj+2];  bf[qi+3]=(j<tl)?ap[j]:255;  }\r\n\t\t}\r\n\t\tif(depth==4) for(var y=0; y<h; y++) {  var s0 = y*bpl, t0 = y*w;\r\n\t\t\tfor(var i=0; i<w; i++) { var qi=(t0+i)<<2, j=((data[s0+(i>>1)]>>(4-((i&1)<<2)))&15), cj=3*j;  bf[qi]=p[cj];  bf[qi+1]=p[cj+1];  bf[qi+2]=p[cj+2];  bf[qi+3]=(j<tl)?ap[j]:255;  }\r\n\t\t}\r\n\t\tif(depth==8) for(var i=0; i<area; i++ ) {  var qi=i<<2, j=data[i]                      , cj=3*j;  bf[qi]=p[cj];  bf[qi+1]=p[cj+1];  bf[qi+2]=p[cj+2];  bf[qi+3]=(j<tl)?ap[j]:255;  }\r\n\t}\r\n\telse if(ctype==4) {\t// gray + alpha\r\n\t\tif(depth== 8)  for(var i=0; i<area; i++) {  var qi=i<<2, di=i<<1, gr=data[di];  bf[qi]=gr;  bf[qi+1]=gr;  bf[qi+2]=gr;  bf[qi+3]=data[di+1];  }\r\n\t\tif(depth==16)  for(var i=0; i<area; i++) {  var qi=i<<2, di=i<<2, gr=data[di];  bf[qi]=gr;  bf[qi+1]=gr;  bf[qi+2]=gr;  bf[qi+3]=data[di+2];  }\r\n\t}\r\n\telse if(ctype==0) {\t// gray\r\n\t\tvar tr = out.tabs[\"tRNS\"] ? out.tabs[\"tRNS\"] : -1;\r\n\t\tfor(var y=0; y<h; y++) {\r\n\t\t\tvar off = y*bpl, to = y*w;\r\n\t\t\tif     (depth== 1) for(var x=0; x<w; x++) {  var gr=255*((data[off+(x>>>3)]>>>(7 -((x&7)   )))& 1), al=(gr==tr*255)?0:255;  bf32[to+x]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\r\n\t\t\telse if(depth== 2) for(var x=0; x<w; x++) {  var gr= 85*((data[off+(x>>>2)]>>>(6 -((x&3)<<1)))& 3), al=(gr==tr* 85)?0:255;  bf32[to+x]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\r\n\t\t\telse if(depth== 4) for(var x=0; x<w; x++) {  var gr= 17*((data[off+(x>>>1)]>>>(4 -((x&1)<<2)))&15), al=(gr==tr* 17)?0:255;  bf32[to+x]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\r\n\t\t\telse if(depth== 8) for(var x=0; x<w; x++) {  var gr=data[off+     x], al=(gr                 ==tr)?0:255;  bf32[to+x]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\r\n\t\t\telse if(depth==16) for(var x=0; x<w; x++) {  var gr=data[off+(x<<1)], al=(rs(data,off+(x<<i))==tr)?0:255;  bf32[to+x]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\r\n\t\t}\r\n\t}\r\n\t//console.log(Date.now()-time);\r\n\treturn bf;\r\n}\r\n\r\n\r\n\r\nUPNG.decode = function(buff)\r\n{\r\n\tvar data = new Uint8Array(buff), offset = 8, bin = UPNG._bin, rUs = bin.readUshort, rUi = bin.readUint;\r\n\tvar out = {tabs:{}, frames:[]};\r\n\tvar dd = new Uint8Array(data.length), doff = 0;\t // put all IDAT data into it\r\n\tvar fd, foff = 0;\t// frames\r\n\t\r\n\tvar mgck = [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a];\r\n\tfor(var i=0; i<8; i++) if(data[i]!=mgck[i]) throw \"The input is not a PNG file!\";\r\n\r\n\twhile(offset<data.length)\r\n\t{\r\n\t\tvar len  = bin.readUint(data, offset);  offset += 4;\r\n\t\tvar type = bin.readASCII(data, offset, 4);  offset += 4;\r\n\t\t//console.log(type,len);\r\n\t\t\r\n\t\tif     (type==\"IHDR\")  {  UPNG.decode._IHDR(data, offset, out);  }\r\n\t\telse if(type==\"IDAT\") {\r\n\t\t\tfor(var i=0; i<len; i++) dd[doff+i] = data[offset+i];\r\n\t\t\tdoff += len;\r\n\t\t}\r\n\t\telse if(type==\"acTL\")  {\r\n\t\t\tout.tabs[type] = {  num_frames:rUi(data, offset), num_plays:rUi(data, offset+4)  };\r\n\t\t\tfd = new Uint8Array(data.length);\r\n\t\t}\r\n\t\telse if(type==\"fcTL\")  {\r\n\t\t\tif(foff!=0) {  var fr = out.frames[out.frames.length-1];\r\n\t\t\t\tfr.data = UPNG.decode._decompress(out, fd.slice(0,foff), fr.rect.width, fr.rect.height);  foff=0;\r\n\t\t\t}\r\n\t\t\tvar rct = {x:rUi(data, offset+12),y:rUi(data, offset+16),width:rUi(data, offset+4),height:rUi(data, offset+8)};\r\n\t\t\tvar del = rUs(data, offset+22);  del = rUs(data, offset+20) / (del==0?100:del);\r\n\t\t\tvar frm = {rect:rct, delay:Math.round(del*1000), dispose:data[offset+24], blend:data[offset+25]};\r\n\t\t\t//console.log(frm);\r\n\t\t\tout.frames.push(frm);\r\n\t\t}\r\n\t\telse if(type==\"fdAT\") {\r\n\t\t\tfor(var i=0; i<len-4; i++) fd[foff+i] = data[offset+i+4];\r\n\t\t\tfoff += len-4;\r\n\t\t}\r\n\t\telse if(type==\"pHYs\") {\r\n\t\t\tout.tabs[type] = [bin.readUint(data, offset), bin.readUint(data, offset+4), data[offset+8]];\r\n\t\t}\r\n\t\telse if(type==\"cHRM\") {\r\n\t\t\tout.tabs[type] = [];\r\n\t\t\tfor(var i=0; i<8; i++) out.tabs[type].push(bin.readUint(data, offset+i*4));\r\n\t\t}\r\n\t\telse if(type==\"tEXt\") {\r\n\t\t\tif(out.tabs[type]==null) out.tabs[type] = {};\r\n\t\t\tvar nz = bin.nextZero(data, offset);\r\n\t\t\tvar keyw = bin.readASCII(data, offset, nz-offset);\r\n\t\t\tvar text = bin.readASCII(data, nz+1, offset+len-nz-1);\r\n\t\t\tout.tabs[type][keyw] = text;\r\n\t\t}\r\n\t\telse if(type==\"iTXt\") {\r\n\t\t\tif(out.tabs[type]==null) out.tabs[type] = {};\r\n\t\t\tvar nz = 0, off = offset;\r\n\t\t\tnz = bin.nextZero(data, off);\r\n\t\t\tvar keyw = bin.readASCII(data, off, nz-off);  off = nz + 1;\r\n\t\t\tvar cflag = data[off], cmeth = data[off+1];  off+=2;\r\n\t\t\tnz = bin.nextZero(data, off);\r\n\t\t\tvar ltag = bin.readASCII(data, off, nz-off);  off = nz + 1;\r\n\t\t\tnz = bin.nextZero(data, off);\r\n\t\t\tvar tkeyw = bin.readUTF8(data, off, nz-off);  off = nz + 1;\r\n\t\t\tvar text  = bin.readUTF8(data, off, len-(off-offset));\r\n\t\t\tout.tabs[type][keyw] = text;\r\n\t\t}\r\n\t\telse if(type==\"PLTE\") {\r\n\t\t\tout.tabs[type] = bin.readBytes(data, offset, len);\r\n\t\t}\r\n\t\telse if(type==\"hIST\") {\r\n\t\t\tvar pl = out.tabs[\"PLTE\"].length/3;\r\n\t\t\tout.tabs[type] = [];  for(var i=0; i<pl; i++) out.tabs[type].push(rUs(data, offset+i*2));\r\n\t\t}\r\n\t\telse if(type==\"tRNS\") {\r\n\t\t\tif     (out.ctype==3) out.tabs[type] = bin.readBytes(data, offset, len);\r\n\t\t\telse if(out.ctype==0) out.tabs[type] = rUs(data, offset);\r\n\t\t\telse if(out.ctype==2) out.tabs[type] = [ rUs(data,offset),rUs(data,offset+2),rUs(data,offset+4) ];\r\n\t\t\t//else console.log(\"tRNS for unsupported color type\",out.ctype, len);\r\n\t\t}\r\n\t\telse if(type==\"gAMA\") out.tabs[type] = bin.readUint(data, offset)/100000;\r\n\t\telse if(type==\"sRGB\") out.tabs[type] = data[offset];\r\n\t\telse if(type==\"bKGD\")\r\n\t\t{\r\n\t\t\tif     (out.ctype==0 || out.ctype==4) out.tabs[type] = [rUs(data, offset)];\r\n\t\t\telse if(out.ctype==2 || out.ctype==6) out.tabs[type] = [rUs(data, offset), rUs(data, offset+2), rUs(data, offset+4)];\r\n\t\t\telse if(out.ctype==3) out.tabs[type] = data[offset];\r\n\t\t}\r\n\t\telse if(type==\"IEND\") {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t//else {  log(\"unknown chunk type\", type, len);  }\r\n\t\toffset += len;\r\n\t\tvar crc = bin.readUint(data, offset);  offset += 4;\r\n\t}\r\n\tif(foff!=0) {  var fr = out.frames[out.frames.length-1];\r\n\t\tfr.data = UPNG.decode._decompress(out, fd.slice(0,foff), fr.rect.width, fr.rect.height);  foff=0;\r\n\t}\t\r\n\tout.data = UPNG.decode._decompress(out, dd, out.width, out.height);\r\n\t\r\n\tdelete out.compress;  delete out.interlace;  delete out.filter;\r\n\treturn out;\r\n}\r\n\r\nUPNG.decode._decompress = function(out, dd, w, h) {\r\n\tvar time = Date.now();\r\n\tvar bpp = UPNG.decode._getBPP(out), bpl = Math.ceil(w*bpp/8), buff = new Uint8Array((bpl+1+out.interlace)*h);\r\n\tdd = UPNG.decode._inflate(dd,buff);\r\n\t//console.log(dd.length, buff.length);\r\n\t//console.log(Date.now()-time);\r\n\r\n\tvar time=Date.now();\r\n\tif     (out.interlace==0) dd = UPNG.decode._filterZero(dd, out, 0, w, h);\r\n\telse if(out.interlace==1) dd = UPNG.decode._readInterlace(dd, out);\r\n\t//console.log(Date.now()-time);\r\n\treturn dd;\r\n}\r\n\r\nUPNG.decode._inflate = function(data, buff) {  var out=UPNG[\"inflateRaw\"](new Uint8Array(data.buffer, 2,data.length-6),buff);  return out;  }\r\nUPNG.inflateRaw=function(){var H={};H.H={};H.H.N=function(N,W){var R=Uint8Array,i=0,m=0,J=0,h=0,Q=0,X=0,u=0,w=0,d=0,v,C;\r\nif(N[0]==3&&N[1]==0)return W?W:new R(0);var V=H.H,n=V.b,A=V.e,l=V.R,M=V.n,I=V.A,e=V.Z,b=V.m,Z=W==null;\r\nif(Z)W=new R(N.length>>>2<<3);while(i==0){i=n(N,d,1);m=n(N,d+1,2);d+=3;if(m==0){if((d&7)!=0)d+=8-(d&7);\r\nvar D=(d>>>3)+4,q=N[D-4]|N[D-3]<<8;if(Z)W=H.H.W(W,w+q);W.set(new R(N.buffer,N.byteOffset+D,q),w);d=D+q<<3;\r\nw+=q;continue}if(Z)W=H.H.W(W,w+(1<<17));if(m==1){v=b.J;C=b.h;X=(1<<9)-1;u=(1<<5)-1}if(m==2){J=A(N,d,5)+257;\r\nh=A(N,d+5,5)+1;Q=A(N,d+10,4)+4;d+=14;var E=d,j=1;for(var c=0;c<38;c+=2){b.Q[c]=0;b.Q[c+1]=0}for(var c=0;\r\nc<Q;c++){var K=A(N,d+c*3,3);b.Q[(b.X[c]<<1)+1]=K;if(K>j)j=K}d+=3*Q;M(b.Q,j);I(b.Q,j,b.u);v=b.w;C=b.d;\r\nd=l(b.u,(1<<j)-1,J+h,N,d,b.v);var r=V.V(b.v,0,J,b.C);X=(1<<r)-1;var S=V.V(b.v,J,h,b.D);u=(1<<S)-1;M(b.C,r);\r\nI(b.C,r,v);M(b.D,S);I(b.D,S,C)}while(!0){var T=v[e(N,d)&X];d+=T&15;var p=T>>>4;if(p>>>8==0){W[w++]=p}else if(p==256){break}else{var z=w+p-254;\r\nif(p>264){var _=b.q[p-257];z=w+(_>>>3)+A(N,d,_&7);d+=_&7}var $=C[e(N,d)&u];d+=$&15;var s=$>>>4,Y=b.c[s],a=(Y>>>4)+n(N,d,Y&15);\r\nd+=Y&15;while(w<z){W[w]=W[w++-a];W[w]=W[w++-a];W[w]=W[w++-a];W[w]=W[w++-a]}w=z}}}return W.length==w?W:W.slice(0,w)};\r\nH.H.W=function(N,W){var R=N.length;if(W<=R)return N;var V=new Uint8Array(R<<1);V.set(N,0);return V};\r\nH.H.R=function(N,W,R,V,n,A){var l=H.H.e,M=H.H.Z,I=0;while(I<R){var e=N[M(V,n)&W];n+=e&15;var b=e>>>4;\r\nif(b<=15){A[I]=b;I++}else{var Z=0,m=0;if(b==16){m=3+l(V,n,2);n+=2;Z=A[I-1]}else if(b==17){m=3+l(V,n,3);\r\nn+=3}else if(b==18){m=11+l(V,n,7);n+=7}var J=I+m;while(I<J){A[I]=Z;I++}}}return n};H.H.V=function(N,W,R,V){var n=0,A=0,l=V.length>>>1;\r\nwhile(A<R){var M=N[A+W];V[A<<1]=0;V[(A<<1)+1]=M;if(M>n)n=M;A++}while(A<l){V[A<<1]=0;V[(A<<1)+1]=0;A++}return n};\r\nH.H.n=function(N,W){var R=H.H.m,V=N.length,n,A,l,M,I,e=R.j;for(var M=0;M<=W;M++)e[M]=0;for(M=1;M<V;M+=2)e[N[M]]++;\r\nvar b=R.K;n=0;e[0]=0;for(A=1;A<=W;A++){n=n+e[A-1]<<1;b[A]=n}for(l=0;l<V;l+=2){I=N[l+1];if(I!=0){N[l]=b[I];\r\nb[I]++}}};H.H.A=function(N,W,R){var V=N.length,n=H.H.m,A=n.r;for(var l=0;l<V;l+=2)if(N[l+1]!=0){var M=l>>1,I=N[l+1],e=M<<4|I,b=W-I,Z=N[l]<<b,m=Z+(1<<b);\r\nwhile(Z!=m){var J=A[Z]>>>15-W;R[J]=e;Z++}}};H.H.l=function(N,W){var R=H.H.m.r,V=15-W;for(var n=0;n<N.length;\r\nn+=2){var A=N[n]<<W-N[n+1];N[n]=R[A]>>>V}};H.H.M=function(N,W,R){R=R<<(W&7);var V=W>>>3;N[V]|=R;N[V+1]|=R>>>8};\r\nH.H.I=function(N,W,R){R=R<<(W&7);var V=W>>>3;N[V]|=R;N[V+1]|=R>>>8;N[V+2]|=R>>>16};H.H.e=function(N,W,R){return(N[W>>>3]|N[(W>>>3)+1]<<8)>>>(W&7)&(1<<R)-1};\r\nH.H.b=function(N,W,R){return(N[W>>>3]|N[(W>>>3)+1]<<8|N[(W>>>3)+2]<<16)>>>(W&7)&(1<<R)-1};H.H.Z=function(N,W){return(N[W>>>3]|N[(W>>>3)+1]<<8|N[(W>>>3)+2]<<16)>>>(W&7)};\r\nH.H.i=function(N,W){return(N[W>>>3]|N[(W>>>3)+1]<<8|N[(W>>>3)+2]<<16|N[(W>>>3)+3]<<24)>>>(W&7)};H.H.m=function(){var N=Uint16Array,W=Uint32Array;\r\nreturn{K:new N(16),j:new N(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new N(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new W(32),J:new N(512),_:[],h:new N(32),$:[],w:new N(32768),C:[],v:[],d:new N(32768),D:[],u:new N(512),Q:[],r:new N(1<<15),s:new W(286),Y:new W(30),a:new W(19),t:new W(15e3),k:new N(1<<16),g:new N(1<<15)}}();\r\n(function(){var N=H.H.m,W=1<<15;for(var R=0;R<W;R++){var V=R;V=(V&2863311530)>>>1|(V&1431655765)<<1;\r\nV=(V&3435973836)>>>2|(V&858993459)<<2;V=(V&4042322160)>>>4|(V&252645135)<<4;V=(V&4278255360)>>>8|(V&16711935)<<8;\r\nN.r[R]=(V>>>16|V<<16)>>>17}function n(A,l,M){while(l--!=0)A.push(0,M)}for(var R=0;R<32;R++){N.q[R]=N.S[R]<<3|N.T[R];\r\nN.c[R]=N.p[R]<<4|N.z[R]}n(N._,144,8);n(N._,255-143,9);n(N._,279-255,7);n(N._,287-279,8);H.H.n(N._,9);\r\nH.H.A(N._,9,N.J);H.H.l(N._,9);n(N.$,32,5);H.H.n(N.$,5);H.H.A(N.$,5,N.h);H.H.l(N.$,5);n(N.Q,19,0);n(N.C,286,0);\r\nn(N.D,30,0);n(N.v,320,0)}());return H.H.N}()\r\n\r\n\r\nUPNG.decode._readInterlace = function(data, out)\r\n{\r\n\tvar w = out.width, h = out.height;\r\n\tvar bpp = UPNG.decode._getBPP(out), cbpp = bpp>>3, bpl = Math.ceil(w*bpp/8);\r\n\tvar img = new Uint8Array( h * bpl );\r\n\tvar di = 0;\r\n\r\n\tvar starting_row  = [ 0, 0, 4, 0, 2, 0, 1 ];\r\n\tvar starting_col  = [ 0, 4, 0, 2, 0, 1, 0 ];\r\n\tvar row_increment = [ 8, 8, 8, 4, 4, 2, 2 ];\r\n\tvar col_increment = [ 8, 8, 4, 4, 2, 2, 1 ];\r\n\r\n\tvar pass=0;\r\n\twhile(pass<7)\r\n\t{\r\n\t\tvar ri = row_increment[pass], ci = col_increment[pass];\r\n\t\tvar sw = 0, sh = 0;\r\n\t\tvar cr = starting_row[pass];  while(cr<h) {  cr+=ri;  sh++;  }\r\n\t\tvar cc = starting_col[pass];  while(cc<w) {  cc+=ci;  sw++;  }\r\n\t\tvar bpll = Math.ceil(sw*bpp/8);\r\n\t\tUPNG.decode._filterZero(data, out, di, sw, sh);\r\n\r\n\t\tvar y=0, row = starting_row[pass];\r\n\t\twhile(row<h)\r\n\t\t{\r\n\t\t\tvar col = starting_col[pass];\r\n\t\t\tvar cdi = (di+y*bpll)<<3;\r\n\r\n\t\t\twhile(col<w)\r\n\t\t\t{\r\n\t\t\t\tif(bpp==1) {\r\n\t\t\t\t\tvar val = data[cdi>>3];  val = (val>>(7-(cdi&7)))&1;\r\n\t\t\t\t\timg[row*bpl + (col>>3)] |= (val << (7-((col&7)<<0)));\r\n\t\t\t\t}\r\n\t\t\t\tif(bpp==2) {\r\n\t\t\t\t\tvar val = data[cdi>>3];  val = (val>>(6-(cdi&7)))&3;\r\n\t\t\t\t\timg[row*bpl + (col>>2)] |= (val << (6-((col&3)<<1)));\r\n\t\t\t\t}\r\n\t\t\t\tif(bpp==4) {\r\n\t\t\t\t\tvar val = data[cdi>>3];  val = (val>>(4-(cdi&7)))&15;\r\n\t\t\t\t\timg[row*bpl + (col>>1)] |= (val << (4-((col&1)<<2)));\r\n\t\t\t\t}\r\n\t\t\t\tif(bpp>=8) {\r\n\t\t\t\t\tvar ii = row*bpl+col*cbpp;\r\n\t\t\t\t\tfor(var j=0; j<cbpp; j++) img[ii+j] = data[(cdi>>3)+j];\r\n\t\t\t\t}\r\n\t\t\t\tcdi+=bpp;  col+=ci;\r\n\t\t\t}\r\n\t\t\ty++;  row += ri;\r\n\t\t}\r\n\t\tif(sw*sh!=0) di += sh * (1 + bpll);\r\n\t\tpass = pass + 1;\r\n\t}\r\n\treturn img;\r\n}\r\n\r\nUPNG.decode._getBPP = function(out) {\r\n\tvar noc = [1,null,3,1,2,null,4][out.ctype];\r\n\treturn noc * out.depth;\r\n}\r\n\r\nUPNG.decode._filterZero = function(data, out, off, w, h)\r\n{\r\n\tvar bpp = UPNG.decode._getBPP(out), bpl = Math.ceil(w*bpp/8), paeth = UPNG.decode._paeth;\r\n\tbpp = Math.ceil(bpp/8);\r\n\t\r\n\tvar i=0, di=1, type=data[off], x=0;\r\n\t\r\n\tif(type>1) data[off]=[0,0,1][type-2];  \r\n\tif(type==3) for(x=bpp; x<bpl; x++) data[x+1] = (data[x+1] + (data[x+1-bpp]>>>1) )&255;\r\n\r\n\tfor(var y=0; y<h; y++)  {\r\n\t\ti = off+y*bpl; di = i+y+1;\r\n\t\ttype = data[di-1]; x=0;\r\n\r\n\t\tif     (type==0)   for(; x<bpl; x++) data[i+x] = data[di+x];\r\n\t\telse if(type==1) { for(; x<bpp; x++) data[i+x] = data[di+x];\r\n\t\t\t\t\t\t   for(; x<bpl; x++) data[i+x] = (data[di+x] + data[i+x-bpp]);  }\r\n\t\telse if(type==2) { for(; x<bpl; x++) data[i+x] = (data[di+x] + data[i+x-bpl]);  }\r\n\t\telse if(type==3) { for(; x<bpp; x++) data[i+x] = (data[di+x] + ( data[i+x-bpl]>>>1));\r\n\t\t\t               for(; x<bpl; x++) data[i+x] = (data[di+x] + ((data[i+x-bpl]+data[i+x-bpp])>>>1) );  }\r\n\t\telse             { for(; x<bpp; x++) data[i+x] = (data[di+x] + paeth(0, data[i+x-bpl], 0));\r\n\t\t\t\t\t\t   for(; x<bpl; x++) data[i+x] = (data[di+x] + paeth(data[i+x-bpp], data[i+x-bpl], data[i+x-bpp-bpl]) );  }\r\n\t}\r\n\treturn data;\r\n}\r\n\r\nUPNG.decode._paeth = function(a,b,c)\r\n{\r\n\tvar p = a+b-c, pa = (p-a), pb = (p-b), pc = (p-c);\r\n\tif (pa*pa <= pb*pb && pa*pa <= pc*pc)  return a;\r\n\telse if (pb*pb <= pc*pc)  return b;\r\n\treturn c;\r\n}\r\n\r\nUPNG.decode._IHDR = function(data, offset, out)\r\n{\r\n\tvar bin = UPNG._bin;\r\n\tout.width  = bin.readUint(data, offset);  offset += 4;\r\n\tout.height = bin.readUint(data, offset);  offset += 4;\r\n\tout.depth     = data[offset];  offset++;\r\n\tout.ctype     = data[offset];  offset++;\r\n\tout.compress  = data[offset];  offset++;\r\n\tout.filter    = data[offset];  offset++;\r\n\tout.interlace = data[offset];  offset++;\r\n}\r\n\r\nUPNG._bin = {\r\n\tnextZero   : function(data,p)  {  while(data[p]!=0) p++;  return p;  },\r\n\treadUshort : function(buff,p)  {  return (buff[p]<< 8) | buff[p+1];  },\r\n\twriteUshort: function(buff,p,n){  buff[p] = (n>>8)&255;  buff[p+1] = n&255;  },\r\n\treadUint   : function(buff,p)  {  return (buff[p]*(256*256*256)) + ((buff[p+1]<<16) | (buff[p+2]<< 8) | buff[p+3]);  },\r\n\twriteUint  : function(buff,p,n){  buff[p]=(n>>24)&255;  buff[p+1]=(n>>16)&255;  buff[p+2]=(n>>8)&255;  buff[p+3]=n&255;  },\r\n\treadASCII  : function(buff,p,l){  var s = \"\";  for(var i=0; i<l; i++) s += String.fromCharCode(buff[p+i]);  return s;    },\r\n\twriteASCII : function(data,p,s){  for(var i=0; i<s.length; i++) data[p+i] = s.charCodeAt(i);  },\r\n\treadBytes  : function(buff,p,l){  var arr = [];   for(var i=0; i<l; i++) arr.push(buff[p+i]);   return arr;  },\r\n\tpad : function(n) { return n.length < 2 ? \"0\" + n : n; },\r\n\treadUTF8 : function(buff, p, l) {\r\n\t\tvar s = \"\", ns;\r\n\t\tfor(var i=0; i<l; i++) s += \"%\" + UPNG._bin.pad(buff[p+i].toString(16));\r\n\t\ttry {  ns = decodeURIComponent(s); }\r\n\t\tcatch(e) {  return UPNG._bin.readASCII(buff, p, l);  }\r\n\t\treturn  ns;\r\n\t}\r\n}\r\nUPNG._copyTile = function(sb, sw, sh, tb, tw, th, xoff, yoff, mode)\r\n{\r\n\tvar w = Math.min(sw,tw), h = Math.min(sh,th);\r\n\tvar si=0, ti=0;\r\n\tfor(var y=0; y<h; y++)\r\n\t\tfor(var x=0; x<w; x++)\r\n\t\t{\r\n\t\t\tif(xoff>=0 && yoff>=0) {  si = (y*sw+x)<<2;  ti = (( yoff+y)*tw+xoff+x)<<2;  }\r\n\t\t\telse                   {  si = ((-yoff+y)*sw-xoff+x)<<2;  ti = (y*tw+x)<<2;  }\r\n\t\t\t\r\n\t\t\tif     (mode==0) {  tb[ti] = sb[si];  tb[ti+1] = sb[si+1];  tb[ti+2] = sb[si+2];  tb[ti+3] = sb[si+3];  }\r\n\t\t\telse if(mode==1) {\r\n\t\t\t\tvar fa = sb[si+3]*(1/255), fr=sb[si]*fa, fg=sb[si+1]*fa, fb=sb[si+2]*fa; \r\n\t\t\t\tvar ba = tb[ti+3]*(1/255), br=tb[ti]*ba, bg=tb[ti+1]*ba, bb=tb[ti+2]*ba; \r\n\t\t\t\t\r\n\t\t\t\tvar ifa=1-fa, oa = fa+ba*ifa, ioa = (oa==0?0:1/oa);\r\n\t\t\t\ttb[ti+3] = 255*oa;  \r\n\t\t\t\ttb[ti+0] = (fr+br*ifa)*ioa;  \r\n\t\t\t\ttb[ti+1] = (fg+bg*ifa)*ioa;   \r\n\t\t\t\ttb[ti+2] = (fb+bb*ifa)*ioa;  \r\n\t\t\t}\r\n\t\t\telse if(mode==2){\t// copy only differences, otherwise zero\r\n\t\t\t\tvar fa = sb[si+3], fr=sb[si], fg=sb[si+1], fb=sb[si+2]; \r\n\t\t\t\tvar ba = tb[ti+3], br=tb[ti], bg=tb[ti+1], bb=tb[ti+2]; \r\n\t\t\t\tif(fa==ba && fr==br && fg==bg && fb==bb) {  tb[ti]=0;  tb[ti+1]=0;  tb[ti+2]=0;  tb[ti+3]=0;  }\r\n\t\t\t\telse {  tb[ti]=fr;  tb[ti+1]=fg;  tb[ti+2]=fb;  tb[ti+3]=fa;  }\r\n\t\t\t}\r\n\t\t\telse if(mode==3){\t// check if can be blended\r\n\t\t\t\tvar fa = sb[si+3], fr=sb[si], fg=sb[si+1], fb=sb[si+2]; \r\n\t\t\t\tvar ba = tb[ti+3], br=tb[ti], bg=tb[ti+1], bb=tb[ti+2]; \r\n\t\t\t\tif(fa==ba && fr==br && fg==bg && fb==bb) continue;\r\n\t\t\t\t//if(fa!=255 && ba!=0) return false;\r\n\t\t\t\tif(fa<220 && ba>20) return false;\r\n\t\t\t}\r\n\t\t}\r\n\treturn true;\r\n}\r\n\r\n\r\n\r\n\r\nUPNG.encode = function(bufs, w, h, ps, dels, tabs, forbidPlte)\r\n{\r\n\tif(ps==null) ps=0;\r\n\tif(forbidPlte==null) forbidPlte = false;\r\n\r\n\tvar nimg = UPNG.encode.compress(bufs, w, h, ps, [false, false, false, 0, forbidPlte]);\r\n\tUPNG.encode.compressPNG(nimg, -1);\r\n\t\r\n\treturn UPNG.encode._main(nimg, w, h, dels, tabs);\r\n}\r\n\r\nUPNG.encodeLL = function(bufs, w, h, cc, ac, depth, dels, tabs) {\r\n\tvar nimg = {  ctype: 0 + (cc==1 ? 0 : 2) + (ac==0 ? 0 : 4),      depth: depth,  frames: []  };\r\n\t\r\n\tvar time = Date.now();\r\n\tvar bipp = (cc+ac)*depth, bipl = bipp * w;\r\n\tfor(var i=0; i<bufs.length; i++)\r\n\t\tnimg.frames.push({  rect:{x:0,y:0,width:w,height:h},  img:new Uint8Array(bufs[i]), blend:0, dispose:1, bpp:Math.ceil(bipp/8), bpl:Math.ceil(bipl/8)  });\r\n\t\r\n\tUPNG.encode.compressPNG(nimg, 0, true);\r\n\t\r\n\tvar out = UPNG.encode._main(nimg, w, h, dels, tabs);\r\n\treturn out;\r\n}\r\n\r\nUPNG.encode._main = function(nimg, w, h, dels, tabs) {\r\n\tif(tabs==null) tabs={};\r\n\tvar crc = UPNG.crc.crc, wUi = UPNG._bin.writeUint, wUs = UPNG._bin.writeUshort, wAs = UPNG._bin.writeASCII;\r\n\tvar offset = 8, anim = nimg.frames.length>1, pltAlpha = false;\r\n\t\r\n\tvar leng = 8 + (16+5+4) /*+ (9+4)*/ + (anim ? 20 : 0);\r\n\tif(tabs[\"sRGB\"]!=null) leng += 8+1+4;\r\n\tif(tabs[\"pHYs\"]!=null) leng += 8+9+4;\r\n\tif(nimg.ctype==3) {\r\n\t\tvar dl = nimg.plte.length;\r\n\t\tfor(var i=0; i<dl; i++) if((nimg.plte[i]>>>24)!=255) pltAlpha = true;\r\n\t\tleng += (8 + dl*3 + 4) + (pltAlpha ? (8 + dl*1 + 4) : 0);\r\n\t}\r\n\tfor(var j=0; j<nimg.frames.length; j++)\r\n\t{\r\n\t\tvar fr = nimg.frames[j];\r\n\t\tif(anim) leng += 38;\r\n\t\tleng += fr.cimg.length + 12;\r\n\t\tif(j!=0) leng+=4;\r\n\t}\r\n\tleng += 12; \r\n\t\r\n\tvar data = new Uint8Array(leng);\r\n\tvar wr=[0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a];\r\n\tfor(var i=0; i<8; i++) data[i]=wr[i];\r\n\t\r\n\twUi(data,offset, 13);     offset+=4;\r\n\twAs(data,offset,\"IHDR\");  offset+=4;\r\n\twUi(data,offset,w);  offset+=4;\r\n\twUi(data,offset,h);  offset+=4;\r\n\tdata[offset] = nimg.depth;  offset++;  // depth\r\n\tdata[offset] = nimg.ctype;  offset++;  // ctype\r\n\tdata[offset] = 0;  offset++;  // compress\r\n\tdata[offset] = 0;  offset++;  // filter\r\n\tdata[offset] = 0;  offset++;  // interlace\r\n\twUi(data,offset,crc(data,offset-17,17));  offset+=4; // crc\r\n\r\n\t// 13 bytes to say, that it is sRGB\r\n\tif(tabs[\"sRGB\"]!=null) {\r\n\t\twUi(data,offset, 1);      offset+=4;\r\n\t\twAs(data,offset,\"sRGB\");  offset+=4;\r\n\t\tdata[offset] = tabs[\"sRGB\"];  offset++;\r\n\t\twUi(data,offset,crc(data,offset-5,5));  offset+=4; // crc\r\n\t}\r\n\tif(tabs[\"pHYs\"]!=null) {\r\n\t\twUi(data,offset, 9);      offset+=4;\r\n\t\twAs(data,offset,\"pHYs\");  offset+=4;\r\n\t\twUi(data,offset, tabs[\"pHYs\"][0]);      offset+=4;\r\n\t\twUi(data,offset, tabs[\"pHYs\"][1]);      offset+=4;\r\n\t\tdata[offset]=tabs[\"pHYs\"][2];\t\t\toffset++;\r\n\t\twUi(data,offset,crc(data,offset-13,13));  offset+=4; // crc\r\n\t}\r\n\r\n\tif(anim) {\r\n\t\twUi(data,offset, 8);      offset+=4;\r\n\t\twAs(data,offset,\"acTL\");  offset+=4;\r\n\t\twUi(data,offset, nimg.frames.length);     offset+=4;\r\n\t\twUi(data,offset, tabs[\"loop\"]!=null?tabs[\"loop\"]:0);      offset+=4;\r\n\t\twUi(data,offset,crc(data,offset-12,12));  offset+=4; // crc\r\n\t}\r\n\r\n\tif(nimg.ctype==3) {\r\n\t\tvar dl = nimg.plte.length;\r\n\t\twUi(data,offset, dl*3);  offset+=4;\r\n\t\twAs(data,offset,\"PLTE\");  offset+=4;\r\n\t\tfor(var i=0; i<dl; i++){\r\n\t\t\tvar ti=i*3, c=nimg.plte[i], r=(c)&255, g=(c>>>8)&255, b=(c>>>16)&255;\r\n\t\t\tdata[offset+ti+0]=r;  data[offset+ti+1]=g;  data[offset+ti+2]=b;\r\n\t\t}\r\n\t\toffset+=dl*3;\r\n\t\twUi(data,offset,crc(data,offset-dl*3-4,dl*3+4));  offset+=4; // crc\r\n\r\n\t\tif(pltAlpha) {\r\n\t\t\twUi(data,offset, dl);  offset+=4;\r\n\t\t\twAs(data,offset,\"tRNS\");  offset+=4;\r\n\t\t\tfor(var i=0; i<dl; i++)  data[offset+i]=(nimg.plte[i]>>>24)&255;\r\n\t\t\toffset+=dl;\r\n\t\t\twUi(data,offset,crc(data,offset-dl-4,dl+4));  offset+=4; // crc\r\n\t\t}\r\n\t}\r\n\t\r\n\tvar fi = 0;\r\n\tfor(var j=0; j<nimg.frames.length; j++)\r\n\t{\r\n\t\tvar fr = nimg.frames[j];\r\n\t\tif(anim) {\r\n\t\t\twUi(data, offset, 26);     offset+=4;\r\n\t\t\twAs(data, offset,\"fcTL\");  offset+=4;\r\n\t\t\twUi(data, offset, fi++);   offset+=4;\r\n\t\t\twUi(data, offset, fr.rect.width );   offset+=4;\r\n\t\t\twUi(data, offset, fr.rect.height);   offset+=4;\r\n\t\t\twUi(data, offset, fr.rect.x);   offset+=4;\r\n\t\t\twUi(data, offset, fr.rect.y);   offset+=4;\r\n\t\t\twUs(data, offset, dels[j]);   offset+=2;\r\n\t\t\twUs(data, offset,  1000);   offset+=2;\r\n\t\t\tdata[offset] = fr.dispose;  offset++;\t// dispose\r\n\t\t\tdata[offset] = fr.blend  ;  offset++;\t// blend\r\n\t\t\twUi(data,offset,crc(data,offset-30,30));  offset+=4; // crc\r\n\t\t}\r\n\t\t\t\t\r\n\t\tvar imgd = fr.cimg, dl = imgd.length;\r\n\t\twUi(data,offset, dl+(j==0?0:4));     offset+=4;\r\n\t\tvar ioff = offset;\r\n\t\twAs(data,offset,(j==0)?\"IDAT\":\"fdAT\");  offset+=4;\r\n\t\tif(j!=0) {  wUi(data, offset, fi++);  offset+=4;  }\r\n\t\tdata.set(imgd,offset);\r\n\t\toffset += dl;\r\n\t\twUi(data,offset,crc(data,ioff,offset-ioff));  offset+=4; // crc\r\n\t}\r\n\r\n\twUi(data,offset, 0);     offset+=4;\r\n\twAs(data,offset,\"IEND\");  offset+=4;\r\n\twUi(data,offset,crc(data,offset-4,4));  offset+=4; // crc\r\n\r\n\treturn data.buffer;\r\n}\r\n\r\nUPNG.encode.compressPNG = function(out, filter, levelZero) {\r\n\tfor(var i=0; i<out.frames.length; i++) {\r\n\t\tvar frm = out.frames[i], nw=frm.rect.width, nh=frm.rect.height;\r\n\t\tvar fdata = new Uint8Array(nh*frm.bpl+nh);\r\n\t\tfrm.cimg = UPNG.encode._filterZero(frm.img,nh,frm.bpp,frm.bpl,fdata, filter, levelZero);\r\n\t}\r\n}\r\n\r\n\r\n\r\nUPNG.encode.compress = function(bufs, w, h, ps, prms) // prms:  onlyBlend, minBits, forbidPlte\r\n{\r\n\t//var time = Date.now();\r\n\tvar onlyBlend = prms[0], evenCrd = prms[1], forbidPrev = prms[2], minBits = prms[3], forbidPlte = prms[4];\r\n\t\r\n\tvar ctype = 6, depth = 8, alphaAnd=255\r\n\t\r\n\tfor(var j=0; j<bufs.length; j++)  {  // when not quantized, other frames can contain colors, that are not in an initial frame\r\n\t\tvar img = new Uint8Array(bufs[j]), ilen = img.length;\r\n\t\tfor(var i=0; i<ilen; i+=4) alphaAnd &= img[i+3];\r\n\t}\r\n\tvar gotAlpha = (alphaAnd!=255);\r\n\t\r\n\t//console.log(\"alpha check\", Date.now()-time);  time = Date.now();\r\n\t\r\n\t//var brute = gotAlpha && forGIF;\t\t// brute : frames can only be copied, not \"blended\"\r\n\tvar frms = UPNG.encode.framize(bufs, w, h, onlyBlend, evenCrd, forbidPrev);\r\n\t//console.log(\"framize\", Date.now()-time);  time = Date.now();\r\n\t\r\n\tvar cmap={}, plte=[], inds=[];  \r\n\t\r\n\tif(ps!=0) {\r\n\t\tvar nbufs = [];  for(var i=0; i<frms.length; i++) nbufs.push(frms[i].img.buffer);\r\n\t\t\r\n\t\tvar abuf = UPNG.encode.concatRGBA(nbufs), qres = UPNG.quantize(abuf, ps);  \r\n\t\tvar cof = 0, bb = new Uint8Array(qres.abuf);\r\n\t\tfor(var i=0; i<frms.length; i++) {  var ti=frms[i].img, bln=ti.length;  inds.push(new Uint8Array(qres.inds.buffer, cof>>2, bln>>2));\r\n\t\t\tfor(var j=0; j<bln; j+=4) {  ti[j]=bb[cof+j];  ti[j+1]=bb[cof+j+1];  ti[j+2]=bb[cof+j+2];  ti[j+3]=bb[cof+j+3];  }    cof+=bln;  }\r\n\t\t\r\n\t\tfor(var i=0; i<qres.plte.length; i++) plte.push(qres.plte[i].est.rgba);\r\n\t\t//console.log(\"quantize\", Date.now()-time);  time = Date.now();\r\n\t}\r\n\telse {\r\n\t\t// what if ps==0, but there are <=256 colors?  we still need to detect, if the palette could be used\r\n\t\tfor(var j=0; j<frms.length; j++)  {  // when not quantized, other frames can contain colors, that are not in an initial frame\r\n\t\t\tvar frm = frms[j], img32 = new Uint32Array(frm.img.buffer), nw=frm.rect.width, ilen = img32.length;\r\n\t\t\tvar ind = new Uint8Array(ilen);  inds.push(ind);\r\n\t\t\tfor(var i=0; i<ilen; i++) {\r\n\t\t\t\tvar c = img32[i];\r\n\t\t\t\tif     (i!=0 && c==img32[i- 1]) ind[i]=ind[i-1];\r\n\t\t\t\telse if(i>nw && c==img32[i-nw]) ind[i]=ind[i-nw];\r\n\t\t\t\telse {\r\n\t\t\t\t\tvar cmc = cmap[c];\r\n\t\t\t\t\tif(cmc==null) {  cmap[c]=cmc=plte.length;  plte.push(c);  if(plte.length>=300) break;  }\r\n\t\t\t\t\tind[i]=cmc;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log(\"make palette\", Date.now()-time);  time = Date.now();\r\n\t}\r\n\t\r\n\tvar cc=plte.length; //console.log(\"colors:\",cc);\r\n\tif(cc<=256 && forbidPlte==false) {\r\n\t\tif(cc<= 2) depth=1;  else if(cc<= 4) depth=2;  else if(cc<=16) depth=4;  else depth=8;\r\n\t\tdepth =  Math.max(depth, minBits);\r\n\t}\r\n\t\r\n\tfor(var j=0; j<frms.length; j++)\r\n\t{\r\n\t\tvar frm = frms[j], nx=frm.rect.x, ny=frm.rect.y, nw=frm.rect.width, nh=frm.rect.height;\r\n\t\tvar cimg = frm.img, cimg32 = new Uint32Array(cimg.buffer);\r\n\t\tvar bpl = 4*nw, bpp=4;\r\n\t\tif(cc<=256 && forbidPlte==false) {\r\n\t\t\tbpl = Math.ceil(depth*nw/8);\r\n\t\t\tvar nimg = new Uint8Array(bpl*nh);\r\n\t\t\tvar inj = inds[j];\r\n\t\t\tfor(var y=0; y<nh; y++) {  var i=y*bpl, ii=y*nw;\r\n\t\t\t\tif     (depth==8) for(var x=0; x<nw; x++) nimg[i+(x)   ]   =  (inj[ii+x]             );\r\n\t\t\t\telse if(depth==4) for(var x=0; x<nw; x++) nimg[i+(x>>1)]  |=  (inj[ii+x]<<(4-(x&1)*4));\r\n\t\t\t\telse if(depth==2) for(var x=0; x<nw; x++) nimg[i+(x>>2)]  |=  (inj[ii+x]<<(6-(x&3)*2));\r\n\t\t\t\telse if(depth==1) for(var x=0; x<nw; x++) nimg[i+(x>>3)]  |=  (inj[ii+x]<<(7-(x&7)*1));\r\n\t\t\t}\r\n\t\t\tcimg=nimg;  ctype=3;  bpp=1;\r\n\t\t}\r\n\t\telse if(gotAlpha==false && frms.length==1) {\t// some next \"reduced\" frames may contain alpha for blending\r\n\t\t\tvar nimg = new Uint8Array(nw*nh*3), area=nw*nh;\r\n\t\t\tfor(var i=0; i<area; i++) { var ti=i*3, qi=i*4;  nimg[ti]=cimg[qi];  nimg[ti+1]=cimg[qi+1];  nimg[ti+2]=cimg[qi+2];  }\r\n\t\t\tcimg=nimg;  ctype=2;  bpp=3;  bpl=3*nw;\r\n\t\t}\r\n\t\tfrm.img=cimg;  frm.bpl=bpl;  frm.bpp=bpp;\r\n\t}\r\n\t//console.log(\"colors => palette indices\", Date.now()-time);  time = Date.now();\r\n\t\r\n\treturn {ctype:ctype, depth:depth, plte:plte, frames:frms  };\r\n}\r\nUPNG.encode.framize = function(bufs,w,h,alwaysBlend,evenCrd,forbidPrev) {\r\n\t/*  DISPOSE\r\n\t    - 0 : no change\r\n\t\t- 1 : clear to transparent\r\n\t\t- 2 : retstore to content before rendering (previous frame disposed)\r\n\t\tBLEND\r\n\t\t- 0 : replace\r\n\t\t- 1 : blend\r\n\t*/\r\n\tvar frms = [];\r\n\tfor(var j=0; j<bufs.length; j++) {\r\n\t\tvar cimg = new Uint8Array(bufs[j]), cimg32 = new Uint32Array(cimg.buffer);\r\n\t\tvar nimg;\r\n\t\t\r\n\t\tvar nx=0, ny=0, nw=w, nh=h, blend=alwaysBlend?1:0;\r\n\t\tif(j!=0) {\r\n\t\t\tvar tlim = (forbidPrev || alwaysBlend || j==1 || frms[j-2].dispose!=0)?1:2, tstp = 0, tarea = 1e9;\r\n\t\t\tfor(var it=0; it<tlim; it++)\r\n\t\t\t{\r\n\t\t\t\tvar pimg = new Uint8Array(bufs[j-1-it]), p32 = new Uint32Array(bufs[j-1-it]);\r\n\t\t\t\tvar mix=w,miy=h,max=-1,may=-1;\r\n\t\t\t\tfor(var y=0; y<h; y++) for(var x=0; x<w; x++) {\r\n\t\t\t\t\tvar i = y*w+x;\r\n\t\t\t\t\tif(cimg32[i]!=p32[i]) {\r\n\t\t\t\t\t\tif(x<mix) mix=x;  if(x>max) max=x;\r\n\t\t\t\t\t\tif(y<miy) miy=y;  if(y>may) may=y;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(max==-1) mix=miy=max=may=0;\r\n\t\t\t\tif(evenCrd) {  if((mix&1)==1)mix--;  if((miy&1)==1)miy--;  }\r\n\t\t\t\tvar sarea = (max-mix+1)*(may-miy+1);\r\n\t\t\t\tif(sarea<tarea) {\r\n\t\t\t\t\ttarea = sarea;  tstp = it;\r\n\t\t\t\t\tnx = mix; ny = miy; nw = max-mix+1; nh = may-miy+1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// alwaysBlend: pokud zjistím, že blendit nelze, nastavím předchozímu snímku dispose=1. Zajistím, aby obsahoval můj obdélník.\r\n\t\t\tvar pimg = new Uint8Array(bufs[j-1-tstp]);\r\n\t\t\tif(tstp==1) frms[j-1].dispose = 2;\r\n\t\t\t\r\n\t\t\tnimg = new Uint8Array(nw*nh*4);\r\n\t\t\tUPNG._copyTile(pimg,w,h, nimg,nw,nh, -nx,-ny, 0);\r\n\t\t\t\r\n\t\t\tblend =  UPNG._copyTile(cimg,w,h, nimg,nw,nh, -nx,-ny, 3) ? 1 : 0;\r\n\t\t\tif(blend==1) UPNG.encode._prepareDiff(cimg,w,h,nimg,{x:nx,y:ny,width:nw,height:nh});\r\n\t\t\telse         UPNG._copyTile(cimg,w,h, nimg,nw,nh, -nx,-ny, 0);\r\n\t\t\t//UPNG._copyTile(cimg,w,h, nimg,nw,nh, -nx,-ny, blend==1?2:0);\r\n\t\t}\r\n\t\telse nimg = cimg.slice(0);\t// img may be rewritten further ... don't rewrite input\r\n\t\t\r\n\t\tfrms.push({rect:{x:nx,y:ny,width:nw,height:nh}, img:nimg, blend:blend, dispose:0});\r\n\t}\r\n\t\r\n\t\r\n\tif(alwaysBlend) for(var j=0; j<frms.length; j++) {\r\n\t\tvar frm = frms[j];  if(frm.blend==1) continue;\r\n\t\tvar r0 = frm.rect, r1 = frms[j-1].rect\r\n\t\tvar miX = Math.min(r0.x, r1.x), miY = Math.min(r0.y, r1.y);\r\n\t\tvar maX = Math.max(r0.x+r0.width, r1.x+r1.width), maY = Math.max(r0.y+r0.height, r1.y+r1.height);\r\n\t\tvar r = {x:miX, y:miY, width:maX-miX, height:maY-miY};\r\n\t\t\r\n\t\tfrms[j-1].dispose = 1;\r\n\t\tif(j-1!=0) \r\n\t\tUPNG.encode._updateFrame(bufs, w,h,frms, j-1,r, evenCrd);\r\n\t\tUPNG.encode._updateFrame(bufs, w,h,frms, j  ,r, evenCrd);\r\n\t}\r\n\tvar area = 0;\r\n\tif(bufs.length!=1) for(var i=0; i<frms.length; i++) {\r\n\t\tvar frm = frms[i];\r\n\t\tarea += frm.rect.width*frm.rect.height;\r\n\t\t//if(i==0 || frm.blend!=1) continue;\r\n\t\t//var ob = new Uint8Array(\r\n\t\t//console.log(frm.blend, frm.dispose, frm.rect);\r\n\t}\r\n\t//if(area!=0) console.log(area);\r\n\treturn frms;\r\n}\r\nUPNG.encode._updateFrame = function(bufs, w,h, frms, i, r, evenCrd) {\r\n\tvar U8 = Uint8Array, U32 = Uint32Array;\r\n\tvar pimg = new U8(bufs[i-1]), pimg32 = new U32(bufs[i-1]), nimg = i+1<bufs.length ? new U8(bufs[i+1]):null;\r\n\tvar cimg = new U8(bufs[i]), cimg32 = new U32(cimg.buffer);\r\n\t\r\n\tvar mix=w,miy=h,max=-1,may=-1;\r\n\tfor(var y=0; y<r.height; y++) for(var x=0; x<r.width; x++) {\r\n\t\tvar cx = r.x+x, cy = r.y+y;\r\n\t\tvar j = cy*w+cx, cc = cimg32[j];\r\n\t\t// no need to draw transparency, or to dispose it. Or, if writing the same color and the next one does not need transparency.\r\n\t\tif(cc==0 || (frms[i-1].dispose==0 && pimg32[j]==cc && (nimg==null || nimg[j*4+3]!=0))/**/) {}\r\n\t\telse {\r\n\t\t\tif(cx<mix) mix=cx;  if(cx>max) max=cx;\r\n\t\t\tif(cy<miy) miy=cy;  if(cy>may) may=cy;\r\n\t\t}\r\n\t}\r\n\tif(max==-1) mix=miy=max=may=0;\r\n\tif(evenCrd) {  if((mix&1)==1)mix--;  if((miy&1)==1)miy--;  }\r\n\tr = {x:mix, y:miy, width:max-mix+1, height:may-miy+1};\r\n\t\r\n\tvar fr = frms[i];  fr.rect = r;  fr.blend = 1;  fr.img = new Uint8Array(r.width*r.height*4);\r\n\tif(frms[i-1].dispose==0) {\r\n\t\tUPNG._copyTile(pimg,w,h, fr.img,r.width,r.height, -r.x,-r.y, 0);\r\n\t\tUPNG.encode._prepareDiff(cimg,w,h,fr.img,r);\r\n\t\t//UPNG._copyTile(cimg,w,h, fr.img,r.width,r.height, -r.x,-r.y, 2);\r\n\t}\r\n\telse\r\n\t\tUPNG._copyTile(cimg,w,h, fr.img,r.width,r.height, -r.x,-r.y, 0);\r\n}\r\nUPNG.encode._prepareDiff = function(cimg, w,h, nimg, rec) {\r\n\tUPNG._copyTile(cimg,w,h, nimg,rec.width,rec.height, -rec.x,-rec.y, 2);\r\n\t/*\r\n\tvar n32 = new Uint32Array(nimg.buffer);\r\n\tvar og = new Uint8Array(rec.width*rec.height*4), o32 = new Uint32Array(og.buffer);\r\n\tUPNG._copyTile(cimg,w,h, og,rec.width,rec.height, -rec.x,-rec.y, 0);\r\n\tfor(var i=4; i<nimg.length; i+=4) {\r\n\t\tif(nimg[i-1]!=0 && nimg[i+3]==0 && o32[i>>>2]==o32[(i>>>2)-1]) {\r\n\t\t\tn32[i>>>2]=o32[i>>>2];\r\n\t\t\t//var j = i, c=p32[(i>>>2)-1];\r\n\t\t\t//while(p32[j>>>2]==c) {  n32[j>>>2]=c;  j+=4;  }\r\n\t\t}\r\n\t}\r\n\tfor(var i=nimg.length-8; i>0; i-=4) {\r\n\t\tif(nimg[i+7]!=0 && nimg[i+3]==0 && o32[i>>>2]==o32[(i>>>2)+1]) {\r\n\t\t\tn32[i>>>2]=o32[i>>>2];\r\n\t\t\t//var j = i, c=p32[(i>>>2)-1];\r\n\t\t\t//while(p32[j>>>2]==c) {  n32[j>>>2]=c;  j+=4;  }\r\n\t\t}\r\n\t}*/\r\n}\r\n\r\nUPNG.encode._filterZero = function(img,h,bpp,bpl,data, filter, levelZero)\r\n{\r\n\tvar fls = [], ftry=[0,1,2,3,4];\r\n\tif     (filter!=-1)             ftry=[filter];\r\n\telse if(h*bpl>500000 || bpp==1) ftry=[0];\r\n\tvar opts;  if(levelZero) opts={level:0};\r\n\t\r\n\tvar CMPR = (levelZero && UZIP!=null) ? UZIP : pako;\r\n\t\r\n\tfor(var i=0; i<ftry.length; i++) {\r\n\t\tfor(var y=0; y<h; y++) UPNG.encode._filterLine(data, img, y, bpl, bpp, ftry[i]);\r\n\t\t//var nimg = new Uint8Array(data.length);\r\n\t\t//var sz = UZIP.F.deflate(data, nimg);  fls.push(nimg.slice(0,sz));\r\n\t\t//var dfl = pako[\"deflate\"](data), dl=dfl.length-4;\r\n\t\t//var crc = (dfl[dl+3]<<24)|(dfl[dl+2]<<16)|(dfl[dl+1]<<8)|(dfl[dl+0]<<0);\r\n\t\t//console.log(crc, UZIP.adler(data,2,data.length-6));\r\n\t\tfls.push(CMPR[\"deflate\"](data,opts));\r\n\t}\r\n\tvar ti, tsize=1e9;\r\n\tfor(var i=0; i<fls.length; i++) if(fls[i].length<tsize) {  ti=i;  tsize=fls[i].length;  }\r\n\treturn fls[ti];\r\n}\r\nUPNG.encode._filterLine = function(data, img, y, bpl, bpp, type)\r\n{\r\n\tvar i = y*bpl, di = i+y, paeth = UPNG.decode._paeth\r\n\tdata[di]=type;  di++;\r\n\r\n\tif(type==0) {\r\n\t\tif(bpl<500) for(var x=0; x<bpl; x++) data[di+x] = img[i+x];\r\n\t\telse data.set(new Uint8Array(img.buffer,i,bpl),di);\r\n\t}\r\n\telse if(type==1) {\r\n\t\tfor(var x=  0; x<bpp; x++) data[di+x] =  img[i+x];\r\n\t\tfor(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x]-img[i+x-bpp]+256)&255;\r\n\t}\r\n\telse if(y==0) {\r\n\t\tfor(var x=  0; x<bpp; x++) data[di+x] = img[i+x];\r\n\r\n\t\tif(type==2) for(var x=bpp; x<bpl; x++) data[di+x] = img[i+x];\r\n\t\tif(type==3) for(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x] - (img[i+x-bpp]>>1) +256)&255;\r\n\t\tif(type==4) for(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x] - paeth(img[i+x-bpp], 0, 0) +256)&255;\r\n\t}\r\n\telse {\r\n\t\tif(type==2) { for(var x=  0; x<bpl; x++) data[di+x] = (img[i+x]+256 - img[i+x-bpl])&255;  }\r\n\t\tif(type==3) { for(var x=  0; x<bpp; x++) data[di+x] = (img[i+x]+256 - (img[i+x-bpl]>>1))&255;\r\n\t\t\t\t\t  for(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x]+256 - ((img[i+x-bpl]+img[i+x-bpp])>>1))&255;  }\r\n\t\tif(type==4) { for(var x=  0; x<bpp; x++) data[di+x] = (img[i+x]+256 - paeth(0, img[i+x-bpl], 0))&255;\r\n\t\t\t\t\t  for(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x]+256 - paeth(img[i+x-bpp], img[i+x-bpl], img[i+x-bpp-bpl]))&255;  }\r\n\t}\r\n}\r\n\r\nUPNG.crc = {\r\n\ttable : ( function() {\r\n\t   var tab = new Uint32Array(256);\r\n\t   for (var n=0; n<256; n++) {\r\n\t\t\tvar c = n;\r\n\t\t\tfor (var k=0; k<8; k++) {\r\n\t\t\t\tif (c & 1)  c = 0xedb88320 ^ (c >>> 1);\r\n\t\t\t\telse        c = c >>> 1;\r\n\t\t\t}\r\n\t\t\ttab[n] = c;  }\r\n\t\treturn tab;  })(),\r\n\tupdate : function(c, buf, off, len) {\r\n\t\tfor (var i=0; i<len; i++)  c = UPNG.crc.table[(c ^ buf[off+i]) & 0xff] ^ (c >>> 8);\r\n\t\treturn c;\r\n\t},\r\n\tcrc : function(b,o,l)  {  return UPNG.crc.update(0xffffffff,b,o,l) ^ 0xffffffff;  }\r\n}\r\n\r\n\r\nUPNG.quantize = function(abuf, ps)\r\n{\t\r\n\tvar oimg = new Uint8Array(abuf), nimg = oimg.slice(0), nimg32 = new Uint32Array(nimg.buffer);\r\n\t\r\n\tvar KD = UPNG.quantize.getKDtree(nimg, ps);\r\n\tvar root = KD[0], leafs = KD[1];\r\n\t\r\n\tvar planeDst = UPNG.quantize.planeDst;\r\n\tvar sb = oimg, tb = nimg32, len=sb.length;\r\n\t\t\r\n\tvar inds = new Uint8Array(oimg.length>>2);\r\n\tfor(var i=0; i<len; i+=4) {\r\n\t\tvar r=sb[i]*(1/255), g=sb[i+1]*(1/255), b=sb[i+2]*(1/255), a=sb[i+3]*(1/255);\r\n\t\t\r\n\t\t//  exact, but too slow :(\r\n\t\tvar nd = UPNG.quantize.getNearest(root, r, g, b, a);\r\n\t\t//var nd = root;\r\n\t\t//while(nd.left) nd = (planeDst(nd.est,r,g,b,a)<=0) ? nd.left : nd.right;\r\n\t\t\r\n\t\tinds[i>>2] = nd.ind;\r\n\t\ttb[i>>2] = nd.est.rgba;\r\n\t}\r\n\treturn {  abuf:nimg.buffer, inds:inds, plte:leafs  };\r\n}\r\n\r\nUPNG.quantize.getKDtree = function(nimg, ps, err) {\r\n\tif(err==null) err = 0.0001;\r\n\tvar nimg32 = new Uint32Array(nimg.buffer);\r\n\t\r\n\tvar root = {i0:0, i1:nimg.length, bst:null, est:null, tdst:0, left:null, right:null };  // basic statistic, extra statistic\r\n\troot.bst = UPNG.quantize.stats(  nimg,root.i0, root.i1  );  root.est = UPNG.quantize.estats( root.bst );\r\n\tvar leafs = [root];\r\n\t\r\n\twhile(leafs.length<ps)\r\n\t{\r\n\t\tvar maxL = 0, mi=0;\r\n\t\tfor(var i=0; i<leafs.length; i++) if(leafs[i].est.L > maxL) {  maxL=leafs[i].est.L;  mi=i;  }\r\n\t\tif(maxL<err) break;\r\n\t\tvar node = leafs[mi];\r\n\t\t\r\n\t\tvar s0 = UPNG.quantize.splitPixels(nimg,nimg32, node.i0, node.i1, node.est.e, node.est.eMq255);\r\n\t\tvar s0wrong = (node.i0>=s0 || node.i1<=s0);\r\n\t\t//console.log(maxL, leafs.length, mi);\r\n\t\tif(s0wrong) {  node.est.L=0;  continue;  }\r\n\t\t\r\n\t\t\r\n\t\tvar ln = {i0:node.i0, i1:s0, bst:null, est:null, tdst:0, left:null, right:null };  ln.bst = UPNG.quantize.stats( nimg, ln.i0, ln.i1 );  \r\n\t\tln.est = UPNG.quantize.estats( ln.bst );\r\n\t\tvar rn = {i0:s0, i1:node.i1, bst:null, est:null, tdst:0, left:null, right:null };  rn.bst = {R:[], m:[], N:node.bst.N-ln.bst.N};\r\n\t\tfor(var i=0; i<16; i++) rn.bst.R[i] = node.bst.R[i]-ln.bst.R[i];\r\n\t\tfor(var i=0; i< 4; i++) rn.bst.m[i] = node.bst.m[i]-ln.bst.m[i];\r\n\t\trn.est = UPNG.quantize.estats( rn.bst );\r\n\t\t\r\n\t\tnode.left = ln;  node.right = rn;\r\n\t\tleafs[mi]=ln;  leafs.push(rn);\r\n\t}\r\n\tleafs.sort(function(a,b) {  return b.bst.N-a.bst.N;  });\r\n\tfor(var i=0; i<leafs.length; i++) leafs[i].ind=i;\r\n\treturn [root, leafs];\r\n}\r\n\r\nUPNG.quantize.getNearest = function(nd, r,g,b,a)\r\n{\r\n\tif(nd.left==null) {  nd.tdst = UPNG.quantize.dist(nd.est.q,r,g,b,a);  return nd;  }\r\n\tvar planeDst = UPNG.quantize.planeDst(nd.est,r,g,b,a);\r\n\t\r\n\tvar node0 = nd.left, node1 = nd.right;\r\n\tif(planeDst>0) {  node0=nd.right;  node1=nd.left;  }\r\n\t\r\n\tvar ln = UPNG.quantize.getNearest(node0, r,g,b,a);\r\n\tif(ln.tdst<=planeDst*planeDst) return ln;\r\n\tvar rn = UPNG.quantize.getNearest(node1, r,g,b,a);\r\n\treturn rn.tdst<ln.tdst ? rn : ln;\r\n}\r\nUPNG.quantize.planeDst = function(est, r,g,b,a) {  var e = est.e;  return e[0]*r + e[1]*g + e[2]*b + e[3]*a - est.eMq;  }\r\nUPNG.quantize.dist     = function(q,   r,g,b,a) {  var d0=r-q[0], d1=g-q[1], d2=b-q[2], d3=a-q[3];  return d0*d0+d1*d1+d2*d2+d3*d3;  }\r\n\r\nUPNG.quantize.splitPixels = function(nimg, nimg32, i0, i1, e, eMq)\r\n{\r\n\tvar vecDot = UPNG.quantize.vecDot;\r\n\ti1-=4;\r\n\tvar shfs = 0;\r\n\twhile(i0<i1)\r\n\t{\r\n\t\twhile(vecDot(nimg, i0, e)<=eMq) i0+=4;\r\n\t\twhile(vecDot(nimg, i1, e)> eMq) i1-=4;\r\n\t\tif(i0>=i1) break;\r\n\t\t\r\n\t\tvar t = nimg32[i0>>2];  nimg32[i0>>2] = nimg32[i1>>2];  nimg32[i1>>2]=t;\r\n\t\t\r\n\t\ti0+=4;  i1-=4;\r\n\t}\r\n\twhile(vecDot(nimg, i0, e)>eMq) i0-=4;\r\n\treturn i0+4;\r\n}\r\nUPNG.quantize.vecDot = function(nimg, i, e)\r\n{\r\n\treturn nimg[i]*e[0] + nimg[i+1]*e[1] + nimg[i+2]*e[2] + nimg[i+3]*e[3];\r\n}\r\nUPNG.quantize.stats = function(nimg, i0, i1){\r\n\tvar R = [0,0,0,0,  0,0,0,0,  0,0,0,0,  0,0,0,0];\r\n\tvar m = [0,0,0,0];\r\n\tvar N = (i1-i0)>>2;\r\n\tfor(var i=i0; i<i1; i+=4)\r\n\t{\r\n\t\tvar r = nimg[i]*(1/255), g = nimg[i+1]*(1/255), b = nimg[i+2]*(1/255), a = nimg[i+3]*(1/255);\r\n\t\t//var r = nimg[i], g = nimg[i+1], b = nimg[i+2], a = nimg[i+3];\r\n\t\tm[0]+=r;  m[1]+=g;  m[2]+=b;  m[3]+=a;\r\n\t\t\r\n\t\tR[ 0] += r*r;  R[ 1] += r*g;  R[ 2] += r*b;  R[ 3] += r*a;  \r\n\t\t               R[ 5] += g*g;  R[ 6] += g*b;  R[ 7] += g*a; \r\n\t\t                              R[10] += b*b;  R[11] += b*a;  \r\n\t\t                                             R[15] += a*a;  \r\n\t}\r\n\tR[4]=R[1];  R[8]=R[2];  R[9]=R[6];  R[12]=R[3];  R[13]=R[7];  R[14]=R[11];\r\n\t\r\n\treturn {R:R, m:m, N:N};\r\n}\r\nUPNG.quantize.estats = function(stats){\r\n\tvar R = stats.R, m = stats.m, N = stats.N;\r\n\t\r\n\t// when all samples are equal, but N is large (millions), the Rj can be non-zero ( 0.0003.... - precission error)\r\n\tvar m0 = m[0], m1 = m[1], m2 = m[2], m3 = m[3], iN = (N==0 ? 0 : 1/N);\r\n\tvar Rj = [\r\n\t\tR[ 0] - m0*m0*iN,  R[ 1] - m0*m1*iN,  R[ 2] - m0*m2*iN,  R[ 3] - m0*m3*iN,  \r\n\t\tR[ 4] - m1*m0*iN,  R[ 5] - m1*m1*iN,  R[ 6] - m1*m2*iN,  R[ 7] - m1*m3*iN,\r\n\t\tR[ 8] - m2*m0*iN,  R[ 9] - m2*m1*iN,  R[10] - m2*m2*iN,  R[11] - m2*m3*iN,  \r\n\t\tR[12] - m3*m0*iN,  R[13] - m3*m1*iN,  R[14] - m3*m2*iN,  R[15] - m3*m3*iN \r\n\t];\r\n\t\r\n\tvar A = Rj, M = UPNG.M4;\r\n\tvar b = [0.5,0.5,0.5,0.5], mi = 0, tmi = 0;\r\n\t\r\n\tif(N!=0)\r\n\tfor(var i=0; i<10; i++) {\r\n\t\tb = M.multVec(A, b);  tmi = Math.sqrt(M.dot(b,b));  b = M.sml(1/tmi,  b);\r\n\t\tif(Math.abs(tmi-mi)<1e-9) break;  mi = tmi;\r\n\t}\t\r\n\t//b = [0,0,1,0];  mi=N;\r\n\tvar q = [m0*iN, m1*iN, m2*iN, m3*iN];\r\n\tvar eMq255 = M.dot(M.sml(255,q),b);\r\n\t\r\n\treturn {  Cov:Rj, q:q, e:b, L:mi,  eMq255:eMq255, eMq : M.dot(b,q),\r\n\t\t\t\trgba: (((Math.round(255*q[3])<<24) | (Math.round(255*q[2])<<16) |  (Math.round(255*q[1])<<8) | (Math.round(255*q[0])<<0))>>>0)  };\r\n}\r\nUPNG.M4 = {\r\n\tmultVec : function(m,v) {\r\n\t\t\treturn [\r\n\t\t\t\tm[ 0]*v[0] + m[ 1]*v[1] + m[ 2]*v[2] + m[ 3]*v[3],\r\n\t\t\t\tm[ 4]*v[0] + m[ 5]*v[1] + m[ 6]*v[2] + m[ 7]*v[3],\r\n\t\t\t\tm[ 8]*v[0] + m[ 9]*v[1] + m[10]*v[2] + m[11]*v[3],\r\n\t\t\t\tm[12]*v[0] + m[13]*v[1] + m[14]*v[2] + m[15]*v[3]\r\n\t\t\t];\r\n\t},\r\n\tdot : function(x,y) {  return  x[0]*y[0]+x[1]*y[1]+x[2]*y[2]+x[3]*y[3];  },\r\n\tsml : function(a,y) {  return [a*y[0],a*y[1],a*y[2],a*y[3]];  }\r\n}\r\n\r\nUPNG.encode.concatRGBA = function(bufs) {\r\n\tvar tlen = 0;\r\n\tfor(var i=0; i<bufs.length; i++) tlen += bufs[i].byteLength;\r\n\tvar nimg = new Uint8Array(tlen), noff=0;\r\n\tfor(var i=0; i<bufs.length; i++) {\r\n\t\tvar img = new Uint8Array(bufs[i]), il = img.length;\r\n\t\tfor(var j=0; j<il; j+=4) {  \r\n\t\t\tvar r=img[j], g=img[j+1], b=img[j+2], a = img[j+3];\r\n\t\t\tif(a==0) r=g=b=0;\r\n\t\t\tnimg[noff+j]=r;  nimg[noff+j+1]=g;  nimg[noff+j+2]=b;  nimg[noff+j+3]=a;  }\r\n\t\tnoff += il;\r\n\t}\r\n\treturn nimg.buffer;\r\n}\r\n\r\nexport default UPNG;\r\n\r\n"]},"metadata":{},"sourceType":"module"}