{"ast":null,"code":"import { __awaiter, __generator, __rest } from \"tslib\";\nimport { EncryptedPDFError, FontkitNotRegisteredError, ForeignPageError, RemovePageFromEmptyDocumentError } from \"./errors\";\nimport PDFEmbeddedPage from \"./PDFEmbeddedPage\";\nimport PDFFont from \"./PDFFont\";\nimport PDFImage from \"./PDFImage\";\nimport PDFPage from \"./PDFPage\";\nimport PDFForm from \"./form/PDFForm\";\nimport { PageSizes } from \"./sizes\";\nimport { CustomFontEmbedder, CustomFontSubsetEmbedder, JpegEmbedder, PageEmbeddingMismatchedContextError, PDFCatalog, PDFContext, PDFDict, PDFHexString, PDFName, PDFObjectCopier, PDFPageEmbedder, PDFPageLeaf, PDFPageTree, PDFParser, PDFStreamWriter, PDFString, PDFWriter, PngEmbedder, StandardFontEmbedder, UnexpectedObjectTypeError } from \"../core\";\nimport { ParseSpeeds } from \"./PDFDocumentOptions\";\nimport { assertIs, assertIsOneOfOrUndefined, assertOrUndefined, assertRange, Cache, canBeConvertedToUint8Array, encodeToBase64, isStandardFont, pluckIndices, range, toUint8Array } from \"../utils\";\nimport FileEmbedder, { AFRelationship } from \"../core/embedders/FileEmbedder\";\nimport PDFEmbeddedFile from \"./PDFEmbeddedFile\";\nimport PDFJavaScript from \"./PDFJavaScript\";\nimport JavaScriptEmbedder from \"../core/embedders/JavaScriptEmbedder\";\n/**\r\n * Represents a PDF document.\r\n */\n\nvar PDFDocument =\n/** @class */\nfunction () {\n  function PDFDocument(context, ignoreEncryption, updateMetadata) {\n    var _this = this;\n    /** The default word breaks used in PDFPage.drawText */\n\n\n    this.defaultWordBreaks = [' '];\n\n    this.computePages = function () {\n      var pages = [];\n\n      _this.catalog.Pages().traverse(function (node, ref) {\n        if (node instanceof PDFPageLeaf) {\n          var page = _this.pageMap.get(node);\n\n          if (!page) {\n            page = PDFPage.of(node, ref, _this);\n\n            _this.pageMap.set(node, page);\n          }\n\n          pages.push(page);\n        }\n      });\n\n      return pages;\n    };\n\n    this.getOrCreateForm = function () {\n      var acroForm = _this.catalog.getOrCreateAcroForm();\n\n      return PDFForm.of(acroForm, _this);\n    };\n\n    assertIs(context, 'context', [[PDFContext, 'PDFContext']]);\n    assertIs(ignoreEncryption, 'ignoreEncryption', ['boolean']);\n    this.context = context;\n    this.catalog = context.lookup(context.trailerInfo.Root);\n    this.isEncrypted = !!context.lookup(context.trailerInfo.Encrypt);\n    this.pageCache = Cache.populatedBy(this.computePages);\n    this.pageMap = new Map();\n    this.formCache = Cache.populatedBy(this.getOrCreateForm);\n    this.fonts = [];\n    this.images = [];\n    this.embeddedPages = [];\n    this.embeddedFiles = [];\n    this.javaScripts = [];\n    if (!ignoreEncryption && this.isEncrypted) throw new EncryptedPDFError();\n    if (updateMetadata) this.updateInfoDict();\n  }\n  /**\r\n   * Load an existing [[PDFDocument]]. The input data can be provided in\r\n   * multiple formats:\r\n   *\r\n   * | Type          | Contents                                               |\r\n   * | ------------- | ------------------------------------------------------ |\r\n   * | `string`      | A base64 encoded string (or data URI) containing a PDF |\r\n   * | `Uint8Array`  | The raw bytes of a PDF                                 |\r\n   * | `ArrayBuffer` | The raw bytes of a PDF                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * import { PDFDocument } from 'pdf-lib'\r\n   *\r\n   * // pdf=string\r\n   * const base64 =\r\n   *  'JVBERi0xLjcKJYGBgYEKCjUgMCBvYmoKPDwKL0ZpbHRlciAvRmxhdGVEZWNvZGUKL0xlbm' +\r\n   *  'd0aCAxMDQKPj4Kc3RyZWFtCniccwrhMlAAwaJ0Ln2P1Jyy1JLM5ERdc0MjCwUjE4WQNC4Q' +\r\n   *  '6cNlCFZkqGCqYGSqEJLLZWNuYGZiZmbkYuZsZmlmZGRgZmluDCQNzc3NTM2NzdzMXMxMjQ' +\r\n   *  'ztFEKyuEK0uFxDuAAOERdVCmVuZHN0cmVhbQplbmRvYmoKCjYgMCBvYmoKPDwKL0ZpbHRl' +\r\n   *  'ciAvRmxhdGVEZWNvZGUKL1R5cGUgL09ialN0bQovTiA0Ci9GaXJzdCAyMAovTGVuZ3RoID' +\r\n   *  'IxNQo+PgpzdHJlYW0KeJxVj9GqwjAMhu/zFHkBzTo3nCCCiiKIHPEICuJF3cKoSCu2E8/b' +\r\n   *  '20wPIr1p8v9/8kVhgilmGfawX2CGaVrgcAi0/bsy0lrX7IGWpvJ4iJYEN3gEmrrGBlQwGs' +\r\n   *  'HHO9VBX1wNrxAqMX87RBD5xpJuddqwd82tjAHxzV1U5LPgy52DKXWnr1Lheg+j/c/pzGVr' +\r\n   *  'iqV0VlwZPXGPCJjElw/ybkwUmeoWgxesDXGhHJC/D/iikp1Av80ptKU0FdBEe25pPihAM1' +\r\n   *  'u6ytgaaWfs2Hrz35CJT1+EWmAKZW5kc3RyZWFtCmVuZG9iagoKNyAwIG9iago8PAovU2l6' +\r\n   *  'ZSA4Ci9Sb290IDIgMCBSCi9GaWx0ZXIgL0ZsYXRlRGVjb2RlCi9UeXBlIC9YUmVmCi9MZW' +\r\n   *  '5ndGggMzgKL1cgWyAxIDIgMiBdCi9JbmRleCBbIDAgOCBdCj4+CnN0cmVhbQp4nBXEwREA' +\r\n   *  'EBAEsCwz3vrvRmOOyyOoGhZdutHN2MT55fIAVocD+AplbmRzdHJlYW0KZW5kb2JqCgpzdG' +\r\n   *  'FydHhyZWYKNTEwCiUlRU9G'\r\n   *\r\n   * const dataUri = 'data:application/pdf;base64,' + base64\r\n   *\r\n   * const pdfDoc1 = await PDFDocument.load(base64)\r\n   * const pdfDoc2 = await PDFDocument.load(dataUri)\r\n   *\r\n   * // pdf=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('with_update_sections.pdf')\r\n   * const pdfDoc3 = await PDFDocument.load(uint8Array)\r\n   *\r\n   * // pdf=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/with_update_sections.pdf'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * const pdfDoc4 = await PDFDocument.load(arrayBuffer)\r\n   *\r\n   * ```\r\n   *\r\n   * @param pdf The input data containing a PDF document.\r\n   * @param options The options to be used when loading the document.\r\n   * @returns Resolves with a document loaded from the input.\r\n   */\n\n\n  PDFDocument.load = function (pdf, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, ignoreEncryption, _b, parseSpeed, _c, throwOnInvalidObject, _d, updateMetadata, _e, capNumbers, bytes, context;\n\n      return __generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            _a = options.ignoreEncryption, ignoreEncryption = _a === void 0 ? false : _a, _b = options.parseSpeed, parseSpeed = _b === void 0 ? ParseSpeeds.Slow : _b, _c = options.throwOnInvalidObject, throwOnInvalidObject = _c === void 0 ? false : _c, _d = options.updateMetadata, updateMetadata = _d === void 0 ? true : _d, _e = options.capNumbers, capNumbers = _e === void 0 ? false : _e;\n            assertIs(pdf, 'pdf', ['string', Uint8Array, ArrayBuffer]);\n            assertIs(ignoreEncryption, 'ignoreEncryption', ['boolean']);\n            assertIs(parseSpeed, 'parseSpeed', ['number']);\n            assertIs(throwOnInvalidObject, 'throwOnInvalidObject', ['boolean']);\n            bytes = toUint8Array(pdf);\n            return [4\n            /*yield*/\n            , PDFParser.forBytesWithOptions(bytes, parseSpeed, throwOnInvalidObject, capNumbers).parseDocument()];\n\n          case 1:\n            context = _f.sent();\n            return [2\n            /*return*/\n            , new PDFDocument(context, ignoreEncryption, updateMetadata)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Create a new [[PDFDocument]].\r\n   * @returns Resolves with the newly created document.\r\n   */\n\n\n  PDFDocument.create = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, updateMetadata, context, pageTree, pageTreeRef, catalog;\n\n      return __generator(this, function (_b) {\n        _a = options.updateMetadata, updateMetadata = _a === void 0 ? true : _a;\n        context = PDFContext.create();\n        pageTree = PDFPageTree.withContext(context);\n        pageTreeRef = context.register(pageTree);\n        catalog = PDFCatalog.withContextAndPages(context, pageTreeRef);\n        context.trailerInfo.Root = context.register(catalog);\n        return [2\n        /*return*/\n        , new PDFDocument(context, false, updateMetadata)];\n      });\n    });\n  };\n  /**\r\n   * Register a fontkit instance. This must be done before custom fonts can\r\n   * be embedded. See [here](https://github.com/Hopding/pdf-lib/tree/master#fontkit-installation)\r\n   * for instructions on how to install and register a fontkit instance.\r\n   *\r\n   * > You do **not** need to call this method to embed standard fonts.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * import { PDFDocument } from 'pdf-lib'\r\n   * import fontkit from '@pdf-lib/fontkit'\r\n   *\r\n   * const pdfDoc = await PDFDocument.create()\r\n   * pdfDoc.registerFontkit(fontkit)\r\n   * ```\r\n   *\r\n   * @param fontkit The fontkit instance to be registered.\r\n   */\n\n\n  PDFDocument.prototype.registerFontkit = function (fontkit) {\n    this.fontkit = fontkit;\n  };\n  /**\r\n   * Get the [[PDFForm]] containing all interactive fields for this document.\r\n   * For example:\r\n   * ```js\r\n   * const form = pdfDoc.getForm()\r\n   * const fields = form.getFields()\r\n   * fields.forEach(field => {\r\n   *   const type = field.constructor.name\r\n   *   const name = field.getName()\r\n   *   console.log(`${type}: ${name}`)\r\n   * })\r\n   * ```\r\n   * @returns The form for this document.\r\n   */\n\n\n  PDFDocument.prototype.getForm = function () {\n    var form = this.formCache.access();\n\n    if (form.hasXFA()) {\n      console.warn('Removing XFA form data as pdf-lib does not support reading or writing XFA');\n      form.deleteXFA();\n    }\n\n    return form;\n  };\n  /**\r\n   * Get this document's title metadata. The title appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const title = pdfDoc.getTitle()\r\n   * ```\r\n   * @returns A string containing the title of this document, if it has one.\r\n   */\n\n\n  PDFDocument.prototype.getTitle = function () {\n    var title = this.getInfoDict().lookup(PDFName.Title);\n    if (!title) return undefined;\n    assertIsLiteralOrHexString(title);\n    return title.decodeText();\n  };\n  /**\r\n   * Get this document's author metadata. The author appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const author = pdfDoc.getAuthor()\r\n   * ```\r\n   * @returns A string containing the author of this document, if it has one.\r\n   */\n\n\n  PDFDocument.prototype.getAuthor = function () {\n    var author = this.getInfoDict().lookup(PDFName.Author);\n    if (!author) return undefined;\n    assertIsLiteralOrHexString(author);\n    return author.decodeText();\n  };\n  /**\r\n   * Get this document's subject metadata. The subject appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const subject = pdfDoc.getSubject()\r\n   * ```\r\n   * @returns A string containing the subject of this document, if it has one.\r\n   */\n\n\n  PDFDocument.prototype.getSubject = function () {\n    var subject = this.getInfoDict().lookup(PDFName.Subject);\n    if (!subject) return undefined;\n    assertIsLiteralOrHexString(subject);\n    return subject.decodeText();\n  };\n  /**\r\n   * Get this document's keywords metadata. The keywords appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const keywords = pdfDoc.getKeywords()\r\n   * ```\r\n   * @returns A string containing the keywords of this document, if it has any.\r\n   */\n\n\n  PDFDocument.prototype.getKeywords = function () {\n    var keywords = this.getInfoDict().lookup(PDFName.Keywords);\n    if (!keywords) return undefined;\n    assertIsLiteralOrHexString(keywords);\n    return keywords.decodeText();\n  };\n  /**\r\n   * Get this document's creator metadata. The creator appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const creator = pdfDoc.getCreator()\r\n   * ```\r\n   * @returns A string containing the creator of this document, if it has one.\r\n   */\n\n\n  PDFDocument.prototype.getCreator = function () {\n    var creator = this.getInfoDict().lookup(PDFName.Creator);\n    if (!creator) return undefined;\n    assertIsLiteralOrHexString(creator);\n    return creator.decodeText();\n  };\n  /**\r\n   * Get this document's producer metadata. The producer appears in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const producer = pdfDoc.getProducer()\r\n   * ```\r\n   * @returns A string containing the producer of this document, if it has one.\r\n   */\n\n\n  PDFDocument.prototype.getProducer = function () {\n    var producer = this.getInfoDict().lookup(PDFName.Producer);\n    if (!producer) return undefined;\n    assertIsLiteralOrHexString(producer);\n    return producer.decodeText();\n  };\n  /**\r\n   * Get this document's creation date metadata. The creation date appears in\r\n   * the \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * const creationDate = pdfDoc.getCreationDate()\r\n   * ```\r\n   * @returns A Date containing the creation date of this document,\r\n   *          if it has one.\r\n   */\n\n\n  PDFDocument.prototype.getCreationDate = function () {\n    var creationDate = this.getInfoDict().lookup(PDFName.CreationDate);\n    if (!creationDate) return undefined;\n    assertIsLiteralOrHexString(creationDate);\n    return creationDate.decodeDate();\n  };\n  /**\r\n   * Get this document's modification date metadata. The modification date\r\n   * appears in the \"Document Properties\" section of most PDF readers.\r\n   * For example:\r\n   * ```js\r\n   * const modification = pdfDoc.getModificationDate()\r\n   * ```\r\n   * @returns A Date containing the modification date of this document,\r\n   *          if it has one.\r\n   */\n\n\n  PDFDocument.prototype.getModificationDate = function () {\n    var modificationDate = this.getInfoDict().lookup(PDFName.ModDate);\n    if (!modificationDate) return undefined;\n    assertIsLiteralOrHexString(modificationDate);\n    return modificationDate.decodeDate();\n  };\n  /**\r\n   * Set this document's title metadata. The title will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setTitle('🥚 The Life of an Egg 🍳')\r\n   * ```\r\n   *\r\n   * To display the title in the window's title bar, set the\r\n   * `showInWindowTitleBar` option to `true` (works for _most_ PDF readers).\r\n   * For example:\r\n   * ```js\r\n   * pdfDoc.setTitle('🥚 The Life of an Egg 🍳', { showInWindowTitleBar: true })\r\n   * ```\r\n   *\r\n   * @param title The title of this document.\r\n   * @param options The options to be used when setting the title.\r\n   */\n\n\n  PDFDocument.prototype.setTitle = function (title, options) {\n    assertIs(title, 'title', ['string']);\n    var key = PDFName.of('Title');\n    this.getInfoDict().set(key, PDFHexString.fromText(title)); // Indicate that readers should display the title rather than the filename\n\n    if (options === null || options === void 0 ? void 0 : options.showInWindowTitleBar) {\n      var prefs = this.catalog.getOrCreateViewerPreferences();\n      prefs.setDisplayDocTitle(true);\n    }\n  };\n  /**\r\n   * Set this document's author metadata. The author will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setAuthor('Humpty Dumpty')\r\n   * ```\r\n   * @param author The author of this document.\r\n   */\n\n\n  PDFDocument.prototype.setAuthor = function (author) {\n    assertIs(author, 'author', ['string']);\n    var key = PDFName.of('Author');\n    this.getInfoDict().set(key, PDFHexString.fromText(author));\n  };\n  /**\r\n   * Set this document's subject metadata. The subject will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setSubject('📘 An Epic Tale of Woe 📖')\r\n   * ```\r\n   * @param subject The subject of this document.\r\n   */\n\n\n  PDFDocument.prototype.setSubject = function (subject) {\n    assertIs(subject, 'author', ['string']);\n    var key = PDFName.of('Subject');\n    this.getInfoDict().set(key, PDFHexString.fromText(subject));\n  };\n  /**\r\n   * Set this document's keyword metadata. These keywords will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setKeywords(['eggs', 'wall', 'fall', 'king', 'horses', 'men'])\r\n   * ```\r\n   * @param keywords An array of keywords associated with this document.\r\n   */\n\n\n  PDFDocument.prototype.setKeywords = function (keywords) {\n    assertIs(keywords, 'keywords', [Array]);\n    var key = PDFName.of('Keywords');\n    this.getInfoDict().set(key, PDFHexString.fromText(keywords.join(' ')));\n  };\n  /**\r\n   * Set this document's creator metadata. The creator will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setCreator('PDF App 9000 🤖')\r\n   * ```\r\n   * @param creator The creator of this document.\r\n   */\n\n\n  PDFDocument.prototype.setCreator = function (creator) {\n    assertIs(creator, 'creator', ['string']);\n    var key = PDFName.of('Creator');\n    this.getInfoDict().set(key, PDFHexString.fromText(creator));\n  };\n  /**\r\n   * Set this document's producer metadata. The producer will appear in the\r\n   * \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setProducer('PDF App 9000 🤖')\r\n   * ```\r\n   * @param producer The producer of this document.\r\n   */\n\n\n  PDFDocument.prototype.setProducer = function (producer) {\n    assertIs(producer, 'creator', ['string']);\n    var key = PDFName.of('Producer');\n    this.getInfoDict().set(key, PDFHexString.fromText(producer));\n  };\n  /**\r\n   * Set this document's language metadata. The language will appear in the\r\n   * \"Document Properties\" section of some PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setLanguage('en-us')\r\n   * ```\r\n   *\r\n   * @param language An RFC 3066 _Language-Tag_ denoting the language of this\r\n   *                 document, or an empty string if the language is unknown.\r\n   */\n\n\n  PDFDocument.prototype.setLanguage = function (language) {\n    assertIs(language, 'language', ['string']);\n    var key = PDFName.of('Lang');\n    this.catalog.set(key, PDFString.of(language));\n  };\n  /**\r\n   * Set this document's creation date metadata. The creation date will appear\r\n   * in the \"Document Properties\" section of most PDF readers. For example:\r\n   * ```js\r\n   * pdfDoc.setCreationDate(new Date())\r\n   * ```\r\n   * @param creationDate The date this document was created.\r\n   */\n\n\n  PDFDocument.prototype.setCreationDate = function (creationDate) {\n    assertIs(creationDate, 'creationDate', [[Date, 'Date']]);\n    var key = PDFName.of('CreationDate');\n    this.getInfoDict().set(key, PDFString.fromDate(creationDate));\n  };\n  /**\r\n   * Set this document's modification date metadata. The modification date will\r\n   * appear in the \"Document Properties\" section of most PDF readers. For\r\n   * example:\r\n   * ```js\r\n   * pdfDoc.setModificationDate(new Date())\r\n   * ```\r\n   * @param modificationDate The date this document was last modified.\r\n   */\n\n\n  PDFDocument.prototype.setModificationDate = function (modificationDate) {\n    assertIs(modificationDate, 'modificationDate', [[Date, 'Date']]);\n    var key = PDFName.of('ModDate');\n    this.getInfoDict().set(key, PDFString.fromDate(modificationDate));\n  };\n  /**\r\n   * Get the number of pages contained in this document. For example:\r\n   * ```js\r\n   * const totalPages = pdfDoc.getPageCount()\r\n   * ```\r\n   * @returns The number of pages in this document.\r\n   */\n\n\n  PDFDocument.prototype.getPageCount = function () {\n    if (this.pageCount === undefined) this.pageCount = this.getPages().length;\n    return this.pageCount;\n  };\n  /**\r\n   * Get an array of all the pages contained in this document. The pages are\r\n   * stored in the array in the same order that they are rendered in the\r\n   * document. For example:\r\n   * ```js\r\n   * const pages = pdfDoc.getPages()\r\n   * pages[0]   // The first page of the document\r\n   * pages[2]   // The third page of the document\r\n   * pages[197] // The 198th page of the document\r\n   * ```\r\n   * @returns An array of all the pages contained in this document.\r\n   */\n\n\n  PDFDocument.prototype.getPages = function () {\n    return this.pageCache.access();\n  };\n  /**\r\n   * Get the page rendered at a particular `index` of the document. For example:\r\n   * ```js\r\n   * pdfDoc.getPage(0)   // The first page of the document\r\n   * pdfDoc.getPage(2)   // The third page of the document\r\n   * pdfDoc.getPage(197) // The 198th page of the document\r\n   * ```\r\n   * @returns The [[PDFPage]] rendered at the given `index` of the document.\r\n   */\n\n\n  PDFDocument.prototype.getPage = function (index) {\n    var pages = this.getPages();\n    assertRange(index, 'index', 0, pages.length - 1);\n    return pages[index];\n  };\n  /**\r\n   * Get an array of indices for all the pages contained in this document. The\r\n   * array will contain a range of integers from\r\n   * `0..pdfDoc.getPageCount() - 1`. For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   * pdfDoc.addPage()\r\n   * pdfDoc.addPage()\r\n   * pdfDoc.addPage()\r\n   *\r\n   * const indices = pdfDoc.getPageIndices()\r\n   * indices // => [0, 1, 2]\r\n   * ```\r\n   * @returns An array of indices for all pages contained in this document.\r\n   */\n\n\n  PDFDocument.prototype.getPageIndices = function () {\n    return range(0, this.getPageCount());\n  };\n  /**\r\n   * Remove the page at a given index from this document. For example:\r\n   * ```js\r\n   * pdfDoc.removePage(0)   // Remove the first page of the document\r\n   * pdfDoc.removePage(2)   // Remove the third page of the document\r\n   * pdfDoc.removePage(197) // Remove the 198th page of the document\r\n   * ```\r\n   * Once a page has been removed, it will no longer be rendered at that index\r\n   * in the document.\r\n   * @param index The index of the page to be removed.\r\n   */\n\n\n  PDFDocument.prototype.removePage = function (index) {\n    var pageCount = this.getPageCount();\n    if (this.pageCount === 0) throw new RemovePageFromEmptyDocumentError();\n    assertRange(index, 'index', 0, pageCount - 1);\n    this.catalog.removeLeafNode(index);\n    this.pageCount = pageCount - 1;\n  };\n  /**\r\n   * Add a page to the end of this document. This method accepts three\r\n   * different value types for the `page` parameter:\r\n   *\r\n   * | Type               | Behavior                                                                            |\r\n   * | ------------------ | ----------------------------------------------------------------------------------- |\r\n   * | `undefined`        | Create a new page and add it to the end of this document                            |\r\n   * | `[number, number]` | Create a new page with the given dimensions and add it to the end of this document  |\r\n   * | `PDFPage`          | Add the existing page to the end of this document                                   |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // page=undefined\r\n   * const newPage = pdfDoc.addPage()\r\n   *\r\n   * // page=[number, number]\r\n   * import { PageSizes } from 'pdf-lib'\r\n   * const newPage1 = pdfDoc.addPage(PageSizes.A7)\r\n   * const newPage2 = pdfDoc.addPage(PageSizes.Letter)\r\n   * const newPage3 = pdfDoc.addPage([500, 750])\r\n   *\r\n   * // page=PDFPage\r\n   * const pdfDoc1 = await PDFDocument.create()\r\n   * const pdfDoc2 = await PDFDocument.load(...)\r\n   * const [existingPage] = await pdfDoc1.copyPages(pdfDoc2, [0])\r\n   * pdfDoc1.addPage(existingPage)\r\n   * ```\r\n   *\r\n   * @param page Optionally, the desired dimensions or existing page.\r\n   * @returns The newly created (or existing) page.\r\n   */\n\n\n  PDFDocument.prototype.addPage = function (page) {\n    assertIs(page, 'page', ['undefined', [PDFPage, 'PDFPage'], Array]);\n    return this.insertPage(this.getPageCount(), page);\n  };\n  /**\r\n   * Insert a page at a given index within this document. This method accepts\r\n   * three different value types for the `page` parameter:\r\n   *\r\n   * | Type               | Behavior                                                                       |\r\n   * | ------------------ | ------------------------------------------------------------------------------ |\r\n   * | `undefined`        | Create a new page and insert it into this document                             |\r\n   * | `[number, number]` | Create a new page with the given dimensions and insert it into this document   |\r\n   * | `PDFPage`          | Insert the existing page into this document                                    |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // page=undefined\r\n   * const newPage = pdfDoc.insertPage(2)\r\n   *\r\n   * // page=[number, number]\r\n   * import { PageSizes } from 'pdf-lib'\r\n   * const newPage1 = pdfDoc.insertPage(2, PageSizes.A7)\r\n   * const newPage2 = pdfDoc.insertPage(0, PageSizes.Letter)\r\n   * const newPage3 = pdfDoc.insertPage(198, [500, 750])\r\n   *\r\n   * // page=PDFPage\r\n   * const pdfDoc1 = await PDFDocument.create()\r\n   * const pdfDoc2 = await PDFDocument.load(...)\r\n   * const [existingPage] = await pdfDoc1.copyPages(pdfDoc2, [0])\r\n   * pdfDoc1.insertPage(0, existingPage)\r\n   * ```\r\n   *\r\n   * @param index The index at which the page should be inserted (zero-based).\r\n   * @param page Optionally, the desired dimensions or existing page.\r\n   * @returns The newly created (or existing) page.\r\n   */\n\n\n  PDFDocument.prototype.insertPage = function (index, page) {\n    var pageCount = this.getPageCount();\n    assertRange(index, 'index', 0, pageCount);\n    assertIs(page, 'page', ['undefined', [PDFPage, 'PDFPage'], Array]);\n\n    if (!page || Array.isArray(page)) {\n      var dims = Array.isArray(page) ? page : PageSizes.A4;\n      page = PDFPage.create(this);\n      page.setSize.apply(page, dims);\n    } else if (page.doc !== this) {\n      throw new ForeignPageError();\n    }\n\n    var parentRef = this.catalog.insertLeafNode(page.ref, index);\n    page.node.setParent(parentRef);\n    this.pageMap.set(page.node, page);\n    this.pageCache.invalidate();\n    this.pageCount = pageCount + 1;\n    return page;\n  };\n  /**\r\n   * Copy pages from a source document into this document. Allows pages to be\r\n   * copied between different [[PDFDocument]] instances. For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   * const srcDoc = await PDFDocument.load(...)\r\n   *\r\n   * const copiedPages = await pdfDoc.copyPages(srcDoc, [0, 3, 89])\r\n   * const [firstPage, fourthPage, ninetiethPage] = copiedPages;\r\n   *\r\n   * pdfDoc.addPage(fourthPage)\r\n   * pdfDoc.insertPage(0, ninetiethPage)\r\n   * pdfDoc.addPage(firstPage)\r\n   * ```\r\n   * @param srcDoc The document from which pages should be copied.\r\n   * @param indices The indices of the pages that should be copied.\r\n   * @returns Resolves with an array of pages copied into this document.\r\n   */\n\n\n  PDFDocument.prototype.copyPages = function (srcDoc, indices) {\n    return __awaiter(this, void 0, void 0, function () {\n      var copier, srcPages, copiedPages, idx, len, srcPage, copiedPage, ref;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            assertIs(srcDoc, 'srcDoc', [[PDFDocument, 'PDFDocument']]);\n            assertIs(indices, 'indices', [Array]);\n            return [4\n            /*yield*/\n            , srcDoc.flush()];\n\n          case 1:\n            _a.sent();\n\n            copier = PDFObjectCopier.for(srcDoc.context, this.context);\n            srcPages = srcDoc.getPages();\n            copiedPages = new Array(indices.length);\n\n            for (idx = 0, len = indices.length; idx < len; idx++) {\n              srcPage = srcPages[indices[idx]];\n              copiedPage = copier.copy(srcPage.node);\n              ref = this.context.register(copiedPage);\n              copiedPages[idx] = PDFPage.of(copiedPage, ref, this);\n            }\n\n            return [2\n            /*return*/\n            , copiedPages];\n        }\n      });\n    });\n  };\n  /**\r\n   * Add JavaScript to this document. The supplied `script` is executed when the\r\n   * document is opened. The `script` can be used to perform some operation\r\n   * when the document is opened (e.g. logging to the console), or it can be\r\n   * used to define a function that can be referenced later in a JavaScript\r\n   * action. For example:\r\n   * ```js\r\n   * // Show \"Hello World!\" in the console when the PDF is opened\r\n   * pdfDoc.addJavaScript(\r\n   *   'main',\r\n   *   'console.show(); console.println(\"Hello World!\");'\r\n   * );\r\n   *\r\n   * // Define a function named \"foo\" that can be called in JavaScript Actions\r\n   * pdfDoc.addJavaScript(\r\n   *   'foo',\r\n   *   'function foo() { return \"foo\"; }'\r\n   * );\r\n   * ```\r\n   * See the [JavaScript for Acrobat API Reference](https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf)\r\n   * for details.\r\n   * @param name The name of the script. Must be unique per document.\r\n   * @param script The JavaScript to execute.\r\n   */\n\n\n  PDFDocument.prototype.addJavaScript = function (name, script) {\n    assertIs(name, 'name', ['string']);\n    assertIs(script, 'script', ['string']);\n    var embedder = JavaScriptEmbedder.for(script, name);\n    var ref = this.context.nextRef();\n    var javaScript = PDFJavaScript.of(ref, this, embedder);\n    this.javaScripts.push(javaScript);\n  };\n  /**\r\n   * Add an attachment to this document. Attachments are visible in the\r\n   * \"Attachments\" panel of Adobe Acrobat and some other PDF readers. Any\r\n   * type of file can be added as an attachment. This includes, but is not\r\n   * limited to, `.png`, `.jpg`, `.pdf`, `.csv`, `.docx`, and `.xlsx` files.\r\n   *\r\n   * The input data can be provided in multiple formats:\r\n   *\r\n   * | Type          | Contents                                                       |\r\n   * | ------------- | -------------------------------------------------------------- |\r\n   * | `string`      | A base64 encoded string (or data URI) containing an attachment |\r\n   * | `Uint8Array`  | The raw bytes of an attachment                                 |\r\n   * | `ArrayBuffer` | The raw bytes of an attachment                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // attachment=string\r\n   * await pdfDoc.attach('/9j/4AAQSkZJRgABAQAAAQABAAD/2wBD...', 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   * await pdfDoc.attach('data:image/jpeg;base64,/9j/4AAQ...', 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   *\r\n   * // attachment=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('cat_riding_unicorn.jpg')\r\n   * await pdfDoc.attach(uint8Array, 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   *\r\n   * // attachment=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/cat_riding_unicorn.jpg'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * await pdfDoc.attach(arrayBuffer, 'cat_riding_unicorn.jpg', {\r\n   *   mimeType: 'image/jpeg',\r\n   *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n   *   creationDate: new Date('2019/12/01'),\r\n   *   modificationDate: new Date('2020/04/19'),\r\n   * })\r\n   * ```\r\n   *\r\n   * @param attachment The input data containing the file to be attached.\r\n   * @param name The name of the file to be attached.\r\n   * @returns Resolves when the attachment is complete.\r\n   */\n\n\n  PDFDocument.prototype.attach = function (attachment, name, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var bytes, embedder, ref, embeddedFile;\n      return __generator(this, function (_a) {\n        assertIs(attachment, 'attachment', ['string', Uint8Array, ArrayBuffer]);\n        assertIs(name, 'name', ['string']);\n        assertOrUndefined(options.mimeType, 'mimeType', ['string']);\n        assertOrUndefined(options.description, 'description', ['string']);\n        assertOrUndefined(options.creationDate, 'options.creationDate', [Date]);\n        assertOrUndefined(options.modificationDate, 'options.modificationDate', [Date]);\n        assertIsOneOfOrUndefined(options.afRelationship, 'options.afRelationship', AFRelationship);\n        bytes = toUint8Array(attachment);\n        embedder = FileEmbedder.for(bytes, name, options);\n        ref = this.context.nextRef();\n        embeddedFile = PDFEmbeddedFile.of(ref, this, embedder);\n        this.embeddedFiles.push(embeddedFile);\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n  /**\r\n   * Embed a font into this document. The input data can be provided in multiple\r\n   * formats:\r\n   *\r\n   * | Type            | Contents                                                |\r\n   * | --------------- | ------------------------------------------------------- |\r\n   * | `StandardFonts` | One of the standard 14 fonts                            |\r\n   * | `string`        | A base64 encoded string (or data URI) containing a font |\r\n   * | `Uint8Array`    | The raw bytes of a font                                 |\r\n   * | `ArrayBuffer`   | The raw bytes of a font                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // font=StandardFonts\r\n   * import { StandardFonts } from 'pdf-lib'\r\n   * const font1 = await pdfDoc.embedFont(StandardFonts.Helvetica)\r\n   *\r\n   * // font=string\r\n   * const font2 = await pdfDoc.embedFont('AAEAAAAVAQAABABQRFNJRx/upe...')\r\n   * const font3 = await pdfDoc.embedFont('data:font/opentype;base64,AAEAAA...')\r\n   *\r\n   * // font=Uint8Array\r\n   * import fs from 'fs'\r\n   * const font4 = await pdfDoc.embedFont(fs.readFileSync('Ubuntu-R.ttf'))\r\n   *\r\n   * // font=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/ubuntu/Ubuntu-R.ttf'\r\n   * const ubuntuBytes = await fetch(url).then(res => res.arrayBuffer())\r\n   * const font5 = await pdfDoc.embedFont(ubuntuBytes)\r\n   * ```\r\n   * See also: [[registerFontkit]]\r\n   * @param font The input data for a font.\r\n   * @param options The options to be used when embedding the font.\r\n   * @returns Resolves with the embedded font.\r\n   */\n\n\n  PDFDocument.prototype.embedFont = function (font, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, subset, customName, features, embedder, bytes, fontkit, _b, ref, pdfFont;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            _a = options.subset, subset = _a === void 0 ? false : _a, customName = options.customName, features = options.features;\n            assertIs(font, 'font', ['string', Uint8Array, ArrayBuffer]);\n            assertIs(subset, 'subset', ['boolean']);\n            if (!isStandardFont(font)) return [3\n            /*break*/\n            , 1];\n            embedder = StandardFontEmbedder.for(font, customName);\n            return [3\n            /*break*/\n            , 7];\n\n          case 1:\n            if (!canBeConvertedToUint8Array(font)) return [3\n            /*break*/\n            , 6];\n            bytes = toUint8Array(font);\n            fontkit = this.assertFontkit();\n            if (!subset) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , CustomFontSubsetEmbedder.for(fontkit, bytes, customName, features)];\n\n          case 2:\n            _b = _c.sent();\n            return [3\n            /*break*/\n            , 5];\n\n          case 3:\n            return [4\n            /*yield*/\n            , CustomFontEmbedder.for(fontkit, bytes, customName, features)];\n\n          case 4:\n            _b = _c.sent();\n            _c.label = 5;\n\n          case 5:\n            embedder = _b;\n            return [3\n            /*break*/\n            , 7];\n\n          case 6:\n            throw new TypeError('`font` must be one of `StandardFonts | string | Uint8Array | ArrayBuffer`');\n\n          case 7:\n            ref = this.context.nextRef();\n            pdfFont = PDFFont.of(ref, this, embedder);\n            this.fonts.push(pdfFont);\n            return [2\n            /*return*/\n            , pdfFont];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed a standard font into this document.\r\n   * For example:\r\n   * ```js\r\n   * import { StandardFonts } from 'pdf-lib'\r\n   * const helveticaFont = pdfDoc.embedFont(StandardFonts.Helvetica)\r\n   * ```\r\n   * @param font The standard font to be embedded.\r\n   * @param customName The name to be used when embedding the font.\r\n   * @returns The embedded font.\r\n   */\n\n\n  PDFDocument.prototype.embedStandardFont = function (font, customName) {\n    assertIs(font, 'font', ['string']);\n\n    if (!isStandardFont(font)) {\n      throw new TypeError('`font` must be one of type `StandardFonts`');\n    }\n\n    var embedder = StandardFontEmbedder.for(font, customName);\n    var ref = this.context.nextRef();\n    var pdfFont = PDFFont.of(ref, this, embedder);\n    this.fonts.push(pdfFont);\n    return pdfFont;\n  };\n  /**\r\n   * Embed a JPEG image into this document. The input data can be provided in\r\n   * multiple formats:\r\n   *\r\n   * | Type          | Contents                                                      |\r\n   * | ------------- | ------------------------------------------------------------- |\r\n   * | `string`      | A base64 encoded string (or data URI) containing a JPEG image |\r\n   * | `Uint8Array`  | The raw bytes of a JPEG image                                 |\r\n   * | `ArrayBuffer` | The raw bytes of a JPEG image                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // jpg=string\r\n   * const image1 = await pdfDoc.embedJpg('/9j/4AAQSkZJRgABAQAAAQABAAD/2wBD...')\r\n   * const image2 = await pdfDoc.embedJpg('data:image/jpeg;base64,/9j/4AAQ...')\r\n   *\r\n   * // jpg=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('cat_riding_unicorn.jpg')\r\n   * const image3 = await pdfDoc.embedJpg(uint8Array)\r\n   *\r\n   * // jpg=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/cat_riding_unicorn.jpg'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * const image4 = await pdfDoc.embedJpg(arrayBuffer)\r\n   * ```\r\n   *\r\n   * @param jpg The input data for a JPEG image.\r\n   * @returns Resolves with the embedded image.\r\n   */\n\n\n  PDFDocument.prototype.embedJpg = function (jpg) {\n    return __awaiter(this, void 0, void 0, function () {\n      var bytes, embedder, ref, pdfImage;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            assertIs(jpg, 'jpg', ['string', Uint8Array, ArrayBuffer]);\n            bytes = toUint8Array(jpg);\n            return [4\n            /*yield*/\n            , JpegEmbedder.for(bytes)];\n\n          case 1:\n            embedder = _a.sent();\n            ref = this.context.nextRef();\n            pdfImage = PDFImage.of(ref, this, embedder);\n            this.images.push(pdfImage);\n            return [2\n            /*return*/\n            , pdfImage];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed a PNG image into this document. The input data can be provided in\r\n   * multiple formats:\r\n   *\r\n   * | Type          | Contents                                                     |\r\n   * | ------------- | ------------------------------------------------------------ |\r\n   * | `string`      | A base64 encoded string (or data URI) containing a PNG image |\r\n   * | `Uint8Array`  | The raw bytes of a PNG image                                 |\r\n   * | `ArrayBuffer` | The raw bytes of a PNG image                                 |\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * // png=string\r\n   * const image1 = await pdfDoc.embedPng('iVBORw0KGgoAAAANSUhEUgAAAlgAAAF3...')\r\n   * const image2 = await pdfDoc.embedPng('data:image/png;base64,iVBORw0KGg...')\r\n   *\r\n   * // png=Uint8Array\r\n   * import fs from 'fs'\r\n   * const uint8Array = fs.readFileSync('small_mario.png')\r\n   * const image3 = await pdfDoc.embedPng(uint8Array)\r\n   *\r\n   * // png=ArrayBuffer\r\n   * const url = 'https://pdf-lib.js.org/assets/small_mario.png'\r\n   * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n   * const image4 = await pdfDoc.embedPng(arrayBuffer)\r\n   * ```\r\n   *\r\n   * @param png The input data for a PNG image.\r\n   * @returns Resolves with the embedded image.\r\n   */\n\n\n  PDFDocument.prototype.embedPng = function (png) {\n    return __awaiter(this, void 0, void 0, function () {\n      var bytes, embedder, ref, pdfImage;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            assertIs(png, 'png', ['string', Uint8Array, ArrayBuffer]);\n            bytes = toUint8Array(png);\n            return [4\n            /*yield*/\n            , PngEmbedder.for(bytes)];\n\n          case 1:\n            embedder = _a.sent();\n            ref = this.context.nextRef();\n            pdfImage = PDFImage.of(ref, this, embedder);\n            this.images.push(pdfImage);\n            return [2\n            /*return*/\n            , pdfImage];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed one or more PDF pages into this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   *\r\n   * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n   * const sourcePdf = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n   *\r\n   * // Embed page 74 of `sourcePdf` into `pdfDoc`\r\n   * const [embeddedPage] = await pdfDoc.embedPdf(sourcePdf, [73])\r\n   * ```\r\n   *\r\n   * See [[PDFDocument.load]] for examples of the allowed input data formats.\r\n   *\r\n   * @param pdf The input data containing a PDF document.\r\n   * @param indices The indices of the pages that should be embedded.\r\n   * @returns Resolves with an array of the embedded pages.\r\n   */\n\n\n  PDFDocument.prototype.embedPdf = function (pdf, indices) {\n    if (indices === void 0) {\n      indices = [0];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var srcDoc, _a, srcPages;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            assertIs(pdf, 'pdf', ['string', Uint8Array, ArrayBuffer, [PDFDocument, 'PDFDocument']]);\n            assertIs(indices, 'indices', [Array]);\n            if (!(pdf instanceof PDFDocument)) return [3\n            /*break*/\n            , 1];\n            _a = pdf;\n            return [3\n            /*break*/\n            , 3];\n\n          case 1:\n            return [4\n            /*yield*/\n            , PDFDocument.load(pdf)];\n\n          case 2:\n            _a = _b.sent();\n            _b.label = 3;\n\n          case 3:\n            srcDoc = _a;\n            srcPages = pluckIndices(srcDoc.getPages(), indices);\n            return [2\n            /*return*/\n            , this.embedPages(srcPages)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed a single PDF page into this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   *\r\n   * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n   * const sourceBuffer = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n   * const sourcePdfDoc = await PDFDocument.load(sourceBuffer)\r\n   * const sourcePdfPage = sourcePdfDoc.getPages()[73]\r\n   *\r\n   * const embeddedPage = await pdfDoc.embedPage(\r\n   *   sourcePdfPage,\r\n   *\r\n   *   // Clip a section of the source page so that we only embed part of it\r\n   *   { left: 100, right: 450, bottom: 330, top: 570 },\r\n   *\r\n   *   // Translate all drawings of the embedded page by (10, 200) units\r\n   *   [1, 0, 0, 1, 10, 200],\r\n   * )\r\n   * ```\r\n   *\r\n   * @param page The page to be embedded.\r\n   * @param boundingBox\r\n   * Optionally, an area of the source page that should be embedded\r\n   * (defaults to entire page).\r\n   * @param transformationMatrix\r\n   * Optionally, a transformation matrix that is always applied to the embedded\r\n   * page anywhere it is drawn.\r\n   * @returns Resolves with the embedded pdf page.\r\n   */\n\n\n  PDFDocument.prototype.embedPage = function (page, boundingBox, transformationMatrix) {\n    return __awaiter(this, void 0, void 0, function () {\n      var embeddedPage;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            assertIs(page, 'page', [[PDFPage, 'PDFPage']]);\n            return [4\n            /*yield*/\n            , this.embedPages([page], [boundingBox], [transformationMatrix])];\n\n          case 1:\n            embeddedPage = _a.sent()[0];\n            return [2\n            /*return*/\n            , embeddedPage];\n        }\n      });\n    });\n  };\n  /**\r\n   * Embed one or more PDF pages into this document.\r\n   *\r\n   * For example:\r\n   * ```js\r\n   * const pdfDoc = await PDFDocument.create()\r\n   *\r\n   * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n   * const sourceBuffer = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n   * const sourcePdfDoc = await PDFDocument.load(sourceBuffer)\r\n   *\r\n   * const page1 = sourcePdfDoc.getPages()[0]\r\n   * const page2 = sourcePdfDoc.getPages()[52]\r\n   * const page3 = sourcePdfDoc.getPages()[73]\r\n   *\r\n   * const embeddedPages = await pdfDoc.embedPages([page1, page2, page3])\r\n   * ```\r\n   *\r\n   * @param page\r\n   * The pages to be embedded (they must all share the same context).\r\n   * @param boundingBoxes\r\n   * Optionally, an array of clipping boundaries - one for each page\r\n   * (defaults to entirety of each page).\r\n   * @param transformationMatrices\r\n   * Optionally, an array of transformation matrices - one for each page\r\n   * (each page's transformation will apply anywhere it is drawn).\r\n   * @returns Resolves with an array of the embedded pdf pages.\r\n   */\n\n\n  PDFDocument.prototype.embedPages = function (pages, boundingBoxes, transformationMatrices) {\n    if (boundingBoxes === void 0) {\n      boundingBoxes = [];\n    }\n\n    if (transformationMatrices === void 0) {\n      transformationMatrices = [];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var idx, len, currPage, nextPage, context, maybeCopyPage, embeddedPages, idx, len, page, box, matrix, embedder, ref;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (pages.length === 0) return [2\n            /*return*/\n            , []]; // Assert all pages have the same context\n\n            for (idx = 0, len = pages.length - 1; idx < len; idx++) {\n              currPage = pages[idx];\n              nextPage = pages[idx + 1];\n\n              if (currPage.node.context !== nextPage.node.context) {\n                throw new PageEmbeddingMismatchedContextError();\n              }\n            }\n\n            context = pages[0].node.context;\n            maybeCopyPage = context === this.context ? function (p) {\n              return p;\n            } : PDFObjectCopier.for(context, this.context).copy;\n            embeddedPages = new Array(pages.length);\n            idx = 0, len = pages.length;\n            _b.label = 1;\n\n          case 1:\n            if (!(idx < len)) return [3\n            /*break*/\n            , 4];\n            page = maybeCopyPage(pages[idx].node);\n            box = boundingBoxes[idx];\n            matrix = transformationMatrices[idx];\n            return [4\n            /*yield*/\n            , PDFPageEmbedder.for(page, box, matrix)];\n\n          case 2:\n            embedder = _b.sent();\n            ref = this.context.nextRef();\n            embeddedPages[idx] = PDFEmbeddedPage.of(ref, this, embedder);\n            _b.label = 3;\n\n          case 3:\n            idx++;\n            return [3\n            /*break*/\n            , 1];\n\n          case 4:\n            (_a = this.embeddedPages).push.apply(_a, embeddedPages);\n\n            return [2\n            /*return*/\n            , embeddedPages];\n        }\n      });\n    });\n  };\n  /**\r\n   * > **NOTE:** You shouldn't need to call this method directly. The [[save]]\r\n   * > and [[saveAsBase64]] methods will automatically ensure that all embedded\r\n   * > assets are flushed before serializing the document.\r\n   *\r\n   * Flush all embedded fonts, PDF pages, and images to this document's\r\n   * [[context]].\r\n   *\r\n   * @returns Resolves when the flush is complete.\r\n   */\n\n\n  PDFDocument.prototype.flush = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.embedAll(this.fonts)];\n\n          case 1:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.embedAll(this.images)];\n\n          case 2:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.embedAll(this.embeddedPages)];\n\n          case 3:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.embedAll(this.embeddedFiles)];\n\n          case 4:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.embedAll(this.javaScripts)];\n\n          case 5:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * Serialize this document to an array of bytes making up a PDF file.\r\n   * For example:\r\n   * ```js\r\n   * const pdfBytes = await pdfDoc.save()\r\n   * ```\r\n   *\r\n   * There are a number of things you can do with the serialized document,\r\n   * depending on the JavaScript environment you're running in:\r\n   * * Write it to a file in Node or React Native\r\n   * * Download it as a Blob in the browser\r\n   * * Render it in an `iframe`\r\n   *\r\n   * @param options The options to be used when saving the document.\r\n   * @returns Resolves with the bytes of the serialized document.\r\n   */\n\n\n  PDFDocument.prototype.save = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, useObjectStreams, _b, addDefaultPage, _c, objectsPerTick, _d, updateFieldAppearances, form, Writer;\n\n      return __generator(this, function (_e) {\n        switch (_e.label) {\n          case 0:\n            _a = options.useObjectStreams, useObjectStreams = _a === void 0 ? true : _a, _b = options.addDefaultPage, addDefaultPage = _b === void 0 ? true : _b, _c = options.objectsPerTick, objectsPerTick = _c === void 0 ? 50 : _c, _d = options.updateFieldAppearances, updateFieldAppearances = _d === void 0 ? true : _d;\n            assertIs(useObjectStreams, 'useObjectStreams', ['boolean']);\n            assertIs(addDefaultPage, 'addDefaultPage', ['boolean']);\n            assertIs(objectsPerTick, 'objectsPerTick', ['number']);\n            assertIs(updateFieldAppearances, 'updateFieldAppearances', ['boolean']);\n            if (addDefaultPage && this.getPageCount() === 0) this.addPage();\n\n            if (updateFieldAppearances) {\n              form = this.formCache.getValue();\n              if (form) form.updateFieldAppearances();\n            }\n\n            return [4\n            /*yield*/\n            , this.flush()];\n\n          case 1:\n            _e.sent();\n\n            Writer = useObjectStreams ? PDFStreamWriter : PDFWriter;\n            return [2\n            /*return*/\n            , Writer.forContext(this.context, objectsPerTick).serializeToBuffer()];\n        }\n      });\n    });\n  };\n  /**\r\n   * Serialize this document to a base64 encoded string or data URI making up a\r\n   * PDF file. For example:\r\n   * ```js\r\n   * const base64String = await pdfDoc.saveAsBase64()\r\n   * base64String // => 'JVBERi0xLjcKJYGBgYEKC...'\r\n   *\r\n   * const base64DataUri = await pdfDoc.saveAsBase64({ dataUri: true })\r\n   * base64DataUri // => 'data:application/pdf;base64,JVBERi0xLjcKJYGBgYEKC...'\r\n   * ```\r\n   *\r\n   * @param options The options to be used when saving the document.\r\n   * @returns Resolves with a base64 encoded string or data URI of the\r\n   *          serialized document.\r\n   */\n\n\n  PDFDocument.prototype.saveAsBase64 = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, dataUri, otherOptions, bytes, base64;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = options.dataUri, dataUri = _a === void 0 ? false : _a, otherOptions = __rest(options, [\"dataUri\"]);\n            assertIs(dataUri, 'dataUri', ['boolean']);\n            return [4\n            /*yield*/\n            , this.save(otherOptions)];\n\n          case 1:\n            bytes = _b.sent();\n            base64 = encodeToBase64(bytes);\n            return [2\n            /*return*/\n            , dataUri ? \"data:application/pdf;base64,\" + base64 : base64];\n        }\n      });\n    });\n  };\n\n  PDFDocument.prototype.findPageForAnnotationRef = function (ref) {\n    var pages = this.getPages();\n\n    for (var idx = 0, len = pages.length; idx < len; idx++) {\n      var page = pages[idx];\n      var annotations = page.node.Annots();\n\n      if ((annotations === null || annotations === void 0 ? void 0 : annotations.indexOf(ref)) !== undefined) {\n        return page;\n      }\n    }\n\n    return undefined;\n  };\n\n  PDFDocument.prototype.embedAll = function (embeddables) {\n    return __awaiter(this, void 0, void 0, function () {\n      var idx, len;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            idx = 0, len = embeddables.length;\n            _a.label = 1;\n\n          case 1:\n            if (!(idx < len)) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , embeddables[idx].embed()];\n\n          case 2:\n            _a.sent();\n\n            _a.label = 3;\n\n          case 3:\n            idx++;\n            return [3\n            /*break*/\n            , 1];\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  PDFDocument.prototype.updateInfoDict = function () {\n    var pdfLib = \"pdf-lib (https://github.com/Hopding/pdf-lib)\";\n    var now = new Date();\n    var info = this.getInfoDict();\n    this.setProducer(pdfLib);\n    this.setModificationDate(now);\n    if (!info.get(PDFName.of('Creator'))) this.setCreator(pdfLib);\n    if (!info.get(PDFName.of('CreationDate'))) this.setCreationDate(now);\n  };\n\n  PDFDocument.prototype.getInfoDict = function () {\n    var existingInfo = this.context.lookup(this.context.trailerInfo.Info);\n    if (existingInfo instanceof PDFDict) return existingInfo;\n    var newInfo = this.context.obj({});\n    this.context.trailerInfo.Info = this.context.register(newInfo);\n    return newInfo;\n  };\n\n  PDFDocument.prototype.assertFontkit = function () {\n    if (!this.fontkit) throw new FontkitNotRegisteredError();\n    return this.fontkit;\n  };\n\n  return PDFDocument;\n}();\n\nexport default PDFDocument;\n/* tslint:disable-next-line only-arrow-functions */\n\nfunction assertIsLiteralOrHexString(pdfObject) {\n  if (!(pdfObject instanceof PDFHexString) && !(pdfObject instanceof PDFString)) {\n    throw new UnexpectedObjectTypeError([PDFHexString, PDFString], pdfObject);\n  }\n}","map":{"version":3,"sources":["../../src/api/PDFDocument.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __awaiter, __generator, __rest } from \"tslib\";\r\nimport { EncryptedPDFError, FontkitNotRegisteredError, ForeignPageError, RemovePageFromEmptyDocumentError, } from \"./errors\";\r\nimport PDFEmbeddedPage from \"./PDFEmbeddedPage\";\r\nimport PDFFont from \"./PDFFont\";\r\nimport PDFImage from \"./PDFImage\";\r\nimport PDFPage from \"./PDFPage\";\r\nimport PDFForm from \"./form/PDFForm\";\r\nimport { PageSizes } from \"./sizes\";\r\nimport { CustomFontEmbedder, CustomFontSubsetEmbedder, JpegEmbedder, PageEmbeddingMismatchedContextError, PDFCatalog, PDFContext, PDFDict, PDFHexString, PDFName, PDFObjectCopier, PDFPageEmbedder, PDFPageLeaf, PDFPageTree, PDFParser, PDFStreamWriter, PDFString, PDFWriter, PngEmbedder, StandardFontEmbedder, UnexpectedObjectTypeError, } from \"../core\";\r\nimport { ParseSpeeds, } from \"./PDFDocumentOptions\";\r\nimport { assertIs, assertIsOneOfOrUndefined, assertOrUndefined, assertRange, Cache, canBeConvertedToUint8Array, encodeToBase64, isStandardFont, pluckIndices, range, toUint8Array, } from \"../utils\";\r\nimport FileEmbedder, { AFRelationship } from \"../core/embedders/FileEmbedder\";\r\nimport PDFEmbeddedFile from \"./PDFEmbeddedFile\";\r\nimport PDFJavaScript from \"./PDFJavaScript\";\r\nimport JavaScriptEmbedder from \"../core/embedders/JavaScriptEmbedder\";\r\n/**\r\n * Represents a PDF document.\r\n */\r\nvar PDFDocument = /** @class */ (function () {\r\n    function PDFDocument(context, ignoreEncryption, updateMetadata) {\r\n        var _this = this;\r\n        /** The default word breaks used in PDFPage.drawText */\r\n        this.defaultWordBreaks = [' '];\r\n        this.computePages = function () {\r\n            var pages = [];\r\n            _this.catalog.Pages().traverse(function (node, ref) {\r\n                if (node instanceof PDFPageLeaf) {\r\n                    var page = _this.pageMap.get(node);\r\n                    if (!page) {\r\n                        page = PDFPage.of(node, ref, _this);\r\n                        _this.pageMap.set(node, page);\r\n                    }\r\n                    pages.push(page);\r\n                }\r\n            });\r\n            return pages;\r\n        };\r\n        this.getOrCreateForm = function () {\r\n            var acroForm = _this.catalog.getOrCreateAcroForm();\r\n            return PDFForm.of(acroForm, _this);\r\n        };\r\n        assertIs(context, 'context', [[PDFContext, 'PDFContext']]);\r\n        assertIs(ignoreEncryption, 'ignoreEncryption', ['boolean']);\r\n        this.context = context;\r\n        this.catalog = context.lookup(context.trailerInfo.Root);\r\n        this.isEncrypted = !!context.lookup(context.trailerInfo.Encrypt);\r\n        this.pageCache = Cache.populatedBy(this.computePages);\r\n        this.pageMap = new Map();\r\n        this.formCache = Cache.populatedBy(this.getOrCreateForm);\r\n        this.fonts = [];\r\n        this.images = [];\r\n        this.embeddedPages = [];\r\n        this.embeddedFiles = [];\r\n        this.javaScripts = [];\r\n        if (!ignoreEncryption && this.isEncrypted)\r\n            throw new EncryptedPDFError();\r\n        if (updateMetadata)\r\n            this.updateInfoDict();\r\n    }\r\n    /**\r\n     * Load an existing [[PDFDocument]]. The input data can be provided in\r\n     * multiple formats:\r\n     *\r\n     * | Type          | Contents                                               |\r\n     * | ------------- | ------------------------------------------------------ |\r\n     * | `string`      | A base64 encoded string (or data URI) containing a PDF |\r\n     * | `Uint8Array`  | The raw bytes of a PDF                                 |\r\n     * | `ArrayBuffer` | The raw bytes of a PDF                                 |\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * import { PDFDocument } from 'pdf-lib'\r\n     *\r\n     * // pdf=string\r\n     * const base64 =\r\n     *  'JVBERi0xLjcKJYGBgYEKCjUgMCBvYmoKPDwKL0ZpbHRlciAvRmxhdGVEZWNvZGUKL0xlbm' +\r\n     *  'd0aCAxMDQKPj4Kc3RyZWFtCniccwrhMlAAwaJ0Ln2P1Jyy1JLM5ERdc0MjCwUjE4WQNC4Q' +\r\n     *  '6cNlCFZkqGCqYGSqEJLLZWNuYGZiZmbkYuZsZmlmZGRgZmluDCQNzc3NTM2NzdzMXMxMjQ' +\r\n     *  'ztFEKyuEK0uFxDuAAOERdVCmVuZHN0cmVhbQplbmRvYmoKCjYgMCBvYmoKPDwKL0ZpbHRl' +\r\n     *  'ciAvRmxhdGVEZWNvZGUKL1R5cGUgL09ialN0bQovTiA0Ci9GaXJzdCAyMAovTGVuZ3RoID' +\r\n     *  'IxNQo+PgpzdHJlYW0KeJxVj9GqwjAMhu/zFHkBzTo3nCCCiiKIHPEICuJF3cKoSCu2E8/b' +\r\n     *  '20wPIr1p8v9/8kVhgilmGfawX2CGaVrgcAi0/bsy0lrX7IGWpvJ4iJYEN3gEmrrGBlQwGs' +\r\n     *  'HHO9VBX1wNrxAqMX87RBD5xpJuddqwd82tjAHxzV1U5LPgy52DKXWnr1Lheg+j/c/pzGVr' +\r\n     *  'iqV0VlwZPXGPCJjElw/ybkwUmeoWgxesDXGhHJC/D/iikp1Av80ptKU0FdBEe25pPihAM1' +\r\n     *  'u6ytgaaWfs2Hrz35CJT1+EWmAKZW5kc3RyZWFtCmVuZG9iagoKNyAwIG9iago8PAovU2l6' +\r\n     *  'ZSA4Ci9Sb290IDIgMCBSCi9GaWx0ZXIgL0ZsYXRlRGVjb2RlCi9UeXBlIC9YUmVmCi9MZW' +\r\n     *  '5ndGggMzgKL1cgWyAxIDIgMiBdCi9JbmRleCBbIDAgOCBdCj4+CnN0cmVhbQp4nBXEwREA' +\r\n     *  'EBAEsCwz3vrvRmOOyyOoGhZdutHN2MT55fIAVocD+AplbmRzdHJlYW0KZW5kb2JqCgpzdG' +\r\n     *  'FydHhyZWYKNTEwCiUlRU9G'\r\n     *\r\n     * const dataUri = 'data:application/pdf;base64,' + base64\r\n     *\r\n     * const pdfDoc1 = await PDFDocument.load(base64)\r\n     * const pdfDoc2 = await PDFDocument.load(dataUri)\r\n     *\r\n     * // pdf=Uint8Array\r\n     * import fs from 'fs'\r\n     * const uint8Array = fs.readFileSync('with_update_sections.pdf')\r\n     * const pdfDoc3 = await PDFDocument.load(uint8Array)\r\n     *\r\n     * // pdf=ArrayBuffer\r\n     * const url = 'https://pdf-lib.js.org/assets/with_update_sections.pdf'\r\n     * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n     * const pdfDoc4 = await PDFDocument.load(arrayBuffer)\r\n     *\r\n     * ```\r\n     *\r\n     * @param pdf The input data containing a PDF document.\r\n     * @param options The options to be used when loading the document.\r\n     * @returns Resolves with a document loaded from the input.\r\n     */\r\n    PDFDocument.load = function (pdf, options) {\r\n        if (options === void 0) { options = {}; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, ignoreEncryption, _b, parseSpeed, _c, throwOnInvalidObject, _d, updateMetadata, _e, capNumbers, bytes, context;\r\n            return __generator(this, function (_f) {\r\n                switch (_f.label) {\r\n                    case 0:\r\n                        _a = options.ignoreEncryption, ignoreEncryption = _a === void 0 ? false : _a, _b = options.parseSpeed, parseSpeed = _b === void 0 ? ParseSpeeds.Slow : _b, _c = options.throwOnInvalidObject, throwOnInvalidObject = _c === void 0 ? false : _c, _d = options.updateMetadata, updateMetadata = _d === void 0 ? true : _d, _e = options.capNumbers, capNumbers = _e === void 0 ? false : _e;\r\n                        assertIs(pdf, 'pdf', ['string', Uint8Array, ArrayBuffer]);\r\n                        assertIs(ignoreEncryption, 'ignoreEncryption', ['boolean']);\r\n                        assertIs(parseSpeed, 'parseSpeed', ['number']);\r\n                        assertIs(throwOnInvalidObject, 'throwOnInvalidObject', ['boolean']);\r\n                        bytes = toUint8Array(pdf);\r\n                        return [4 /*yield*/, PDFParser.forBytesWithOptions(bytes, parseSpeed, throwOnInvalidObject, capNumbers).parseDocument()];\r\n                    case 1:\r\n                        context = _f.sent();\r\n                        return [2 /*return*/, new PDFDocument(context, ignoreEncryption, updateMetadata)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Create a new [[PDFDocument]].\r\n     * @returns Resolves with the newly created document.\r\n     */\r\n    PDFDocument.create = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, updateMetadata, context, pageTree, pageTreeRef, catalog;\r\n            return __generator(this, function (_b) {\r\n                _a = options.updateMetadata, updateMetadata = _a === void 0 ? true : _a;\r\n                context = PDFContext.create();\r\n                pageTree = PDFPageTree.withContext(context);\r\n                pageTreeRef = context.register(pageTree);\r\n                catalog = PDFCatalog.withContextAndPages(context, pageTreeRef);\r\n                context.trailerInfo.Root = context.register(catalog);\r\n                return [2 /*return*/, new PDFDocument(context, false, updateMetadata)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Register a fontkit instance. This must be done before custom fonts can\r\n     * be embedded. See [here](https://github.com/Hopding/pdf-lib/tree/master#fontkit-installation)\r\n     * for instructions on how to install and register a fontkit instance.\r\n     *\r\n     * > You do **not** need to call this method to embed standard fonts.\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * import { PDFDocument } from 'pdf-lib'\r\n     * import fontkit from '@pdf-lib/fontkit'\r\n     *\r\n     * const pdfDoc = await PDFDocument.create()\r\n     * pdfDoc.registerFontkit(fontkit)\r\n     * ```\r\n     *\r\n     * @param fontkit The fontkit instance to be registered.\r\n     */\r\n    PDFDocument.prototype.registerFontkit = function (fontkit) {\r\n        this.fontkit = fontkit;\r\n    };\r\n    /**\r\n     * Get the [[PDFForm]] containing all interactive fields for this document.\r\n     * For example:\r\n     * ```js\r\n     * const form = pdfDoc.getForm()\r\n     * const fields = form.getFields()\r\n     * fields.forEach(field => {\r\n     *   const type = field.constructor.name\r\n     *   const name = field.getName()\r\n     *   console.log(`${type}: ${name}`)\r\n     * })\r\n     * ```\r\n     * @returns The form for this document.\r\n     */\r\n    PDFDocument.prototype.getForm = function () {\r\n        var form = this.formCache.access();\r\n        if (form.hasXFA()) {\r\n            console.warn('Removing XFA form data as pdf-lib does not support reading or writing XFA');\r\n            form.deleteXFA();\r\n        }\r\n        return form;\r\n    };\r\n    /**\r\n     * Get this document's title metadata. The title appears in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * const title = pdfDoc.getTitle()\r\n     * ```\r\n     * @returns A string containing the title of this document, if it has one.\r\n     */\r\n    PDFDocument.prototype.getTitle = function () {\r\n        var title = this.getInfoDict().lookup(PDFName.Title);\r\n        if (!title)\r\n            return undefined;\r\n        assertIsLiteralOrHexString(title);\r\n        return title.decodeText();\r\n    };\r\n    /**\r\n     * Get this document's author metadata. The author appears in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * const author = pdfDoc.getAuthor()\r\n     * ```\r\n     * @returns A string containing the author of this document, if it has one.\r\n     */\r\n    PDFDocument.prototype.getAuthor = function () {\r\n        var author = this.getInfoDict().lookup(PDFName.Author);\r\n        if (!author)\r\n            return undefined;\r\n        assertIsLiteralOrHexString(author);\r\n        return author.decodeText();\r\n    };\r\n    /**\r\n     * Get this document's subject metadata. The subject appears in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * const subject = pdfDoc.getSubject()\r\n     * ```\r\n     * @returns A string containing the subject of this document, if it has one.\r\n     */\r\n    PDFDocument.prototype.getSubject = function () {\r\n        var subject = this.getInfoDict().lookup(PDFName.Subject);\r\n        if (!subject)\r\n            return undefined;\r\n        assertIsLiteralOrHexString(subject);\r\n        return subject.decodeText();\r\n    };\r\n    /**\r\n     * Get this document's keywords metadata. The keywords appear in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * const keywords = pdfDoc.getKeywords()\r\n     * ```\r\n     * @returns A string containing the keywords of this document, if it has any.\r\n     */\r\n    PDFDocument.prototype.getKeywords = function () {\r\n        var keywords = this.getInfoDict().lookup(PDFName.Keywords);\r\n        if (!keywords)\r\n            return undefined;\r\n        assertIsLiteralOrHexString(keywords);\r\n        return keywords.decodeText();\r\n    };\r\n    /**\r\n     * Get this document's creator metadata. The creator appears in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * const creator = pdfDoc.getCreator()\r\n     * ```\r\n     * @returns A string containing the creator of this document, if it has one.\r\n     */\r\n    PDFDocument.prototype.getCreator = function () {\r\n        var creator = this.getInfoDict().lookup(PDFName.Creator);\r\n        if (!creator)\r\n            return undefined;\r\n        assertIsLiteralOrHexString(creator);\r\n        return creator.decodeText();\r\n    };\r\n    /**\r\n     * Get this document's producer metadata. The producer appears in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * const producer = pdfDoc.getProducer()\r\n     * ```\r\n     * @returns A string containing the producer of this document, if it has one.\r\n     */\r\n    PDFDocument.prototype.getProducer = function () {\r\n        var producer = this.getInfoDict().lookup(PDFName.Producer);\r\n        if (!producer)\r\n            return undefined;\r\n        assertIsLiteralOrHexString(producer);\r\n        return producer.decodeText();\r\n    };\r\n    /**\r\n     * Get this document's creation date metadata. The creation date appears in\r\n     * the \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * const creationDate = pdfDoc.getCreationDate()\r\n     * ```\r\n     * @returns A Date containing the creation date of this document,\r\n     *          if it has one.\r\n     */\r\n    PDFDocument.prototype.getCreationDate = function () {\r\n        var creationDate = this.getInfoDict().lookup(PDFName.CreationDate);\r\n        if (!creationDate)\r\n            return undefined;\r\n        assertIsLiteralOrHexString(creationDate);\r\n        return creationDate.decodeDate();\r\n    };\r\n    /**\r\n     * Get this document's modification date metadata. The modification date\r\n     * appears in the \"Document Properties\" section of most PDF readers.\r\n     * For example:\r\n     * ```js\r\n     * const modification = pdfDoc.getModificationDate()\r\n     * ```\r\n     * @returns A Date containing the modification date of this document,\r\n     *          if it has one.\r\n     */\r\n    PDFDocument.prototype.getModificationDate = function () {\r\n        var modificationDate = this.getInfoDict().lookup(PDFName.ModDate);\r\n        if (!modificationDate)\r\n            return undefined;\r\n        assertIsLiteralOrHexString(modificationDate);\r\n        return modificationDate.decodeDate();\r\n    };\r\n    /**\r\n     * Set this document's title metadata. The title will appear in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * pdfDoc.setTitle('🥚 The Life of an Egg 🍳')\r\n     * ```\r\n     *\r\n     * To display the title in the window's title bar, set the\r\n     * `showInWindowTitleBar` option to `true` (works for _most_ PDF readers).\r\n     * For example:\r\n     * ```js\r\n     * pdfDoc.setTitle('🥚 The Life of an Egg 🍳', { showInWindowTitleBar: true })\r\n     * ```\r\n     *\r\n     * @param title The title of this document.\r\n     * @param options The options to be used when setting the title.\r\n     */\r\n    PDFDocument.prototype.setTitle = function (title, options) {\r\n        assertIs(title, 'title', ['string']);\r\n        var key = PDFName.of('Title');\r\n        this.getInfoDict().set(key, PDFHexString.fromText(title));\r\n        // Indicate that readers should display the title rather than the filename\r\n        if (options === null || options === void 0 ? void 0 : options.showInWindowTitleBar) {\r\n            var prefs = this.catalog.getOrCreateViewerPreferences();\r\n            prefs.setDisplayDocTitle(true);\r\n        }\r\n    };\r\n    /**\r\n     * Set this document's author metadata. The author will appear in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * pdfDoc.setAuthor('Humpty Dumpty')\r\n     * ```\r\n     * @param author The author of this document.\r\n     */\r\n    PDFDocument.prototype.setAuthor = function (author) {\r\n        assertIs(author, 'author', ['string']);\r\n        var key = PDFName.of('Author');\r\n        this.getInfoDict().set(key, PDFHexString.fromText(author));\r\n    };\r\n    /**\r\n     * Set this document's subject metadata. The subject will appear in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * pdfDoc.setSubject('📘 An Epic Tale of Woe 📖')\r\n     * ```\r\n     * @param subject The subject of this document.\r\n     */\r\n    PDFDocument.prototype.setSubject = function (subject) {\r\n        assertIs(subject, 'author', ['string']);\r\n        var key = PDFName.of('Subject');\r\n        this.getInfoDict().set(key, PDFHexString.fromText(subject));\r\n    };\r\n    /**\r\n     * Set this document's keyword metadata. These keywords will appear in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * pdfDoc.setKeywords(['eggs', 'wall', 'fall', 'king', 'horses', 'men'])\r\n     * ```\r\n     * @param keywords An array of keywords associated with this document.\r\n     */\r\n    PDFDocument.prototype.setKeywords = function (keywords) {\r\n        assertIs(keywords, 'keywords', [Array]);\r\n        var key = PDFName.of('Keywords');\r\n        this.getInfoDict().set(key, PDFHexString.fromText(keywords.join(' ')));\r\n    };\r\n    /**\r\n     * Set this document's creator metadata. The creator will appear in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * pdfDoc.setCreator('PDF App 9000 🤖')\r\n     * ```\r\n     * @param creator The creator of this document.\r\n     */\r\n    PDFDocument.prototype.setCreator = function (creator) {\r\n        assertIs(creator, 'creator', ['string']);\r\n        var key = PDFName.of('Creator');\r\n        this.getInfoDict().set(key, PDFHexString.fromText(creator));\r\n    };\r\n    /**\r\n     * Set this document's producer metadata. The producer will appear in the\r\n     * \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * pdfDoc.setProducer('PDF App 9000 🤖')\r\n     * ```\r\n     * @param producer The producer of this document.\r\n     */\r\n    PDFDocument.prototype.setProducer = function (producer) {\r\n        assertIs(producer, 'creator', ['string']);\r\n        var key = PDFName.of('Producer');\r\n        this.getInfoDict().set(key, PDFHexString.fromText(producer));\r\n    };\r\n    /**\r\n     * Set this document's language metadata. The language will appear in the\r\n     * \"Document Properties\" section of some PDF readers. For example:\r\n     * ```js\r\n     * pdfDoc.setLanguage('en-us')\r\n     * ```\r\n     *\r\n     * @param language An RFC 3066 _Language-Tag_ denoting the language of this\r\n     *                 document, or an empty string if the language is unknown.\r\n     */\r\n    PDFDocument.prototype.setLanguage = function (language) {\r\n        assertIs(language, 'language', ['string']);\r\n        var key = PDFName.of('Lang');\r\n        this.catalog.set(key, PDFString.of(language));\r\n    };\r\n    /**\r\n     * Set this document's creation date metadata. The creation date will appear\r\n     * in the \"Document Properties\" section of most PDF readers. For example:\r\n     * ```js\r\n     * pdfDoc.setCreationDate(new Date())\r\n     * ```\r\n     * @param creationDate The date this document was created.\r\n     */\r\n    PDFDocument.prototype.setCreationDate = function (creationDate) {\r\n        assertIs(creationDate, 'creationDate', [[Date, 'Date']]);\r\n        var key = PDFName.of('CreationDate');\r\n        this.getInfoDict().set(key, PDFString.fromDate(creationDate));\r\n    };\r\n    /**\r\n     * Set this document's modification date metadata. The modification date will\r\n     * appear in the \"Document Properties\" section of most PDF readers. For\r\n     * example:\r\n     * ```js\r\n     * pdfDoc.setModificationDate(new Date())\r\n     * ```\r\n     * @param modificationDate The date this document was last modified.\r\n     */\r\n    PDFDocument.prototype.setModificationDate = function (modificationDate) {\r\n        assertIs(modificationDate, 'modificationDate', [[Date, 'Date']]);\r\n        var key = PDFName.of('ModDate');\r\n        this.getInfoDict().set(key, PDFString.fromDate(modificationDate));\r\n    };\r\n    /**\r\n     * Get the number of pages contained in this document. For example:\r\n     * ```js\r\n     * const totalPages = pdfDoc.getPageCount()\r\n     * ```\r\n     * @returns The number of pages in this document.\r\n     */\r\n    PDFDocument.prototype.getPageCount = function () {\r\n        if (this.pageCount === undefined)\r\n            this.pageCount = this.getPages().length;\r\n        return this.pageCount;\r\n    };\r\n    /**\r\n     * Get an array of all the pages contained in this document. The pages are\r\n     * stored in the array in the same order that they are rendered in the\r\n     * document. For example:\r\n     * ```js\r\n     * const pages = pdfDoc.getPages()\r\n     * pages[0]   // The first page of the document\r\n     * pages[2]   // The third page of the document\r\n     * pages[197] // The 198th page of the document\r\n     * ```\r\n     * @returns An array of all the pages contained in this document.\r\n     */\r\n    PDFDocument.prototype.getPages = function () {\r\n        return this.pageCache.access();\r\n    };\r\n    /**\r\n     * Get the page rendered at a particular `index` of the document. For example:\r\n     * ```js\r\n     * pdfDoc.getPage(0)   // The first page of the document\r\n     * pdfDoc.getPage(2)   // The third page of the document\r\n     * pdfDoc.getPage(197) // The 198th page of the document\r\n     * ```\r\n     * @returns The [[PDFPage]] rendered at the given `index` of the document.\r\n     */\r\n    PDFDocument.prototype.getPage = function (index) {\r\n        var pages = this.getPages();\r\n        assertRange(index, 'index', 0, pages.length - 1);\r\n        return pages[index];\r\n    };\r\n    /**\r\n     * Get an array of indices for all the pages contained in this document. The\r\n     * array will contain a range of integers from\r\n     * `0..pdfDoc.getPageCount() - 1`. For example:\r\n     * ```js\r\n     * const pdfDoc = await PDFDocument.create()\r\n     * pdfDoc.addPage()\r\n     * pdfDoc.addPage()\r\n     * pdfDoc.addPage()\r\n     *\r\n     * const indices = pdfDoc.getPageIndices()\r\n     * indices // => [0, 1, 2]\r\n     * ```\r\n     * @returns An array of indices for all pages contained in this document.\r\n     */\r\n    PDFDocument.prototype.getPageIndices = function () {\r\n        return range(0, this.getPageCount());\r\n    };\r\n    /**\r\n     * Remove the page at a given index from this document. For example:\r\n     * ```js\r\n     * pdfDoc.removePage(0)   // Remove the first page of the document\r\n     * pdfDoc.removePage(2)   // Remove the third page of the document\r\n     * pdfDoc.removePage(197) // Remove the 198th page of the document\r\n     * ```\r\n     * Once a page has been removed, it will no longer be rendered at that index\r\n     * in the document.\r\n     * @param index The index of the page to be removed.\r\n     */\r\n    PDFDocument.prototype.removePage = function (index) {\r\n        var pageCount = this.getPageCount();\r\n        if (this.pageCount === 0)\r\n            throw new RemovePageFromEmptyDocumentError();\r\n        assertRange(index, 'index', 0, pageCount - 1);\r\n        this.catalog.removeLeafNode(index);\r\n        this.pageCount = pageCount - 1;\r\n    };\r\n    /**\r\n     * Add a page to the end of this document. This method accepts three\r\n     * different value types for the `page` parameter:\r\n     *\r\n     * | Type               | Behavior                                                                            |\r\n     * | ------------------ | ----------------------------------------------------------------------------------- |\r\n     * | `undefined`        | Create a new page and add it to the end of this document                            |\r\n     * | `[number, number]` | Create a new page with the given dimensions and add it to the end of this document  |\r\n     * | `PDFPage`          | Add the existing page to the end of this document                                   |\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * // page=undefined\r\n     * const newPage = pdfDoc.addPage()\r\n     *\r\n     * // page=[number, number]\r\n     * import { PageSizes } from 'pdf-lib'\r\n     * const newPage1 = pdfDoc.addPage(PageSizes.A7)\r\n     * const newPage2 = pdfDoc.addPage(PageSizes.Letter)\r\n     * const newPage3 = pdfDoc.addPage([500, 750])\r\n     *\r\n     * // page=PDFPage\r\n     * const pdfDoc1 = await PDFDocument.create()\r\n     * const pdfDoc2 = await PDFDocument.load(...)\r\n     * const [existingPage] = await pdfDoc1.copyPages(pdfDoc2, [0])\r\n     * pdfDoc1.addPage(existingPage)\r\n     * ```\r\n     *\r\n     * @param page Optionally, the desired dimensions or existing page.\r\n     * @returns The newly created (or existing) page.\r\n     */\r\n    PDFDocument.prototype.addPage = function (page) {\r\n        assertIs(page, 'page', ['undefined', [PDFPage, 'PDFPage'], Array]);\r\n        return this.insertPage(this.getPageCount(), page);\r\n    };\r\n    /**\r\n     * Insert a page at a given index within this document. This method accepts\r\n     * three different value types for the `page` parameter:\r\n     *\r\n     * | Type               | Behavior                                                                       |\r\n     * | ------------------ | ------------------------------------------------------------------------------ |\r\n     * | `undefined`        | Create a new page and insert it into this document                             |\r\n     * | `[number, number]` | Create a new page with the given dimensions and insert it into this document   |\r\n     * | `PDFPage`          | Insert the existing page into this document                                    |\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * // page=undefined\r\n     * const newPage = pdfDoc.insertPage(2)\r\n     *\r\n     * // page=[number, number]\r\n     * import { PageSizes } from 'pdf-lib'\r\n     * const newPage1 = pdfDoc.insertPage(2, PageSizes.A7)\r\n     * const newPage2 = pdfDoc.insertPage(0, PageSizes.Letter)\r\n     * const newPage3 = pdfDoc.insertPage(198, [500, 750])\r\n     *\r\n     * // page=PDFPage\r\n     * const pdfDoc1 = await PDFDocument.create()\r\n     * const pdfDoc2 = await PDFDocument.load(...)\r\n     * const [existingPage] = await pdfDoc1.copyPages(pdfDoc2, [0])\r\n     * pdfDoc1.insertPage(0, existingPage)\r\n     * ```\r\n     *\r\n     * @param index The index at which the page should be inserted (zero-based).\r\n     * @param page Optionally, the desired dimensions or existing page.\r\n     * @returns The newly created (or existing) page.\r\n     */\r\n    PDFDocument.prototype.insertPage = function (index, page) {\r\n        var pageCount = this.getPageCount();\r\n        assertRange(index, 'index', 0, pageCount);\r\n        assertIs(page, 'page', ['undefined', [PDFPage, 'PDFPage'], Array]);\r\n        if (!page || Array.isArray(page)) {\r\n            var dims = Array.isArray(page) ? page : PageSizes.A4;\r\n            page = PDFPage.create(this);\r\n            page.setSize.apply(page, dims);\r\n        }\r\n        else if (page.doc !== this) {\r\n            throw new ForeignPageError();\r\n        }\r\n        var parentRef = this.catalog.insertLeafNode(page.ref, index);\r\n        page.node.setParent(parentRef);\r\n        this.pageMap.set(page.node, page);\r\n        this.pageCache.invalidate();\r\n        this.pageCount = pageCount + 1;\r\n        return page;\r\n    };\r\n    /**\r\n     * Copy pages from a source document into this document. Allows pages to be\r\n     * copied between different [[PDFDocument]] instances. For example:\r\n     * ```js\r\n     * const pdfDoc = await PDFDocument.create()\r\n     * const srcDoc = await PDFDocument.load(...)\r\n     *\r\n     * const copiedPages = await pdfDoc.copyPages(srcDoc, [0, 3, 89])\r\n     * const [firstPage, fourthPage, ninetiethPage] = copiedPages;\r\n     *\r\n     * pdfDoc.addPage(fourthPage)\r\n     * pdfDoc.insertPage(0, ninetiethPage)\r\n     * pdfDoc.addPage(firstPage)\r\n     * ```\r\n     * @param srcDoc The document from which pages should be copied.\r\n     * @param indices The indices of the pages that should be copied.\r\n     * @returns Resolves with an array of pages copied into this document.\r\n     */\r\n    PDFDocument.prototype.copyPages = function (srcDoc, indices) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var copier, srcPages, copiedPages, idx, len, srcPage, copiedPage, ref;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        assertIs(srcDoc, 'srcDoc', [[PDFDocument, 'PDFDocument']]);\r\n                        assertIs(indices, 'indices', [Array]);\r\n                        return [4 /*yield*/, srcDoc.flush()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        copier = PDFObjectCopier.for(srcDoc.context, this.context);\r\n                        srcPages = srcDoc.getPages();\r\n                        copiedPages = new Array(indices.length);\r\n                        for (idx = 0, len = indices.length; idx < len; idx++) {\r\n                            srcPage = srcPages[indices[idx]];\r\n                            copiedPage = copier.copy(srcPage.node);\r\n                            ref = this.context.register(copiedPage);\r\n                            copiedPages[idx] = PDFPage.of(copiedPage, ref, this);\r\n                        }\r\n                        return [2 /*return*/, copiedPages];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Add JavaScript to this document. The supplied `script` is executed when the\r\n     * document is opened. The `script` can be used to perform some operation\r\n     * when the document is opened (e.g. logging to the console), or it can be\r\n     * used to define a function that can be referenced later in a JavaScript\r\n     * action. For example:\r\n     * ```js\r\n     * // Show \"Hello World!\" in the console when the PDF is opened\r\n     * pdfDoc.addJavaScript(\r\n     *   'main',\r\n     *   'console.show(); console.println(\"Hello World!\");'\r\n     * );\r\n     *\r\n     * // Define a function named \"foo\" that can be called in JavaScript Actions\r\n     * pdfDoc.addJavaScript(\r\n     *   'foo',\r\n     *   'function foo() { return \"foo\"; }'\r\n     * );\r\n     * ```\r\n     * See the [JavaScript for Acrobat API Reference](https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf)\r\n     * for details.\r\n     * @param name The name of the script. Must be unique per document.\r\n     * @param script The JavaScript to execute.\r\n     */\r\n    PDFDocument.prototype.addJavaScript = function (name, script) {\r\n        assertIs(name, 'name', ['string']);\r\n        assertIs(script, 'script', ['string']);\r\n        var embedder = JavaScriptEmbedder.for(script, name);\r\n        var ref = this.context.nextRef();\r\n        var javaScript = PDFJavaScript.of(ref, this, embedder);\r\n        this.javaScripts.push(javaScript);\r\n    };\r\n    /**\r\n     * Add an attachment to this document. Attachments are visible in the\r\n     * \"Attachments\" panel of Adobe Acrobat and some other PDF readers. Any\r\n     * type of file can be added as an attachment. This includes, but is not\r\n     * limited to, `.png`, `.jpg`, `.pdf`, `.csv`, `.docx`, and `.xlsx` files.\r\n     *\r\n     * The input data can be provided in multiple formats:\r\n     *\r\n     * | Type          | Contents                                                       |\r\n     * | ------------- | -------------------------------------------------------------- |\r\n     * | `string`      | A base64 encoded string (or data URI) containing an attachment |\r\n     * | `Uint8Array`  | The raw bytes of an attachment                                 |\r\n     * | `ArrayBuffer` | The raw bytes of an attachment                                 |\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * // attachment=string\r\n     * await pdfDoc.attach('/9j/4AAQSkZJRgABAQAAAQABAAD/2wBD...', 'cat_riding_unicorn.jpg', {\r\n     *   mimeType: 'image/jpeg',\r\n     *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n     *   creationDate: new Date('2019/12/01'),\r\n     *   modificationDate: new Date('2020/04/19'),\r\n     * })\r\n     * await pdfDoc.attach('data:image/jpeg;base64,/9j/4AAQ...', 'cat_riding_unicorn.jpg', {\r\n     *   mimeType: 'image/jpeg',\r\n     *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n     *   creationDate: new Date('2019/12/01'),\r\n     *   modificationDate: new Date('2020/04/19'),\r\n     * })\r\n     *\r\n     * // attachment=Uint8Array\r\n     * import fs from 'fs'\r\n     * const uint8Array = fs.readFileSync('cat_riding_unicorn.jpg')\r\n     * await pdfDoc.attach(uint8Array, 'cat_riding_unicorn.jpg', {\r\n     *   mimeType: 'image/jpeg',\r\n     *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n     *   creationDate: new Date('2019/12/01'),\r\n     *   modificationDate: new Date('2020/04/19'),\r\n     * })\r\n     *\r\n     * // attachment=ArrayBuffer\r\n     * const url = 'https://pdf-lib.js.org/assets/cat_riding_unicorn.jpg'\r\n     * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n     * await pdfDoc.attach(arrayBuffer, 'cat_riding_unicorn.jpg', {\r\n     *   mimeType: 'image/jpeg',\r\n     *   description: 'Cool cat riding a unicorn! 🦄🐈🕶️',\r\n     *   creationDate: new Date('2019/12/01'),\r\n     *   modificationDate: new Date('2020/04/19'),\r\n     * })\r\n     * ```\r\n     *\r\n     * @param attachment The input data containing the file to be attached.\r\n     * @param name The name of the file to be attached.\r\n     * @returns Resolves when the attachment is complete.\r\n     */\r\n    PDFDocument.prototype.attach = function (attachment, name, options) {\r\n        if (options === void 0) { options = {}; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var bytes, embedder, ref, embeddedFile;\r\n            return __generator(this, function (_a) {\r\n                assertIs(attachment, 'attachment', ['string', Uint8Array, ArrayBuffer]);\r\n                assertIs(name, 'name', ['string']);\r\n                assertOrUndefined(options.mimeType, 'mimeType', ['string']);\r\n                assertOrUndefined(options.description, 'description', ['string']);\r\n                assertOrUndefined(options.creationDate, 'options.creationDate', [Date]);\r\n                assertOrUndefined(options.modificationDate, 'options.modificationDate', [\r\n                    Date,\r\n                ]);\r\n                assertIsOneOfOrUndefined(options.afRelationship, 'options.afRelationship', AFRelationship);\r\n                bytes = toUint8Array(attachment);\r\n                embedder = FileEmbedder.for(bytes, name, options);\r\n                ref = this.context.nextRef();\r\n                embeddedFile = PDFEmbeddedFile.of(ref, this, embedder);\r\n                this.embeddedFiles.push(embeddedFile);\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Embed a font into this document. The input data can be provided in multiple\r\n     * formats:\r\n     *\r\n     * | Type            | Contents                                                |\r\n     * | --------------- | ------------------------------------------------------- |\r\n     * | `StandardFonts` | One of the standard 14 fonts                            |\r\n     * | `string`        | A base64 encoded string (or data URI) containing a font |\r\n     * | `Uint8Array`    | The raw bytes of a font                                 |\r\n     * | `ArrayBuffer`   | The raw bytes of a font                                 |\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * // font=StandardFonts\r\n     * import { StandardFonts } from 'pdf-lib'\r\n     * const font1 = await pdfDoc.embedFont(StandardFonts.Helvetica)\r\n     *\r\n     * // font=string\r\n     * const font2 = await pdfDoc.embedFont('AAEAAAAVAQAABABQRFNJRx/upe...')\r\n     * const font3 = await pdfDoc.embedFont('data:font/opentype;base64,AAEAAA...')\r\n     *\r\n     * // font=Uint8Array\r\n     * import fs from 'fs'\r\n     * const font4 = await pdfDoc.embedFont(fs.readFileSync('Ubuntu-R.ttf'))\r\n     *\r\n     * // font=ArrayBuffer\r\n     * const url = 'https://pdf-lib.js.org/assets/ubuntu/Ubuntu-R.ttf'\r\n     * const ubuntuBytes = await fetch(url).then(res => res.arrayBuffer())\r\n     * const font5 = await pdfDoc.embedFont(ubuntuBytes)\r\n     * ```\r\n     * See also: [[registerFontkit]]\r\n     * @param font The input data for a font.\r\n     * @param options The options to be used when embedding the font.\r\n     * @returns Resolves with the embedded font.\r\n     */\r\n    PDFDocument.prototype.embedFont = function (font, options) {\r\n        if (options === void 0) { options = {}; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, subset, customName, features, embedder, bytes, fontkit, _b, ref, pdfFont;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        _a = options.subset, subset = _a === void 0 ? false : _a, customName = options.customName, features = options.features;\r\n                        assertIs(font, 'font', ['string', Uint8Array, ArrayBuffer]);\r\n                        assertIs(subset, 'subset', ['boolean']);\r\n                        if (!isStandardFont(font)) return [3 /*break*/, 1];\r\n                        embedder = StandardFontEmbedder.for(font, customName);\r\n                        return [3 /*break*/, 7];\r\n                    case 1:\r\n                        if (!canBeConvertedToUint8Array(font)) return [3 /*break*/, 6];\r\n                        bytes = toUint8Array(font);\r\n                        fontkit = this.assertFontkit();\r\n                        if (!subset) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, CustomFontSubsetEmbedder.for(fontkit, bytes, customName, features)];\r\n                    case 2:\r\n                        _b = _c.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 3: return [4 /*yield*/, CustomFontEmbedder.for(fontkit, bytes, customName, features)];\r\n                    case 4:\r\n                        _b = _c.sent();\r\n                        _c.label = 5;\r\n                    case 5:\r\n                        embedder = _b;\r\n                        return [3 /*break*/, 7];\r\n                    case 6: throw new TypeError('`font` must be one of `StandardFonts | string | Uint8Array | ArrayBuffer`');\r\n                    case 7:\r\n                        ref = this.context.nextRef();\r\n                        pdfFont = PDFFont.of(ref, this, embedder);\r\n                        this.fonts.push(pdfFont);\r\n                        return [2 /*return*/, pdfFont];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Embed a standard font into this document.\r\n     * For example:\r\n     * ```js\r\n     * import { StandardFonts } from 'pdf-lib'\r\n     * const helveticaFont = pdfDoc.embedFont(StandardFonts.Helvetica)\r\n     * ```\r\n     * @param font The standard font to be embedded.\r\n     * @param customName The name to be used when embedding the font.\r\n     * @returns The embedded font.\r\n     */\r\n    PDFDocument.prototype.embedStandardFont = function (font, customName) {\r\n        assertIs(font, 'font', ['string']);\r\n        if (!isStandardFont(font)) {\r\n            throw new TypeError('`font` must be one of type `StandardFonts`');\r\n        }\r\n        var embedder = StandardFontEmbedder.for(font, customName);\r\n        var ref = this.context.nextRef();\r\n        var pdfFont = PDFFont.of(ref, this, embedder);\r\n        this.fonts.push(pdfFont);\r\n        return pdfFont;\r\n    };\r\n    /**\r\n     * Embed a JPEG image into this document. The input data can be provided in\r\n     * multiple formats:\r\n     *\r\n     * | Type          | Contents                                                      |\r\n     * | ------------- | ------------------------------------------------------------- |\r\n     * | `string`      | A base64 encoded string (or data URI) containing a JPEG image |\r\n     * | `Uint8Array`  | The raw bytes of a JPEG image                                 |\r\n     * | `ArrayBuffer` | The raw bytes of a JPEG image                                 |\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * // jpg=string\r\n     * const image1 = await pdfDoc.embedJpg('/9j/4AAQSkZJRgABAQAAAQABAAD/2wBD...')\r\n     * const image2 = await pdfDoc.embedJpg('data:image/jpeg;base64,/9j/4AAQ...')\r\n     *\r\n     * // jpg=Uint8Array\r\n     * import fs from 'fs'\r\n     * const uint8Array = fs.readFileSync('cat_riding_unicorn.jpg')\r\n     * const image3 = await pdfDoc.embedJpg(uint8Array)\r\n     *\r\n     * // jpg=ArrayBuffer\r\n     * const url = 'https://pdf-lib.js.org/assets/cat_riding_unicorn.jpg'\r\n     * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n     * const image4 = await pdfDoc.embedJpg(arrayBuffer)\r\n     * ```\r\n     *\r\n     * @param jpg The input data for a JPEG image.\r\n     * @returns Resolves with the embedded image.\r\n     */\r\n    PDFDocument.prototype.embedJpg = function (jpg) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var bytes, embedder, ref, pdfImage;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        assertIs(jpg, 'jpg', ['string', Uint8Array, ArrayBuffer]);\r\n                        bytes = toUint8Array(jpg);\r\n                        return [4 /*yield*/, JpegEmbedder.for(bytes)];\r\n                    case 1:\r\n                        embedder = _a.sent();\r\n                        ref = this.context.nextRef();\r\n                        pdfImage = PDFImage.of(ref, this, embedder);\r\n                        this.images.push(pdfImage);\r\n                        return [2 /*return*/, pdfImage];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Embed a PNG image into this document. The input data can be provided in\r\n     * multiple formats:\r\n     *\r\n     * | Type          | Contents                                                     |\r\n     * | ------------- | ------------------------------------------------------------ |\r\n     * | `string`      | A base64 encoded string (or data URI) containing a PNG image |\r\n     * | `Uint8Array`  | The raw bytes of a PNG image                                 |\r\n     * | `ArrayBuffer` | The raw bytes of a PNG image                                 |\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * // png=string\r\n     * const image1 = await pdfDoc.embedPng('iVBORw0KGgoAAAANSUhEUgAAAlgAAAF3...')\r\n     * const image2 = await pdfDoc.embedPng('data:image/png;base64,iVBORw0KGg...')\r\n     *\r\n     * // png=Uint8Array\r\n     * import fs from 'fs'\r\n     * const uint8Array = fs.readFileSync('small_mario.png')\r\n     * const image3 = await pdfDoc.embedPng(uint8Array)\r\n     *\r\n     * // png=ArrayBuffer\r\n     * const url = 'https://pdf-lib.js.org/assets/small_mario.png'\r\n     * const arrayBuffer = await fetch(url).then(res => res.arrayBuffer())\r\n     * const image4 = await pdfDoc.embedPng(arrayBuffer)\r\n     * ```\r\n     *\r\n     * @param png The input data for a PNG image.\r\n     * @returns Resolves with the embedded image.\r\n     */\r\n    PDFDocument.prototype.embedPng = function (png) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var bytes, embedder, ref, pdfImage;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        assertIs(png, 'png', ['string', Uint8Array, ArrayBuffer]);\r\n                        bytes = toUint8Array(png);\r\n                        return [4 /*yield*/, PngEmbedder.for(bytes)];\r\n                    case 1:\r\n                        embedder = _a.sent();\r\n                        ref = this.context.nextRef();\r\n                        pdfImage = PDFImage.of(ref, this, embedder);\r\n                        this.images.push(pdfImage);\r\n                        return [2 /*return*/, pdfImage];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Embed one or more PDF pages into this document.\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * const pdfDoc = await PDFDocument.create()\r\n     *\r\n     * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n     * const sourcePdf = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n     *\r\n     * // Embed page 74 of `sourcePdf` into `pdfDoc`\r\n     * const [embeddedPage] = await pdfDoc.embedPdf(sourcePdf, [73])\r\n     * ```\r\n     *\r\n     * See [[PDFDocument.load]] for examples of the allowed input data formats.\r\n     *\r\n     * @param pdf The input data containing a PDF document.\r\n     * @param indices The indices of the pages that should be embedded.\r\n     * @returns Resolves with an array of the embedded pages.\r\n     */\r\n    PDFDocument.prototype.embedPdf = function (pdf, indices) {\r\n        if (indices === void 0) { indices = [0]; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var srcDoc, _a, srcPages;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        assertIs(pdf, 'pdf', [\r\n                            'string',\r\n                            Uint8Array,\r\n                            ArrayBuffer,\r\n                            [PDFDocument, 'PDFDocument'],\r\n                        ]);\r\n                        assertIs(indices, 'indices', [Array]);\r\n                        if (!(pdf instanceof PDFDocument)) return [3 /*break*/, 1];\r\n                        _a = pdf;\r\n                        return [3 /*break*/, 3];\r\n                    case 1: return [4 /*yield*/, PDFDocument.load(pdf)];\r\n                    case 2:\r\n                        _a = _b.sent();\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        srcDoc = _a;\r\n                        srcPages = pluckIndices(srcDoc.getPages(), indices);\r\n                        return [2 /*return*/, this.embedPages(srcPages)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Embed a single PDF page into this document.\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * const pdfDoc = await PDFDocument.create()\r\n     *\r\n     * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n     * const sourceBuffer = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n     * const sourcePdfDoc = await PDFDocument.load(sourceBuffer)\r\n     * const sourcePdfPage = sourcePdfDoc.getPages()[73]\r\n     *\r\n     * const embeddedPage = await pdfDoc.embedPage(\r\n     *   sourcePdfPage,\r\n     *\r\n     *   // Clip a section of the source page so that we only embed part of it\r\n     *   { left: 100, right: 450, bottom: 330, top: 570 },\r\n     *\r\n     *   // Translate all drawings of the embedded page by (10, 200) units\r\n     *   [1, 0, 0, 1, 10, 200],\r\n     * )\r\n     * ```\r\n     *\r\n     * @param page The page to be embedded.\r\n     * @param boundingBox\r\n     * Optionally, an area of the source page that should be embedded\r\n     * (defaults to entire page).\r\n     * @param transformationMatrix\r\n     * Optionally, a transformation matrix that is always applied to the embedded\r\n     * page anywhere it is drawn.\r\n     * @returns Resolves with the embedded pdf page.\r\n     */\r\n    PDFDocument.prototype.embedPage = function (page, boundingBox, transformationMatrix) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var embeddedPage;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        assertIs(page, 'page', [[PDFPage, 'PDFPage']]);\r\n                        return [4 /*yield*/, this.embedPages([page], [boundingBox], [transformationMatrix])];\r\n                    case 1:\r\n                        embeddedPage = (_a.sent())[0];\r\n                        return [2 /*return*/, embeddedPage];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Embed one or more PDF pages into this document.\r\n     *\r\n     * For example:\r\n     * ```js\r\n     * const pdfDoc = await PDFDocument.create()\r\n     *\r\n     * const sourcePdfUrl = 'https://pdf-lib.js.org/assets/with_large_page_count.pdf'\r\n     * const sourceBuffer = await fetch(sourcePdfUrl).then((res) => res.arrayBuffer())\r\n     * const sourcePdfDoc = await PDFDocument.load(sourceBuffer)\r\n     *\r\n     * const page1 = sourcePdfDoc.getPages()[0]\r\n     * const page2 = sourcePdfDoc.getPages()[52]\r\n     * const page3 = sourcePdfDoc.getPages()[73]\r\n     *\r\n     * const embeddedPages = await pdfDoc.embedPages([page1, page2, page3])\r\n     * ```\r\n     *\r\n     * @param page\r\n     * The pages to be embedded (they must all share the same context).\r\n     * @param boundingBoxes\r\n     * Optionally, an array of clipping boundaries - one for each page\r\n     * (defaults to entirety of each page).\r\n     * @param transformationMatrices\r\n     * Optionally, an array of transformation matrices - one for each page\r\n     * (each page's transformation will apply anywhere it is drawn).\r\n     * @returns Resolves with an array of the embedded pdf pages.\r\n     */\r\n    PDFDocument.prototype.embedPages = function (pages, boundingBoxes, transformationMatrices) {\r\n        if (boundingBoxes === void 0) { boundingBoxes = []; }\r\n        if (transformationMatrices === void 0) { transformationMatrices = []; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var idx, len, currPage, nextPage, context, maybeCopyPage, embeddedPages, idx, len, page, box, matrix, embedder, ref;\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (pages.length === 0)\r\n                            return [2 /*return*/, []];\r\n                        // Assert all pages have the same context\r\n                        for (idx = 0, len = pages.length - 1; idx < len; idx++) {\r\n                            currPage = pages[idx];\r\n                            nextPage = pages[idx + 1];\r\n                            if (currPage.node.context !== nextPage.node.context) {\r\n                                throw new PageEmbeddingMismatchedContextError();\r\n                            }\r\n                        }\r\n                        context = pages[0].node.context;\r\n                        maybeCopyPage = context === this.context\r\n                            ? function (p) { return p; }\r\n                            : PDFObjectCopier.for(context, this.context).copy;\r\n                        embeddedPages = new Array(pages.length);\r\n                        idx = 0, len = pages.length;\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        if (!(idx < len)) return [3 /*break*/, 4];\r\n                        page = maybeCopyPage(pages[idx].node);\r\n                        box = boundingBoxes[idx];\r\n                        matrix = transformationMatrices[idx];\r\n                        return [4 /*yield*/, PDFPageEmbedder.for(page, box, matrix)];\r\n                    case 2:\r\n                        embedder = _b.sent();\r\n                        ref = this.context.nextRef();\r\n                        embeddedPages[idx] = PDFEmbeddedPage.of(ref, this, embedder);\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        idx++;\r\n                        return [3 /*break*/, 1];\r\n                    case 4:\r\n                        (_a = this.embeddedPages).push.apply(_a, embeddedPages);\r\n                        return [2 /*return*/, embeddedPages];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * > **NOTE:** You shouldn't need to call this method directly. The [[save]]\r\n     * > and [[saveAsBase64]] methods will automatically ensure that all embedded\r\n     * > assets are flushed before serializing the document.\r\n     *\r\n     * Flush all embedded fonts, PDF pages, and images to this document's\r\n     * [[context]].\r\n     *\r\n     * @returns Resolves when the flush is complete.\r\n     */\r\n    PDFDocument.prototype.flush = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.embedAll(this.fonts)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.embedAll(this.images)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.embedAll(this.embeddedPages)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.embedAll(this.embeddedFiles)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.embedAll(this.javaScripts)];\r\n                    case 5:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Serialize this document to an array of bytes making up a PDF file.\r\n     * For example:\r\n     * ```js\r\n     * const pdfBytes = await pdfDoc.save()\r\n     * ```\r\n     *\r\n     * There are a number of things you can do with the serialized document,\r\n     * depending on the JavaScript environment you're running in:\r\n     * * Write it to a file in Node or React Native\r\n     * * Download it as a Blob in the browser\r\n     * * Render it in an `iframe`\r\n     *\r\n     * @param options The options to be used when saving the document.\r\n     * @returns Resolves with the bytes of the serialized document.\r\n     */\r\n    PDFDocument.prototype.save = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, useObjectStreams, _b, addDefaultPage, _c, objectsPerTick, _d, updateFieldAppearances, form, Writer;\r\n            return __generator(this, function (_e) {\r\n                switch (_e.label) {\r\n                    case 0:\r\n                        _a = options.useObjectStreams, useObjectStreams = _a === void 0 ? true : _a, _b = options.addDefaultPage, addDefaultPage = _b === void 0 ? true : _b, _c = options.objectsPerTick, objectsPerTick = _c === void 0 ? 50 : _c, _d = options.updateFieldAppearances, updateFieldAppearances = _d === void 0 ? true : _d;\r\n                        assertIs(useObjectStreams, 'useObjectStreams', ['boolean']);\r\n                        assertIs(addDefaultPage, 'addDefaultPage', ['boolean']);\r\n                        assertIs(objectsPerTick, 'objectsPerTick', ['number']);\r\n                        assertIs(updateFieldAppearances, 'updateFieldAppearances', ['boolean']);\r\n                        if (addDefaultPage && this.getPageCount() === 0)\r\n                            this.addPage();\r\n                        if (updateFieldAppearances) {\r\n                            form = this.formCache.getValue();\r\n                            if (form)\r\n                                form.updateFieldAppearances();\r\n                        }\r\n                        return [4 /*yield*/, this.flush()];\r\n                    case 1:\r\n                        _e.sent();\r\n                        Writer = useObjectStreams ? PDFStreamWriter : PDFWriter;\r\n                        return [2 /*return*/, Writer.forContext(this.context, objectsPerTick).serializeToBuffer()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Serialize this document to a base64 encoded string or data URI making up a\r\n     * PDF file. For example:\r\n     * ```js\r\n     * const base64String = await pdfDoc.saveAsBase64()\r\n     * base64String // => 'JVBERi0xLjcKJYGBgYEKC...'\r\n     *\r\n     * const base64DataUri = await pdfDoc.saveAsBase64({ dataUri: true })\r\n     * base64DataUri // => 'data:application/pdf;base64,JVBERi0xLjcKJYGBgYEKC...'\r\n     * ```\r\n     *\r\n     * @param options The options to be used when saving the document.\r\n     * @returns Resolves with a base64 encoded string or data URI of the\r\n     *          serialized document.\r\n     */\r\n    PDFDocument.prototype.saveAsBase64 = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, dataUri, otherOptions, bytes, base64;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = options.dataUri, dataUri = _a === void 0 ? false : _a, otherOptions = __rest(options, [\"dataUri\"]);\r\n                        assertIs(dataUri, 'dataUri', ['boolean']);\r\n                        return [4 /*yield*/, this.save(otherOptions)];\r\n                    case 1:\r\n                        bytes = _b.sent();\r\n                        base64 = encodeToBase64(bytes);\r\n                        return [2 /*return*/, dataUri ? \"data:application/pdf;base64,\" + base64 : base64];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    PDFDocument.prototype.findPageForAnnotationRef = function (ref) {\r\n        var pages = this.getPages();\r\n        for (var idx = 0, len = pages.length; idx < len; idx++) {\r\n            var page = pages[idx];\r\n            var annotations = page.node.Annots();\r\n            if ((annotations === null || annotations === void 0 ? void 0 : annotations.indexOf(ref)) !== undefined) {\r\n                return page;\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    PDFDocument.prototype.embedAll = function (embeddables) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var idx, len;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        idx = 0, len = embeddables.length;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!(idx < len)) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, embeddables[idx].embed()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        idx++;\r\n                        return [3 /*break*/, 1];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    PDFDocument.prototype.updateInfoDict = function () {\r\n        var pdfLib = \"pdf-lib (https://github.com/Hopding/pdf-lib)\";\r\n        var now = new Date();\r\n        var info = this.getInfoDict();\r\n        this.setProducer(pdfLib);\r\n        this.setModificationDate(now);\r\n        if (!info.get(PDFName.of('Creator')))\r\n            this.setCreator(pdfLib);\r\n        if (!info.get(PDFName.of('CreationDate')))\r\n            this.setCreationDate(now);\r\n    };\r\n    PDFDocument.prototype.getInfoDict = function () {\r\n        var existingInfo = this.context.lookup(this.context.trailerInfo.Info);\r\n        if (existingInfo instanceof PDFDict)\r\n            return existingInfo;\r\n        var newInfo = this.context.obj({});\r\n        this.context.trailerInfo.Info = this.context.register(newInfo);\r\n        return newInfo;\r\n    };\r\n    PDFDocument.prototype.assertFontkit = function () {\r\n        if (!this.fontkit)\r\n            throw new FontkitNotRegisteredError();\r\n        return this.fontkit;\r\n    };\r\n    return PDFDocument;\r\n}());\r\nexport default PDFDocument;\r\n/* tslint:disable-next-line only-arrow-functions */\r\nfunction assertIsLiteralOrHexString(pdfObject) {\r\n    if (!(pdfObject instanceof PDFHexString) &&\r\n        !(pdfObject instanceof PDFString)) {\r\n        throw new UnexpectedObjectTypeError([PDFHexString, PDFString], pdfObject);\r\n    }\r\n}\r\n//# sourceMappingURL=PDFDocument.js.map"]},"metadata":{},"sourceType":"module"}